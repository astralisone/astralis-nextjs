(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[915],{13406:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>o,av:()=>d,j7:()=>c,tU:()=>r});var t=a(95155),l=a(12115),i=a(25667),n=a(64269);let r=i.bL,c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.B8,{ref:s,className:(0,n.cn)("flex w-full items-center justify-start gap-2 rounded-lg bg-slate-200 p-[10px] text-slate-600",a),...l})});c.displayName=i.B8.displayName;let o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.l9,{ref:s,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-4 py-1.5 text-sm font-medium transition-all duration-150 ease-out","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-astralis-blue focus-visible:ring-offset-2","disabled:pointer-events-none disabled:opacity-50","data-[state=active]:bg-white data-[state=active]:text-astralis-blue data-[state=active]:shadow-sm","hover:text-astralis-navy",a),...l})});o.displayName=i.l9.displayName;let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.UC,{ref:s,className:(0,n.cn)("mt-4 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-astralis-blue focus-visible:ring-offset-2",a),...l})});d.displayName=i.UC.displayName},27063:(e,s,a)=>{"use strict";a.d(s,{CG:()=>d,Fm:()=>p,Qs:()=>f,cj:()=>o,h:()=>u,qp:()=>g});var t=a(95155),l=a(12115),i=a(93409),n=a(83101),r=a(65229),c=a(64269);let o=i.bL,d=i.l9;i.bm;let m=i.ZL,x=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.hJ,{className:(0,c.cn)("fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...l,ref:s})});x.displayName=i.hJ.displayName;let h=(0,n.F)("fixed z-50 gap-4 bg-white p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-300",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),u=l.forwardRef((e,s)=>{let{side:a="right",className:l,children:n,...o}=e;return(0,t.jsxs)(m,{children:[(0,t.jsx)(x,{}),(0,t.jsxs)(i.UC,{ref:s,className:(0,c.cn)(h({side:a}),l),...o,children:[n,(0,t.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-astralis-blue focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-slate-100",children:[(0,t.jsx)(r.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=i.UC.displayName;let p=e=>{let{className:s,...a}=e;return(0,t.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-2 text-center sm:text-left",s),...a})};p.displayName="SheetHeader";let g=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.hE,{ref:s,className:(0,c.cn)("text-lg font-semibold text-astralis-navy",a),...l})});g.displayName=i.hE.displayName;let f=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(i.VY,{ref:s,className:(0,c.cn)("text-sm text-slate-600",a),...l})});f.displayName=i.VY.displayName},51533:(e,s,a)=>{Promise.resolve().then(a.bind(a,82941))},82941:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>er});var t=a(95155),l=a(12115),i=a(20063),n=a(64903),r=a(27202),c=a(44521),o=a(43465),d=a(23664),m=a(37586),x=a(56154),h=a(49476),u=a(35299),p=a(5917),g=a(65229),f=a(20508),j=a(6132),N=a(16485),b=a(26983),v=a(86948),y=a(11647),w=a(11186),C=a(64269),E=a(81925),A=a(80183),S=a(26467),T=a(53298);let k={[E.Vl.NONE]:{label:"None",className:"bg-slate-100 text-slate-600 border-slate-200"},[E.Vl.LOW]:{label:"Low",className:"bg-blue-50 text-blue-700 border-blue-200"},[E.Vl.MEDIUM]:{label:"Medium",className:"bg-yellow-50 text-yellow-700 border-yellow-200"},[E.Vl.HIGH]:{label:"High",className:"bg-orange-50 text-orange-700 border-orange-200"},[E.Vl.URGENT]:{label:"Urgent",className:"bg-red-50 text-red-700 border-red-200"}},D={FORM:{icon:o.A,className:"text-purple-600"},EMAIL:{icon:d.A,className:"text-blue-600"},CHAT:{icon:m.A,className:"text-green-600"},API:{icon:x.A,className:"text-orange-600"}};function R(e){let{item:s,isDragging:a=!1,onClick:i,fullCardDrag:n=!1,pipelineId:r,onStatusChange:o,teamMembers:d,onAssigneeChange:m}=e,[x,R]=(0,l.useState)(null),[O,I]=(0,l.useState)(!1),{attributes:M,listeners:P,setNodeRef:F,transform:L}=(0,c.PM)({id:s.id}),U=L?{transform:"translate3d(".concat(L.x,"px, ").concat(L.y,"px, 0)")}:void 0,V=!!s.dueDate&&(0,A.R)((0,S.H)(s.dueDate)),H=k[s.priority]||k[E.Vl.NONE],G=s.progress||0,J=s.tags||[],$=n?{...P,...M}:{},_=n?{}:{...P,...M},q=async e=>{if(e.stopPropagation(),r&&!x){R("close");try{let e=await fetch("/api/pipelines/".concat(r,"/items/").concat(s.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:E.CT.CLOSED})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to close item")}null==o||o(s.id,E.CT.CLOSED)}catch(e){console.error("Error closing item:",e)}finally{R(null)}}},z=async e=>{if(e.stopPropagation(),r&&!x){R("complete");try{let e=await fetch("/api/pipelines/".concat(r,"/items/").concat(s.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:E.CT.COMPLETED})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to complete item")}null==o||o(s.id,E.CT.COMPLETED)}catch(e){console.error("Error completing item:",e)}finally{R(null)}}},W=async e=>{if(m){I(!0);try{await m(s.id,"unassigned"===e?null:e)}finally{I(!1)}}},B=r&&s.status!==E.CT.CLOSED&&s.status!==E.CT.COMPLETED;return(0,t.jsx)("div",{ref:F,style:U,...$,className:(0,C.cn)("UnifiedKanbanCard transition-all duration-200",n&&"cursor-grab active:cursor-grabbing touch-none",a&&"opacity-50 scale-95"),children:(0,t.jsx)(v.Zp,{variant:"default",hover:!0,className:(0,C.cn)("cursor-pointer border-2 transition-colors",V&&"border-red-300 bg-red-50/30",a&&"border-purple-500 bg-purple-50 shadow-lg shadow-purple-200"),onClick:i,children:(0,t.jsx)(v.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[!n&&(0,t.jsx)("button",{..._,className:"mt-1 text-slate-400 hover:text-slate-600 cursor-grab active:cursor-grabbing touch-none","aria-label":"Drag to move",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(h.A,{className:"w-5 h-5"})}),n&&(0,t.jsx)("div",{className:"mt-1 text-slate-400",children:(0,t.jsx)(h.A,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("div",{className:"flex items-start gap-2 flex-1 min-w-0",children:(0,t.jsxs)("h4",{className:"font-medium text-sm text-astralis-navy line-clamp-2 flex-1 min-w-0",children:[(()=>{let e="source"in s&&s.source?s.source:s.data&&"object"==typeof s.data&&"source"in s.data?s.data.source:null;if(e&&D[e]){let s=D[e].icon;return(0,t.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,t.jsx)(s,{className:"w-5 h-5 ".concat(D[e].className)})})}return null})(),s.title]})}),(0,t.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[B&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:z,disabled:null!==x,className:(0,C.cn)("p-1 rounded transition-colors","hover:bg-green-100 text-slate-400 hover:text-green-600","complete"===x&&"bg-green-100 text-green-600"),"aria-label":"Mark as completed",title:"Mark as completed",children:"complete"===x?(0,t.jsx)(u.A,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(p.A,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:q,disabled:null!==x,className:(0,C.cn)("p-1 rounded transition-colors","hover:bg-red-100 text-slate-400 hover:text-red-600","close"===x&&"bg-red-100 text-red-600"),"aria-label":"Close item",title:"Close item (hide from board)",children:"close"===x?(0,t.jsx)(u.A,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(g.A,{className:"w-5 h-5"})})]}),s.priority>E.Vl.NONE&&(0,t.jsx)(y.E,{variant:"default",className:(0,C.cn)("text-xs font-medium",H.className),children:H.label})]})]}),s.description&&(0,t.jsx)("p",{className:"text-xs text-slate-500 line-clamp-2",children:s.description}),G>0&&(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,t.jsx)("span",{className:"text-slate-600",children:"Progress"}),(0,t.jsxs)("span",{className:"text-slate-900 font-medium",children:[G,"%"]})]}),(0,t.jsx)("div",{className:"w-full h-1.5 bg-slate-200 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-astralis-blue rounded-full transition-all duration-300",style:{width:"".concat(G,"%")}})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-slate-500",children:[d&&d.length>0&&m?(0,t.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,t.jsxs)(w.l6,{value:s.assignedToId||"unassigned",onValueChange:W,disabled:O,children:[(0,t.jsx)(w.bq,{className:"h-7 w-[140px] text-xs bg-white border-slate-200",children:(0,t.jsx)(w.yv,{children:O?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(u.A,{className:"w-3 h-3 animate-spin"}),(0,t.jsx)("span",{children:"Assigning..."})]}):s.assignedTo?(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(f.A,{className:"w-3 h-3"}),(0,t.jsx)("span",{className:"truncate",children:s.assignedTo.name})]}):(0,t.jsxs)("div",{className:"flex items-center gap-1 text-slate-400",children:[(0,t.jsx)(f.A,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:"Unassigned"})]})})}),(0,t.jsxs)(w.gC,{children:[(0,t.jsx)(w.eb,{value:"unassigned",children:(0,t.jsx)("span",{className:"text-slate-400",children:"Unassigned"})}),d.map(e=>(0,t.jsx)(w.eb,{value:e.id,children:e.name||e.email},e.id))]})]})}):s.assignedTo?(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[s.assignedTo.avatar?(0,t.jsx)("img",{src:s.assignedTo.avatar,alt:s.assignedTo.name,className:"w-6 h-6 rounded-full"}):(0,t.jsx)("div",{className:"w-6 h-6 rounded-full bg-astralis-blue/10 flex items-center justify-center",children:(0,t.jsx)(f.A,{className:"w-5 h-5 text-astralis-blue"})}),(0,t.jsx)("span",{className:"truncate max-w-[100px]",children:s.assignedTo.name})]}):(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-slate-400",children:[(0,t.jsx)(f.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Unassigned"})]}),s.dueDate&&(0,t.jsxs)("div",{className:(0,C.cn)("flex items-center gap-1.5",V&&"text-red-600 font-medium"),children:[V&&(0,t.jsx)(j.A,{className:"w-5 h-5"}),(0,t.jsx)(N.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:(0,T.m)((0,S.H)(s.dueDate),{addSuffix:!0})})]}),!s.dueDate&&s.createdAt&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-slate-400 ml-auto",children:[(0,t.jsx)(b.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:(0,T.m)((0,S.H)(s.createdAt),{addSuffix:!0})})]})]}),J.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[J.slice(0,3).map(e=>(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 bg-slate-100 text-slate-600 rounded",children:e},e)),J.length>3&&(0,t.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-slate-100 text-slate-500 rounded",children:["+",J.length-3]})]})]})]})})})})}var O=a(6191),I=a(51834),M=a(3998),P=a(65142),F=a(76444),L=a(31120);let U=[{value:E.Vl.NONE,label:"None",color:"text-slate-600"},{value:E.Vl.LOW,label:"Low",color:"text-blue-600"},{value:E.Vl.MEDIUM,label:"Medium",color:"text-yellow-600"},{value:E.Vl.HIGH,label:"High",color:"text-orange-600"},{value:E.Vl.URGENT,label:"Urgent",color:"text-red-600"}],V=[{value:E.CT.NOT_STARTED,label:"Not Started"},{value:E.CT.IN_PROGRESS,label:"In Progress"},{value:E.CT.BLOCKED,label:"Blocked"},{value:E.CT.COMPLETED,label:"Completed"}];function H(e){let{pipelineId:s,stageId:a,stageName:i,onItemCreated:n,trigger:r}=e,[c,o]=(0,l.useState)(!1),[d,m]=(0,l.useState)(!1),[x,h]=(0,l.useState)({title:"",description:"",priority:E.Vl.NONE,status:E.CT.NOT_STARTED,dueDate:"",tags:""}),u=()=>{o(!1),h({title:"",description:"",priority:E.Vl.NONE,status:E.CT.NOT_STARTED,dueDate:"",tags:""})},p=async e=>{e.preventDefault(),m(!0);try{let e=x.tags.split(",").map(e=>e.trim()).filter(e=>e.length>0),t=await fetch("/api/pipelines/".concat(s,"/items"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:x.title,description:x.description||void 0,priority:x.priority,status:x.status,dueDate:x.dueDate||null,tags:e,stageId:a})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to create item")}null==n||n(),u()}catch(e){console.error("Error creating item:",e),alert(e instanceof Error?e.message:"Failed to create item")}finally{m(!1)}};return(0,t.jsxs)(I.lG,{open:c,onOpenChange:o,children:[(0,t.jsx)(I.zM,{asChild:!0,children:r||(0,t.jsxs)(M.$,{variant:"outline",size:"sm",className:"w-full gap-1.5 text-sm",children:[(0,t.jsx)(O.A,{className:" ui-icon w-5 h-5"}),"Add Item"]})}),(0,t.jsx)(I.Cf,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:(0,t.jsxs)("form",{onSubmit:p,children:[(0,t.jsxs)(I.c7,{children:[(0,t.jsx)(I.L3,{children:"New Item"}),(0,t.jsxs)(I.rr,{children:["Add a new item to ",(0,t.jsx)("span",{className:"font-medium",children:i})]})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(F.J,{htmlFor:"title",children:["Title ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(P.p,{id:"title",value:x.title,onChange:e=>h({...x,title:e.target.value}),placeholder:"Enter item title...",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"description",children:"Description"}),(0,t.jsx)(L.T,{id:"description",value:x.description,onChange:e=>h({...x,description:e.target.value}),placeholder:"Describe this item...",rows:4})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"priority",children:"Priority"}),(0,t.jsx)("select",{id:"priority",value:x.priority,onChange:e=>h({...x,priority:Number(e.target.value)}),className:"w-full px-3 py-2 border border-slate-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-astralis-blue focus:border-transparent",children:U.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"status",children:"Status"}),(0,t.jsx)("select",{id:"status",value:x.status,onChange:e=>h({...x,status:e.target.value}),className:"w-full px-3 py-2 border border-slate-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-astralis-blue focus:border-transparent",children:V.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"dueDate",children:"Due Date"}),(0,t.jsx)(P.p,{id:"dueDate",type:"date",value:x.dueDate,onChange:e=>h({...x,dueDate:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"tags",children:"Tags"}),(0,t.jsx)(P.p,{id:"tags",value:x.tags,onChange:e=>h({...x,tags:e.target.value}),placeholder:"e.g., bug, feature, urgent (comma-separated)"}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Separate multiple tags with commas"})]})]}),(0,t.jsxs)(I.Es,{children:[(0,t.jsx)(M.$,{type:"button",variant:"outline",onClick:u,disabled:d,children:"Cancel"}),(0,t.jsx)(M.$,{type:"submit",disabled:d,children:d?"Creating...":"Create Item"})]})]})})]})}function G(e){let{stage:s,items:a,pipelineId:l,onItemCreated:i,onStatusChange:n,teamMembers:r,onAssigneeChange:o}=e,{setNodeRef:d,isOver:m}=(0,c.zM)({id:s.id}),x=a.filter(e=>e.status!==E.CT.CLOSED&&e.status!==E.CT.COMPLETED);return(0,t.jsx)("div",{className:"flex-1 min-w-[280px] max-w-[320px] flex flex-col h-full",children:(0,t.jsxs)("div",{className:"bg-slate-100 rounded-lg p-4 flex flex-col h-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-3 mb-4 py-2 px-3 -mx-4 -mt-4 rounded-t-lg bg-slate-200/70 flex-shrink-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[s.color&&(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),(0,t.jsx)("h3",{className:"font-semibold text-sm text-astralis-navy",children:s.name})]}),(0,t.jsx)("span",{className:"text-xs text-slate-500 bg-white px-2 py-0.5 rounded font-medium",children:x.length})]}),(0,t.jsxs)("div",{ref:d,className:(0,C.cn)("space-y-3 flex-1 overflow-y-auto min-h-[120px] transition-colors pr-1",m&&"bg-astralis-blue/10 rounded-lg p-2"),children:[x.map(e=>(0,t.jsx)(R,{item:e,pipelineId:l,onStatusChange:n,teamMembers:r,onAssigneeChange:o,fullCardDrag:!0},e.id)),0===x.length&&(0,t.jsx)("div",{className:"text-center py-12 text-slate-400 text-sm",children:"Drop items here"})]}),(0,t.jsx)("div",{className:"mt-3 flex-shrink-0",children:(0,t.jsx)(H,{pipelineId:l,stageId:s.id,stageName:s.name,onItemCreated:i})})]})})}function J(e){let{pipeline:s,onRefetch:a}=e,[i,r]=(0,l.useState)(null),o=(0,n.Cs)(),d=(0,c.FR)((0,c.MS)(c.AN,{activationConstraint:{distance:8}})),m=()=>{null==a||a()},x=()=>{null==a||a()};return(0,t.jsxs)(c.Mp,{sensors:d,collisionDetection:c.fp,onDragStart:e=>{let{active:a}=e,t=s.stages.flatMap(e=>e.items).find(e=>e.id===a.id);t&&r(t)},onDragEnd:e=>{let{active:a,over:t}=e;if(!t)return void r(null);let l=a.id,i=t.id,n=s.stages.find(e=>e.items.some(e=>e.id===l));if(!n||n.id===i)return void r(null);o.mutate({itemId:l,pipelineId:s.id,targetStageId:i}),r(null)},children:[(0,t.jsx)("div",{className:"flex gap-4 h-full max-h-full overflow-hidden p-4",children:s.stages.map(e=>(0,t.jsx)(G,{stage:e,items:e.items,pipelineId:s.id,onItemCreated:m,onStatusChange:x},e.id))}),(0,t.jsx)(c.Hd,{children:i?(0,t.jsx)("div",{className:"rotate-2 scale-105",children:(0,t.jsx)(R,{item:{id:i.id,title:i.title,description:i.description,priority:i.priority,tags:i.tags,stageId:i.stageId},isDragging:!0,fullCardDrag:!0})}):null})]})}var $=a(21190),_=a(71360);let q=["#64748b","#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6"];function z(e){let{pipelineId:s,stages:a,onStagesChange:i}=e,[n,r]=(0,l.useState)(!1),[c,o]=(0,l.useState)(null),[d,m]=(0,l.useState)(!1),[x,u]=(0,l.useState)({name:"",description:"",color:q[0]}),p=e=>{e?(o(e),u({name:e.name,description:e.description||"",color:e.color||q[0]})):(o(null),u({name:"",description:"",color:q[0]})),r(!0)},g=()=>{r(!1),o(null),u({name:"",description:"",color:q[0]})},f=async e=>{e.preventDefault(),m(!0);try{if(c){if(!(await fetch("/api/pipelines/".concat(s,"/stages/").concat(c.id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).ok)throw Error("Failed to update stage")}else if(!(await fetch("/api/pipelines/".concat(s,"/stages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...x,order:a.length})})).ok)throw Error("Failed to create stage");null==i||i(),g()}catch(e){console.error("Error saving stage:",e),alert(e instanceof Error?e.message:"Failed to save stage")}finally{m(!1)}},j=async e=>{if(confirm("Are you sure you want to delete this stage? This cannot be undone."))try{let a=await fetch("/api/pipelines/".concat(s,"/stages/").concat(e),{method:"DELETE"});if(!a.ok){let e=await a.json();throw Error(e.error||"Failed to delete stage")}null==i||i()}catch(e){console.error("Error deleting stage:",e),alert(e instanceof Error?e.message:"Failed to delete stage")}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[a.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-white border border-slate-200 rounded-lg hover:border-slate-300 transition-colors",children:[(0,t.jsx)("button",{className:"text-slate-400 hover:text-slate-600 cursor-grab","aria-label":"Drag to reorder",children:(0,t.jsx)(h.A,{className:"w-6 h-6"})}),e.color&&(0,t.jsx)("div",{className:"w-5 h-5 rounded-full flex-shrink-0",style:{backgroundColor:e.color}}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-astralis-navy truncate",children:e.name}),e.description&&(0,t.jsx)("p",{className:"text-xs text-slate-500 truncate",children:e.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(M.$,{variant:"ghost",size:"icon",onClick:()=>p(e),className:"h-9 w-9",children:(0,t.jsx)($.A,{className:"w-5 h-5"})}),(0,t.jsx)(M.$,{variant:"ghost",size:"icon",onClick:()=>j(e.id),className:"h-9 w-9 text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(_.A,{className:"w-5 h-5"})})]})]},e.id)),(0,t.jsxs)(M.$,{variant:"outline",onClick:()=>p(),className:"w-full",children:[(0,t.jsx)(O.A,{className:"w-6 h-6 mr-2"}),"Add Stage"]})]}),(0,t.jsx)(I.lG,{open:n,onOpenChange:r,children:(0,t.jsx)(I.Cf,{children:(0,t.jsxs)("form",{onSubmit:f,children:[(0,t.jsxs)(I.c7,{children:[(0,t.jsx)(I.L3,{children:c?"Edit Stage":"New Stage"}),(0,t.jsx)(I.rr,{children:c?"Update the stage details":"Create a new stage in this pipeline"})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"name",children:"Stage Name"}),(0,t.jsx)(P.p,{id:"name",value:x.name,onChange:e=>u({...x,name:e.target.value}),placeholder:"e.g., Backlog, In Progress, Review",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{htmlFor:"description",children:"Description (Optional)"}),(0,t.jsx)(L.T,{id:"description",value:x.description,onChange:e=>u({...x,description:e.target.value}),placeholder:"Describe this stage...",rows:3})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(F.J,{children:"Color"}),(0,t.jsx)("div",{className:"flex gap-2",children:q.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>u({...x,color:e}),className:(0,C.cn)("w-8 h-8 rounded-full border-2 transition-all",x.color===e?"border-astralis-navy scale-110":"border-transparent hover:scale-105"),style:{backgroundColor:e},"aria-label":"Select ".concat(e)},e))})]})]}),(0,t.jsxs)(I.Es,{children:[(0,t.jsx)(M.$,{type:"button",variant:"outline",onClick:g,disabled:d,children:"Cancel"}),(0,t.jsx)(M.$,{type:"submit",disabled:d,children:d?"Saving...":c?"Update Stage":"Create Stage"})]})]})})})]})}var W=a(52056),B=a(39332),K=a(89559);let X={[E.Vl.NONE]:{label:"None",className:"bg-slate-100 text-slate-600 border-slate-200"},[E.Vl.LOW]:{label:"Low",className:"bg-blue-50 text-blue-700 border-blue-200"},[E.Vl.MEDIUM]:{label:"Medium",className:"bg-yellow-50 text-yellow-700 border-yellow-200"},[E.Vl.HIGH]:{label:"High",className:"bg-orange-50 text-orange-700 border-orange-200"},[E.Vl.URGENT]:{label:"Urgent",className:"bg-red-50 text-red-700 border-red-200"}},Z={[E.lR.NEW]:{label:"New",className:"bg-yellow-100 text-yellow-700",icon:(0,t.jsx)(W.A,{className:"w-5 h-5"})},[E.lR.ROUTING]:{label:"Routing",className:"bg-blue-100 text-blue-700",icon:(0,t.jsx)(o.A,{className:"w-5 h-5"})},[E.lR.ASSIGNED]:{label:"Assigned",className:"bg-green-100 text-green-700",icon:null},[E.lR.PROCESSING]:{label:"Processing",className:"bg-purple-100 text-purple-700",icon:null},[E.lR.COMPLETED]:{label:"Completed",className:"bg-emerald-100 text-emerald-700",icon:null},[E.lR.REJECTED]:{label:"Rejected",className:"bg-red-100 text-red-700",icon:null}},Q={[E.Md.FORM]:{label:"Form",icon:(0,t.jsx)(o.A,{className:"w-5 h-5"}),className:"text-purple-600"},[E.Md.EMAIL]:{label:"Email",icon:(0,t.jsx)(d.A,{className:"w-5 h-5"}),className:"text-blue-600"},[E.Md.CHAT]:{label:"Chat",icon:(0,t.jsx)(m.A,{className:"w-5 h-5"}),className:"text-green-600"},[E.Md.API]:{label:"API",icon:(0,t.jsx)(x.A,{className:"w-5 h-5"}),className:"text-orange-600"}};function Y(e){var s,a;let{intake:i,isDragging:n=!1,onClick:r,fullCardDrag:o=!1,availablePipelines:d=[],onPipelineAssign:m,onReclassify:x}=e,[p,g]=(0,l.useState)(!1),[f,j]=(0,l.useState)(!1),{attributes:N,listeners:A,setNodeRef:k,transform:D}=(0,c.PM)({id:"intake-".concat(i.id)}),R=D?{transform:"translate3d(".concat(D.x,"px, ").concat(D.y,"px, 0)")}:void 0,O=X[i.priority]||X[E.Vl.NONE],I=Z[i.status]||Z[E.lR.NEW],M=Q[i.source]||Q[E.Md.FORM],P=o?{...A,...N}:{},F=o?{}:{...A,...N},L=async e=>{if(m){g(!0);try{await m(i.id,e)}finally{g(!1)}}},U=async e=>{if(e.stopPropagation(),x){j(!0);try{await x(i.id)}finally{j(!1)}}};i.pipeline||i.assignedPipeline;let V=null==(s=i.pipeline)?void 0:s.name;return(0,t.jsx)("div",{ref:k,style:R,...P,className:(0,C.cn)("IntakeCard transition-all duration-200",o&&"cursor-grab active:cursor-grabbing touch-none",n&&"opacity-50 scale-95"),children:(0,t.jsx)(v.Zp,{variant:"default",hover:!0,className:(0,C.cn)("cursor-pointer border-2 border-amber-200 bg-amber-50/30 transition-colors",n&&"border-purple-500 bg-purple-50 shadow-lg shadow-purple-200"),onClick:r,children:(0,t.jsx)(v.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[!o&&(0,t.jsx)("button",{...F,className:"mt-1 text-slate-400 hover:text-slate-600 cursor-grab active:cursor-grabbing touch-none","aria-label":"Drag to move",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(h.A,{className:"w-5 h-5"})}),o&&(0,t.jsx)("div",{className:"mt-1 text-slate-400",children:(0,t.jsx)(h.A,{className:"w-5 h-5"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-astralis-navy line-clamp-2 flex-1",children:i.title}),(0,t.jsxs)(y.E,{variant:"default",className:(0,C.cn)("text-xs font-medium flex items-center gap-1",I.className),children:[I.icon,I.label]})]}),i.description&&(0,t.jsx)("p",{className:"text-xs text-slate-500 line-clamp-2",children:i.description}),(0,t.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[d.length>0&&m?(0,t.jsxs)(w.l6,{value:i.assignedPipeline||(null==(a=i.pipeline)?void 0:a.id)||"",onValueChange:L,disabled:p,children:[(0,t.jsx)(w.bq,{className:"h-8 text-sm bg-white flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[p?(0,t.jsx)(u.A,{className:" ui-icon w-5 h-5 animate-spin"}):(0,t.jsx)(B.A,{className:" ui-icon w-5 h-5 text-astralis-blue"}),(0,t.jsx)(w.yv,{placeholder:"Assign to pipeline..."})]})}),(0,t.jsx)(w.gC,{children:d.map(e=>(0,t.jsx)(w.eb,{value:e.id,children:e.name},e.id))})]}):(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-slate-400 flex-1",children:[(0,t.jsx)(B.A,{className:" ui-icon w-5 h-5"}),(0,t.jsx)("span",{className:"text-sm",children:V||"Unassigned"})]}),x&&(0,t.jsx)("button",{onClick:U,disabled:f,className:"p-1 rounded hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors",title:"Reclassify with AI","aria-label":"Reclassify with AI",children:f?(0,t.jsx)(u.A,{className:" ui-icon w-5 h-5 animate-spin"}):(0,t.jsx)(K.A,{className:" ui-icon w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,t.jsxs)("div",{className:(0,C.cn)("flex items-center gap-1 text-xs",M.className),children:[M.icon,(0,t.jsx)("span",{children:M.label})]}),i.priority>E.Vl.NONE&&(0,t.jsx)(y.E,{variant:"default",className:(0,C.cn)("text-xs font-medium",O.className),children:O.label})]}),i.createdAt&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5 text-sm text-slate-500",children:[(0,t.jsx)(b.A,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:(0,T.m)((0,S.H)(i.createdAt),{addSuffix:!0})})]})]})]})})})})}var ee=a(35626),es=a(15870),ea=a(52619),et=a.n(ea),el=a(13406),ei=a(27063),en=a(82021);function er(e){let{params:s}=e,{id:a}=(0,l.use)(s),c=(0,i.useRouter)(),{data:d,isLoading:m,error:x,refetch:h}=(0,n.IM)(a),{data:p}=(0,n.be)(),{data:g,isLoading:f,refetch:j}=(0,r.g5)(),N=(0,r.tA)(),[b,v]=(0,l.useState)(!1),[w,C]=(0,l.useState)("kanban"),[A,S]=(0,l.useState)(null);if(m)return(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-astralis-blue"})});if(x||!d)return(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-red-600",children:"Failed to load pipeline"})});let T=async(e,s)=>{S(e);try{let a=await N.mutateAsync({intakeId:e,pipelineId:s});(0,en.oR)({title:"Intake Assigned",description:a.message||"Successfully assigned intake to pipeline"}),j(),h()}catch(e){(0,en.oR)({title:"Assignment Failed",description:e instanceof Error?e.message:"Failed to assign intake to pipeline",variant:"destructive"})}finally{S(null)}},k=(p||[]).filter(e=>e.isActive&&e.stages&&e.stages.length>0).map(e=>({id:e.id,name:e.name})),D=(null==d?void 0:d.intakeRequests)||[],R={new:D.filter(e=>e.status===E.lR.NEW).length,routing:D.filter(e=>e.status===E.lR.ROUTING).length,assigned:D.filter(e=>e.status===E.lR.ASSIGNED).length,processing:D.filter(e=>e.status===E.lR.PROCESSING).length,total:D.filter(e=>e.status!==E.lR.COMPLETED&&e.status!==E.lR.REJECTED).length},O=(null==g?void 0:g.intakeRequests)||[],I=(null==g?void 0:g.counts)||{new:0,routing:0,total:0};return(0,t.jsxs)("div",{className:"space-y-6 h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(et(),{href:"/pipelines",children:(0,t.jsxs)(M.$,{variant:"ghost",className:"gap-2",children:[(0,t.jsx)(ee.A,{className:"w-5 h-5"}),"Back"]})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-astralis-navy",children:d.name}),R.total>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[R.new>0&&(0,t.jsxs)(y.E,{className:"bg-yellow-100 text-yellow-700 text-xs flex items-center gap-1",children:[(0,t.jsx)(W.A,{className:" ui-icon w-5 h-5"}),R.new," new"]}),R.routing>0&&(0,t.jsxs)(y.E,{className:"bg-blue-100 text-blue-700 text-xs flex items-center gap-1",children:[(0,t.jsx)(u.A,{className:" ui-icon w-5 h-5 animate-spin"}),R.routing," routing"]}),R.processing>0&&(0,t.jsxs)(y.E,{className:"bg-blue-100 text-blue-700 text-xs flex items-center gap-1",children:[(0,t.jsx)(o.A,{className:" ui-icon w-5 h-5"}),R.processing," processing"]})]})]}),d.description&&(0,t.jsx)("p",{className:"text-slate-600 mt-1",children:d.description})]})]}),(0,t.jsxs)(ei.cj,{open:b,onOpenChange:v,children:[(0,t.jsx)(ei.CG,{asChild:!0,children:(0,t.jsxs)(M.$,{variant:"outline",className:"gap-2",children:[(0,t.jsx)(es.A,{className:"w-5 h-5"}),"Manage Stages"]})}),(0,t.jsxs)(ei.h,{children:[(0,t.jsxs)(ei.Fm,{children:[(0,t.jsx)(ei.qp,{children:"Pipeline Stages"}),(0,t.jsx)(ei.Qs,{children:"Add, edit, or remove stages in this pipeline"})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(z,{pipelineId:d.id,stages:d.stages,onStagesChange:()=>{h()}})})]})]})]}),0===d.stages.length?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center",children:(0,t.jsx)(es.A,{className:"w-8 h-8 text-slate-400"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-astralis-navy mb-2",children:"No stages yet"}),(0,t.jsx)("p",{className:"text-slate-600 mb-6",children:"Get started by creating stages for your pipeline. Stages help organize work items as they move through your workflow."}),(0,t.jsxs)(M.$,{onClick:()=>v(!0),className:"gap-2",children:[(0,t.jsx)(es.A,{className:" ui-icon w-5 h-5"}),"Create First Stage"]})]})}):(0,t.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,t.jsxs)(el.tU,{value:w,onValueChange:C,className:"flex-1 flex flex-col",children:[(0,t.jsxs)(el.j7,{className:"mb-4",children:[(0,t.jsxs)(el.Xi,{value:"kanban",className:"gap-2",children:[(0,t.jsx)(o.A,{className:"w-5 h-5"}),"Kanban Board"]}),(0,t.jsxs)(el.Xi,{value:"unclassified",className:"gap-2",children:[(0,t.jsx)(W.A,{className:"w-5 h-5"}),"Unclassified Intake",I.total>0&&(0,t.jsx)(y.E,{className:"ml-1 bg-yellow-100 text-yellow-700 text-xs",children:I.total})]})]}),(0,t.jsx)(el.av,{value:"kanban",className:"flex-1 overflow-hidden",style:{height:"-webkit-fill-available"},children:(0,t.jsx)(J,{pipeline:d,onRefetch:h})}),(0,t.jsx)(el.av,{value:"unclassified",className:"flex-1 overflow-auto",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-astralis-navy",children:"Unclassified Intake Items"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 mt-1",children:"These items have not been routed to a pipeline yet and need classification."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[I.new>0&&(0,t.jsxs)(y.E,{className:"bg-yellow-100 text-yellow-700 flex items-center gap-1",children:[(0,t.jsx)(W.A,{className:" ui-icon w-5 h-5"}),I.new," New"]}),I.routing>0&&(0,t.jsxs)(y.E,{className:"bg-blue-100 text-blue-700 flex items-center gap-1",children:[(0,t.jsx)(u.A,{className:" ui-icon w-5 h-5 animate-spin"}),I.routing," Routing"]})]})]}),f&&(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(u.A,{className:"w-8 h-8 animate-spin text-astralis-blue"})}),!f&&0===O.length&&(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-50 flex items-center justify-center",children:(0,t.jsx)(o.A,{className:"w-8 h-8 text-green-600"})}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-astralis-navy mb-2",children:"All caught up!"}),(0,t.jsx)("p",{className:"text-slate-600",children:"There are no unclassified intake items at the moment."})]}),!f&&O.length>0&&(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(e=>(0,t.jsx)(Y,{intake:e,onClick:()=>{c.push("/intakes/".concat(e.id))},availablePipelines:k,onPipelineAssign:T},e.id))})]})})]})})]})}}},e=>{e.O(0,[4909,2619,756,9566,6489,317,4657,3645,4141,5159,7802,9948,8560,1955,3135,4628,8296,3432,207,1101,9336,4007,6011,9248,9084,7358],()=>e(e.s=51533)),_N_E=e.O()}]);