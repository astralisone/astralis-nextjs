(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[44],{2141:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(7756).A)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},11165:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(7756).A)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},17542:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(7756).A)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},33670:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(7756).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},35845:(e,t,s)=>{"use strict";s.d(t,{CT:()=>n,Md:()=>a,Vl:()=>i,lR:()=>r});var a=function(e){return e.FORM="FORM",e.EMAIL="EMAIL",e.CHAT="CHAT",e.API="API",e}({}),r=function(e){return e.NEW="NEW",e.ROUTING="ROUTING",e.ASSIGNED="ASSIGNED",e.PROCESSING="PROCESSING",e.COMPLETED="COMPLETED",e.REJECTED="REJECTED",e}({}),i=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.URGENT=4]="URGENT",e}({}),n=function(e){return e.NOT_STARTED="NOT_STARTED",e.IN_PROGRESS="IN_PROGRESS",e.BLOCKED="BLOCKED",e.COMPLETED="COMPLETED",e.CLOSED="CLOSED",e}({})},42946:(e,t,s)=>{"use strict";s.d(t,{g5:()=>o,tA:()=>c});var a=s(95e3),r=s(72437),i=s(96587),n=s(36700);s(35845);let l={all:["intake"],lists:()=>[...l.all,"list"],list:(e,t)=>[...l.lists(),e,t],details:()=>[...l.all,"detail"],detail:e=>[...l.details(),e],byPipeline:e=>[...l.all,"pipeline",e],unclassified:e=>[...l.all,"unclassified",e]};function o(){var e;let{data:t}=(0,n.useSession)(),s=null==t||null==(e=t.user)?void 0:e.orgId;return(0,a.I)({queryKey:l.unclassified(s||""),queryFn:async()=>{if(!s)throw Error("No organization ID");let e=await fetch("/api/intake?orgId=".concat(s,"&status=NEW"));if(!e.ok)throw Error("Failed to fetch new intake requests");let t=await e.json(),a=await fetch("/api/intake?orgId=".concat(s,"&status=ROUTING"));if(!a.ok)throw Error("Failed to fetch routing intake requests");let r=await a.json(),i=[...t.intakeRequests,...r.intakeRequests].sort((e,t)=>t.priority!==e.priority?t.priority-e.priority:new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());return{intakeRequests:i,counts:{new:t.intakeRequests.length,routing:r.intakeRequests.length,total:i.length}}},enabled:!!s,staleTime:1e4,refetchInterval:3e4})}function c(){var e;let t=(0,r.jE)(),{data:s}=(0,n.useSession)(),a=null==s||null==(e=s.user)?void 0:e.orgId;return(0,i.n)({mutationFn:async e=>{let{intakeId:t,pipelineId:s,stageId:a}=e,r=await fetch("/api/intake/".concat(t,"/assign"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pipelineId:s,stageId:a})});if(!r.ok)throw Error((await r.json()).error||"Failed to assign intake request");return r.json()},onSuccess:(e,s)=>{a&&t.invalidateQueries({queryKey:l.unclassified(a)}),t.invalidateQueries({queryKey:l.all}),t.invalidateQueries({queryKey:["pipeline",s.pipelineId]}),t.invalidateQueries({queryKey:["pipelines"]})}})}},50516:(e,t,s)=>{Promise.resolve().then(s.bind(s,59433))},54069:(e,t,s)=>{"use strict";function a(e){return e instanceof TypeError?{message:"Network error. Please check your connection.",code:"NETWORK_ERROR"}:e instanceof Response?{message:"Request failed with status ".concat(e.status),status:e.status,code:"HTTP_ERROR"}:e&&"object"==typeof e&&"message"in e?{message:String(e.message),status:"status"in e?Number(e.status):void 0,code:"code"in e?String(e.code):void 0,details:"details"in e?e.details:void 0}:e instanceof Error?{message:e.message,code:"UNKNOWN_ERROR"}:{message:"An unexpected error occurred",code:"UNKNOWN_ERROR"}}function r(e,t){new Date().toISOString(),e.message,e.status,e.code,e.details}s.d(t,{_R:()=>a,vV:()=>r})},59433:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eg});var a=s(89407),r=s(73335),i=s(95e3),n=s(36700),l=s(43747),o=s(66279),c=s(42946),d=s(69469),u=s(9924),h=s(71615),p=s(3826),x=s(17542),m=s(2141),g=s(17223),f=s(11165),y=s(221),j=s(79420),b=s(14991),v=s(82868),N=s(40765),w=s(72087),k=s(21732),E=s(85744),S=s(56204),A=s(19380),R=s(95986),C=s(81034),T="Checkbox",[I,O]=(0,w.A)(T),[D,P]=I(T);function q(e){let{__scopeCheckbox:t,checked:s,children:i,defaultChecked:n,disabled:l,form:o,name:c,onCheckedChange:d,required:u,value:h="on",internal_do_not_use_render:p}=e,[x,m]=(0,E.i)({prop:s,defaultProp:null!=n&&n,onChange:d,caller:T}),[g,f]=r.useState(null),[y,j]=r.useState(null),b=r.useRef(!1),v=!g||!!o||!!g.closest("form"),N={checked:x,disabled:l,setChecked:m,control:g,setControl:f,name:c,form:o,value:h,hasConsumerStoppedPropagationRef:b,required:u,defaultChecked:!U(n)&&n,isFormControl:v,bubbleInput:y,setBubbleInput:j};return(0,a.jsx)(D,{scope:t,...N,children:"function"==typeof p?p(N):i})}var M="CheckboxTrigger",F=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,onKeyDown:i,onClick:n,...l}=e,{control:o,value:c,disabled:d,checked:u,required:h,setControl:p,setChecked:x,hasConsumerStoppedPropagationRef:m,isFormControl:g,bubbleInput:f}=P(M,s),y=(0,N.s)(t,p),j=r.useRef(u);return r.useEffect(()=>{let e=null==o?void 0:o.form;if(e){let t=()=>x(j.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[o,x]),(0,a.jsx)(C.sG.button,{type:"button",role:"checkbox","aria-checked":U(u)?"mixed":u,"aria-required":h,"data-state":H(u),"data-disabled":d?"":void 0,disabled:d,value:c,...l,ref:y,onKeyDown:(0,k.mK)(i,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,k.mK)(n,e=>{x(e=>!!U(e)||!e),f&&g&&(m.current=e.isPropagationStopped(),m.current||e.stopPropagation())})})});F.displayName=M;var _=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,name:r,checked:i,defaultChecked:n,required:l,disabled:o,value:c,onCheckedChange:d,form:u,...h}=e;return(0,a.jsx)(q,{__scopeCheckbox:s,checked:i,defaultChecked:n,disabled:o,required:l,onCheckedChange:d,name:r,form:u,value:c,internal_do_not_use_render:e=>{let{isFormControl:r}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F,{...h,ref:t,__scopeCheckbox:s}),r&&(0,a.jsx)(K,{__scopeCheckbox:s})]})}})});_.displayName=T;var L="CheckboxIndicator",G=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,forceMount:r,...i}=e,n=P(L,s);return(0,a.jsx)(R.C,{present:r||U(n.checked)||!0===n.checked,children:(0,a.jsx)(C.sG.span,{"data-state":H(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:t,style:{pointerEvents:"none",...e.style}})})});G.displayName=L;var z="CheckboxBubbleInput",K=r.forwardRef((e,t)=>{let{__scopeCheckbox:s,...i}=e,{control:n,hasConsumerStoppedPropagationRef:l,checked:o,defaultChecked:c,required:d,disabled:u,name:h,value:p,form:x,bubbleInput:m,setBubbleInput:g}=P(z,s),f=(0,N.s)(t,g),y=(0,S.Z)(o),j=(0,A.X)(n);r.useEffect(()=>{if(!m)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!l.current;if(y!==o&&e){let s=new Event("click",{bubbles:t});m.indeterminate=U(o),e.call(m,!U(o)&&o),m.dispatchEvent(s)}},[m,y,o,l]);let b=r.useRef(!U(o)&&o);return(0,a.jsx)(C.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=c?c:b.current,required:d,disabled:u,name:h,value:p,form:x,...i,tabIndex:-1,ref:f,style:{...i.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function U(e){return"indeterminate"===e}function H(e){return U(e)?"indeterminate":e?"checked":"unchecked"}K.displayName=z;var V=s(18814),J=s(45741);let W=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(_,{ref:t,className:(0,J.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-slate-300 ring-offset-white","transition-all duration-150 ease-out","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-astralis-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-astralis-blue data-[state=checked]:border-astralis-blue data-[state=checked]:text-white","data-[state=indeterminate]:bg-astralis-blue data-[state=indeterminate]:border-astralis-blue data-[state=indeterminate]:text-white",s),...r,children:(0,a.jsx)(G,{className:(0,J.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})})});W.displayName=_.displayName;var Q=s(70558),$=s(99570);let B={NEW:"bg-blue-100 text-blue-700",ROUTING:"bg-yellow-100 text-yellow-700",ASSIGNED:"bg-purple-100 text-purple-700",PROCESSING:"bg-orange-100 text-orange-700",COMPLETED:"bg-green-100 text-green-700",REJECTED:"bg-red-100 text-red-700"},X={FORM:"bg-slate-100 text-slate-700",EMAIL:"bg-blue-100 text-blue-700",CHAT:"bg-purple-100 text-purple-700",API:"bg-green-100 text-green-700"},Z={FORM:{icon:x.A,className:"text-purple-600"},EMAIL:{icon:m.A,className:"text-blue-600"},CHAT:{icon:g.A,className:"text-green-600"},API:{icon:f.A,className:"text-orange-600"}};function Y(e){let{requests:t,pipelines:s=[],onAssignToPipeline:i,assigningIntakeId:n,onDeleteSingle:l,onDeleteBulk:o}=e,[c,x]=(0,r.useState)("createdAt"),[m,g]=(0,r.useState)("desc"),[f,N]=(0,r.useState)(new Set),[w,k]=(0,r.useState)(!1),[E,S]=(0,r.useState)("single"),[A,R]=(0,r.useState)(null),[C,T]=(0,r.useState)(!1),I=s.length>0&&i,O=e=>{c===e?g("asc"===m?"desc":"asc"):(x(e),g("asc"))},D=(0,r.useMemo)(()=>[...t].sort((e,t)=>{let s=0;switch(c){case"title":s=e.title.localeCompare(t.title);break;case"source":s=e.source.localeCompare(t.source);break;case"status":s=e.status.localeCompare(t.status);break;case"priority":s=e.priority-t.priority;break;case"createdAt":s=new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()}return"asc"===m?s:-s}),[t,c,m]),P=e=>{let{column:t}=e;return c!==t?null:"asc"===m?(0,a.jsx)(y.A,{className:"w-3 h-3 inline-block ml-1"}):(0,a.jsx)(j.A,{className:"w-3 h-3 inline-block ml-1"})},q=async()=>{T(!0);try{"single"===E&&A&&l?await l(A):"bulk"===E&&o&&(await o(Array.from(f)),N(new Set))}finally{T(!1),k(!1),R(null)}},M=D.length>0&&f.size===D.length,F=f.size>0&&f.size<D.length,_="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors duration-150 select-none";return(0,a.jsxs)(a.Fragment,{children:[f.size>0&&(0,a.jsxs)("div",{className:"mb-4 p-3 bg-slate-100 rounded-lg flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm text-slate-600",children:[f.size," item",f.size>1?"s":""," selected"]}),(0,a.jsxs)(Q.$,{variant:"destructive",size:"sm",onClick:()=>{S("bulk"),k(!0)},disabled:!o,children:[(0,a.jsx)(b.A,{className:"w-4 h-4 mr-2"}),"Delete Selected"]})]}),(0,a.jsx)(u.Zp,{variant:"default",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-slate-50 border-b border-slate-200",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left",children:(0,a.jsx)(W,{checked:M,"data-state":F?"indeterminate":M?"checked":"unchecked",onCheckedChange:e=>{e?N(new Set(D.map(e=>e.id))):N(new Set)},"aria-label":"Select all"})}),(0,a.jsxs)("th",{className:_,onClick:()=>O("title"),children:["Title",(0,a.jsx)(P,{column:"title"})]}),(0,a.jsxs)("th",{className:_,onClick:()=>O("source"),children:["Source",(0,a.jsx)(P,{column:"source"})]}),(0,a.jsxs)("th",{className:_,onClick:()=>O("status"),children:["Status",(0,a.jsx)(P,{column:"status"})]}),(0,a.jsxs)("th",{className:_,onClick:()=>O("priority"),children:["Priority",(0,a.jsx)(P,{column:"priority"})]}),(0,a.jsxs)("th",{className:_,onClick:()=>O("createdAt"),children:["Created",(0,a.jsx)(P,{column:"createdAt"})]}),I&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Pipeline"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-slate-200",children:[D.map((e,t)=>{var r;return(0,a.jsxs)("tr",{className:"hover:bg-slate-100 cursor-pointer transition-colors duration-150 ".concat(t%2==0?"bg-white":"bg-slate-50"),children:[(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsx)(W,{checked:f.has(e.id),onCheckedChange:t=>((e,t)=>{let s=new Set(f);t?s.add(e):s.delete(e),N(s)})(e.id,!!t),"aria-label":"Select ".concat(e.title),onClick:e=>e.stopPropagation()})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{let t=Z[e];if(!t)return null;let s=t.icon;return(0,a.jsx)(s,{className:"w-4 h-4 flex-shrink-0 ".concat(t.className)})})(e.source),(0,a.jsx)("span",{className:"text-sm font-medium text-astralis-navy",children:e.title})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)(h.E,{className:X[e.source],children:e.source})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)(h.E,{className:B[e.status],children:e.status})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500",children:["P",e.priority]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-500",children:(0,d.GP)(new Date(e.createdAt),"MMM d, yyyy")}),I&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)(p.l6,{value:e.assignedPipeline||(null==(r=e.pipeline)?void 0:r.id)||"",onValueChange:t=>{var s;return s=e.id,void(i&&i(s,t))},disabled:n===e.id,children:[(0,a.jsx)(p.bq,{className:"h-9 w-[200px] text-sm",children:n===e.id?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Assigning..."})]}):(0,a.jsx)(p.yv,{placeholder:"Select pipeline..."})}),(0,a.jsx)(p.gC,{children:s.map(e=>(0,a.jsx)(p.eb,{value:e.id,className:"text-sm",children:e.name},e.id))})]})}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsx)(Q.$,{variant:"ghost",size:"icon",onClick:t=>{t.stopPropagation(),R(e.id),S("single"),k(!0)},className:"h-8 w-8 text-slate-400 hover:text-red-600 hover:bg-red-50",disabled:!l,children:(0,a.jsx)(b.A,{className:"w-4 h-4"})})})]},e.id)}),0===D.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:I?8:7,className:"px-6 py-12 text-center text-slate-500",children:"No intake requests found"})})]})]})})}),(0,a.jsx)($.Lt,{open:w,onOpenChange:k,children:(0,a.jsxs)($.EO,{children:[(0,a.jsxs)($.wd,{children:[(0,a.jsx)($.r7,{children:"single"===E?"Delete Intake Request":"Delete ".concat(f.size," Intake Request").concat(f.size>1?"s":"")}),(0,a.jsxs)($.$v,{children:["This action cannot be undone. This will permanently delete the intake request","bulk"===E&&f.size>1?"s":""," and all related data from the system."]})]}),(0,a.jsxs)($.ck,{children:[(0,a.jsx)($.Zr,{disabled:C,children:"Cancel"}),(0,a.jsx)($.Rx,{onClick:q,disabled:C,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:C?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}var ee=s(27739),et=s(19981),es=s(39009),ea=s(74874),er=s(2550),ei=s(34876),en=s(3e4),el=s(60412),eo=s(72437),ec=s(96587),ed=s(54069);let eu=es.Ik({title:es.Yj().min(2,"Title must be at least 2 characters"),description:es.Yj().optional(),source:es.k5(["FORM","EMAIL","CHAT","API"]),priority:es.au.number().int().min(0).max(10)});function eh(e){let{open:t,onOpenChange:s,onSuccess:i}=e,{data:o}=(0,n.useSession)(),c=function(){let e=(0,eo.jE)();return(0,ec.n)({mutationFn:async e=>{let t=await fetch("/api/intake",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw{...await t.json().catch(()=>({})),status:t.status};return t.json()},onSuccess:(t,s)=>{e.invalidateQueries({queryKey:l.Ni.list(s.orgId)}),e.invalidateQueries({queryKey:l.Ni.stats(s.orgId)})},onError:e=>{let t=(0,ed._R)(e);(0,ed.vV)(t,"useCreateIntake")}})}(),[d,u]=(0,r.useState)(null),[h,x]=(0,r.useState)("FORM"),{register:m,handleSubmit:g,formState:{errors:f},reset:y,setValue:j}=(0,ee.mN)({resolver:(0,et.u)(eu),defaultValues:{source:"FORM",priority:0}}),b=async e=>{var t;if(!(null==o||null==(t=o.user)?void 0:t.orgId))return void u("Organization ID not found. Please sign in again.");u(null);try{await c.mutateAsync({title:e.title,description:e.description,source:e.source,priority:e.priority,requestData:{createdBy:o.user.email,createdAt:new Date().toISOString()},orgId:o.user.orgId}),y(),x("FORM"),s(!1),null==i||i()}catch(e){u(e instanceof Error?e.message:"Failed to create intake request")}},v=()=>{c.isPending||(y(),x("FORM"),u(null),s(!1))};return(0,a.jsx)(ea.lG,{open:t,onOpenChange:v,children:(0,a.jsxs)(ea.Cf,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(ea.c7,{children:(0,a.jsx)(ea.L3,{children:"Create New Intake Request"})}),(0,a.jsxs)("form",{onSubmit:g(b),className:"space-y-4",children:[d&&(0,a.jsx)(el.Fc,{variant:"error",children:(0,a.jsx)(el.TN,{children:d})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(ei.J,{htmlFor:"title",children:["Request Title ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)(er.p,{id:"title",placeholder:"e.g., New Customer Support Request",...m("title"),disabled:c.isPending}),f.title&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:f.title.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ei.J,{htmlFor:"description",children:"Description (optional)"}),(0,a.jsx)(en.T,{id:"description",placeholder:"Provide additional details about the request...",rows:4,...m("description"),disabled:c.isPending}),f.description&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:f.description.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(ei.J,{htmlFor:"source",children:["Source ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)(p.l6,{value:h,onValueChange:e=>{x(e),j("source",e)},disabled:c.isPending,children:[(0,a.jsx)(p.bq,{children:(0,a.jsx)(p.yv,{placeholder:"Select source"})}),(0,a.jsxs)(p.gC,{children:[(0,a.jsx)(p.eb,{value:"FORM",children:"Form Submission"}),(0,a.jsx)(p.eb,{value:"EMAIL",children:"Email"}),(0,a.jsx)(p.eb,{value:"CHAT",children:"Chat"}),(0,a.jsx)(p.eb,{value:"API",children:"API"})]})]}),f.source&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:f.source.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ei.J,{htmlFor:"priority",children:"Priority (0-10)"}),(0,a.jsx)(er.p,{id:"priority",type:"number",min:"0",max:"10",defaultValue:"0",...m("priority",{valueAsNumber:!0}),disabled:c.isPending}),f.priority&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:f.priority.message})]}),(0,a.jsxs)(ea.Es,{children:[(0,a.jsx)(Q.$,{type:"button",variant:"outline",onClick:v,disabled:c.isPending,children:"Cancel"}),(0,a.jsx)(Q.$,{type:"submit",variant:"primary",disabled:c.isPending,children:c.isPending?"Creating...":"Create Request"})]})]})]})})}var ep=s(33670),ex=s(14154),em=s(90885);function eg(){let[e,t]=(0,r.useState)(!1),[s,d]=(0,r.useState)({}),[u,h]=(0,r.useState)(null),[p,x]=(0,r.useState)(""),[m,g]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=setTimeout(()=>{g(p)},300);return()=>clearTimeout(e)},[p]);let{data:f,isLoading:y,error:j,refetch:b}=function(e){var t;let{data:s}=(0,n.useSession)(),a=null==s||null==(t=s.user)?void 0:t.orgId,r=new URLSearchParams({orgId:a||"",...(null==e?void 0:e.status)&&{status:e.status},...(null==e?void 0:e.source)&&{source:e.source},...(null==e?void 0:e.limit)&&{limit:e.limit.toString()},...(null==e?void 0:e.offset)&&{offset:e.offset.toString()}});return(0,i.I)({queryKey:a?l.Ni.list(a,e):["intake"],queryFn:async()=>{if(!a)throw Error("No organization ID");let e=await fetch("/api/intake?".concat(r));if(!e.ok)throw Error("Failed to fetch intake requests");let t=await e.json();return{requests:t.intakeRequests,total:t.pagination.total}},enabled:!!a,staleTime:1e4})}(s),v=(0,r.useMemo)(()=>{let e=(null==f?void 0:f.requests)||[];if(!m.trim())return e;let t=m.toLowerCase();return e.filter(e=>e.title.toLowerCase().includes(t))},[null==f?void 0:f.requests,m]),{data:N}=(0,o.be)(),w=(0,c.tA)(),k=(N||[]).filter(e=>e.isActive&&e.stages&&e.stages.length>0).map(e=>({id:e.id,name:e.name})),E=async(e,t)=>{h(e);try{let s=await w.mutateAsync({intakeId:e,pipelineId:t});(0,em.oR)({title:"Intake Assigned",description:s.message||"Successfully assigned intake to pipeline"}),b()}catch(e){(0,em.oR)({title:"Assignment Failed",description:e instanceof Error?e.message:"Failed to assign intake to pipeline",variant:"destructive"})}finally{h(null)}},S=async e=>{try{let t=await fetch("/api/intake/".concat(e),{method:"DELETE"});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete intake request")}(0,em.oR)({title:"Deleted",description:"Intake request has been deleted"}),b()}catch(e){throw(0,em.oR)({title:"Error",description:e instanceof Error?e.message:"Failed to delete intake request",variant:"destructive"}),e}},A=async e=>{try{let t=await fetch("/api/intake/bulk",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e,action:"delete"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to delete intake requests")}let s=await t.json();(0,em.oR)({title:"Deleted",description:"".concat(s.deletedCount||e.length," intake request").concat(e.length>1?"s":""," deleted")}),b()}catch(e){throw(0,em.oR)({title:"Error",description:e instanceof Error?e.message:"Failed to delete intake requests",variant:"destructive"}),e}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-astralis-navy",children:"Intake Queue"}),(0,a.jsx)("p",{className:"text-slate-600 mt-1",children:"Review and route incoming requests"})]}),(0,a.jsxs)(Q.$,{variant:"primary",className:"gap-2",onClick:()=>t(!0),children:[(0,a.jsx)(ep.A,{className:"w-5 h-5"}),"New Request"]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(ex.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,a.jsx)(er.p,{type:"text",placeholder:"Search requests by title...",value:p,onChange:e=>x(e.target.value),className:"pl-12 w-full"})]}),y?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-astralis-blue"})}):j?(0,a.jsx)("div",{className:"text-center py-12 text-red-600",children:"Failed to load intake requests"}):(0,a.jsx)(Y,{requests:v,pipelines:k,onAssignToPipeline:E,assigningIntakeId:u,onDeleteSingle:S,onDeleteBulk:A})]}),(0,a.jsx)(eh,{open:e,onOpenChange:t,onSuccess:()=>{b()}})]})}},60412:(e,t,s)=>{"use strict";s.d(t,{Fc:()=>p,TN:()=>m,XL:()=>x});var a=s(89407),r=s(73335),i=s(83183),n=s(98570),l=s(71287),o=s(22635),c=s(92405),d=s(45741);let u=(0,i.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-white border-slate-300 text-slate-900",success:"border-green-500/50 bg-green-50 text-green-900 [&>svg]:text-green-600",error:"border-red-500/50 bg-red-50 text-red-900 [&>svg]:text-red-600",warning:"border-yellow-500/50 bg-yellow-50 text-yellow-900 [&>svg]:text-yellow-600",info:"border-blue-500/50 bg-blue-50 text-blue-900 [&>svg]:text-astralis-blue"}},defaultVariants:{variant:"default"}}),h={default:n.A,success:l.A,error:o.A,warning:c.A,info:n.A},p=r.forwardRef((e,t)=>{let{className:s,variant:r="default",showIcon:i=!1,children:n,...l}=e,o=h[r||"default"];return(0,a.jsxs)("div",{ref:t,role:"alert",className:(0,d.cn)(u({variant:r}),s),...l,children:[i&&(0,a.jsx)(o,{className:"h-4 w-4"}),n]})});p.displayName="Alert";let x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h5",{ref:t,className:(0,d.cn)("mb-1 font-semibold leading-none tracking-tight",s),...r})});x.displayName="AlertTitle";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,d.cn)("text-sm [&_p]:leading-relaxed",s),...r})});m.displayName="AlertDescription"},90885:(e,t,s)=>{"use strict";s.d(t,{oR:()=>c}),s(73335);let a=0,r=new Map,i=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),o({type:"REMOVE_TOAST",toastId:e})},5e3);r.set(e,t)},n=[],l={toasts:[]};function o(e){l=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,3)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,onOpenChange:t=>{t||i(e.id)}}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(l,e),n.forEach(e=>{e(l)})}function c(e){let t=(a=(a+1)%Number.MAX_VALUE).toString(),s=()=>o({type:"DISMISS_TOAST",toastId:t});return o({type:"ADD_TOAST",toast:{...e,id:t,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:t}})}}}},e=>{e.O(0,[7232,6947,8586,6700,3053,7525,5260,8164,9981,460,5478,8360,7408,5187,3733,7780,3080,3468,2079,8385,5186,400,4276,2006,7358],()=>e(e.s=50516)),_N_E=e.O()}]);