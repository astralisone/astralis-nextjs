"use strict";exports.id=2381,exports.ids=[2381],exports.modules={10455:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$r:()=>k,BN:()=>j});var e=c(74983),f=c(37357),g=c(30504),h=c(61083),i=a([e]);e=(i.then?(await i)():i)[0];let l=new Map,m=null,n={debug:(a,b)=>{},info:(a,b)=>{console.info(`[Agent] ${a}`,b||"")},warn:(a,b)=>{console.warn(`[Agent] ${a}`,b||"")},error:(a,b,c)=>{console.error(`[Agent] ${a}`,b,c||"")}};function j(a,b){let c=l.get(a);return c||(c=function(a,b={}){var c;let{llmProvider:d=h.Dd.CLAUDE,llmModel:f=d===h.Dd.CLAUDE?"claude-sonnet-4-20250514":"gpt-4-turbo",temperature:g=.3,maxTokens:i=2e3,autoExecuteThreshold:j=.85,requireApprovalThreshold:k=.5,enabledActions:l=Object.values(h.PS),escalationEmail:m=(c="admin@localhost","undefined"!=typeof process&&process.env?process.env.AGENT_ESCALATION_EMAIL??c:c),notifyOnHighPriority:o=!0,notifyOnFailure:p=!0,maxActionsPerMinute:q=60,maxActionsPerHour:r=500,systemPrompt:s,logger:t=n}=b;return t.info("Creating agent for organization",{orgId:a,llmProvider:d,llmModel:f}),(0,e.Dy)({orgId:a,llmProvider:d,llmModel:f,temperature:g,maxTokens:i,autoExecuteThreshold:j,requireApprovalThreshold:k,enabledActions:l,escalationEmail:m,notifyOnHighPriority:o,notifyOnFailure:p,maxActionsPerMinute:q,maxActionsPerHour:r,systemPrompt:s,logger:t})}(a,b),l.set(a,c)),c}async function k(a={}){let{enableWebhooks:b=!0,enableEmail:c=!0,enableDBTriggers:d=!1,enableWorkerEvents:e=!1,eventBusConfig:h={},logger:i=n}=a;i.info("Initializing agent system",{enableWebhooks:b,enableEmail:c,enableDBTriggers:d,enableWorkerEvents:e});let j=f.io.getInstance({historySize:h.historySize??1e3,debug:h.debug??!1,defaultOrgId:h.defaultOrgId,logger:i}),l={};b&&(l.webhook=(0,f.su)({eventBus:j,logger:i}),i.debug("Webhook handler initialized")),c&&(l.email=new f.L_({eventBus:j,logger:i}),i.debug("Email handler initialized")),d&&(l.dbTrigger=new f.nM({eventBus:j,logger:i}),i.debug("DB trigger handler initialized")),e&&(l.workerEvent=new f.v_({eventBus:j,logger:i}),i.debug("Worker event handler initialized"));let o={};return o.notificationDispatcher=g.Pc,o.automationTrigger=(0,g.w4)(),m={eventBus:j,handlers:l,actions:o,initialized:!0},i.info("Agent system initialized successfully"),m}d()}catch(a){d(a)}})},48625:(a,b,c)=>{c.d(b,{z:()=>e});var d=c(96330);let e=globalThis.prisma??new d.PrismaClient({log:["error","warn"]})},58046:(a,b,c)=>{c.d(b,{$n:()=>f});var d=c(37289);async function e(a,b,c){let e=d.io.getInstance();await e.emit(a,b,{source:"system",correlationId:c?.correlationId,orgId:c?.orgId,metadata:c?.metadata})}async function f(a,b){await e("task:created",{taskId:a.id,orgId:a.orgId,source:a.source,type:a.type,category:a.category,priority:a.priority},b)}},61083:(a,b,c)=>{c.d(b,{Dd:()=>d.Dd,PS:()=>d.PS});var d=c(70609)},61215:(a,b,c)=>{var d=c(55511)},70609:(a,b,c)=>{c.d(b,{Dd:()=>f,HA:()=>u,Ls:()=>t,MU:()=>p,OE:()=>l,PS:()=>h,VN:()=>j,W9:()=>q,n$:()=>e,nm:()=>g,qx:()=>k,tc:()=>i,uE:()=>n,v3:()=>m,yI:()=>o,z3:()=>r});var d=c(16885);let e=d.Ik({role:d.k5(["system","user","assistant"]),content:d.Yj(),name:d.Yj().optional()});var f=function(a){return a.OPENAI="OPENAI",a.CLAUDE="CLAUDE",a}({}),g=function(a){return a.EMAIL="EMAIL",a.WEBHOOK="WEBHOOK",a.DB_TRIGGER="DB_TRIGGER",a.WORKER="WORKER",a.API="API",a.SCHEDULE="SCHEDULE",a}({}),h=function(a){return a.ASSIGN_PIPELINE="ASSIGN_PIPELINE",a.CREATE_TASK="CREATE_TASK",a.CREATE_EVENT="CREATE_EVENT",a.UPDATE_EVENT="UPDATE_EVENT",a.CANCEL_EVENT="CANCEL_EVENT",a.SEND_NOTIFICATION="SEND_NOTIFICATION",a.TRIGGER_AUTOMATION="TRIGGER_AUTOMATION",a.ESCALATE="ESCALATE",a.NO_ACTION="NO_ACTION",a}({}),i=function(a){return a.PENDING="PENDING",a.EXECUTED="EXECUTED",a.FAILED="FAILED",a.REJECTED="REJECTED",a.REQUIRES_APPROVAL="REQUIRES_APPROVAL",a}({});let j={maxRetries:3,retryBaseDelay:1e3};class k extends Error{constructor(a,b,c,d,e=!1,f){super(a),this.code=b,this.provider=c,this.statusCode=d,this.retryable=e,this.originalError=f,this.name="LLMError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,k)}}class l extends k{constructor(a,b,c,d){super(a,"RATE_LIMIT_EXCEEDED",b,429,!0,d),this.retryAfterMs=c,this.name="RateLimitError"}}class m extends k{constructor(a,b,c){super(a,"AUTHENTICATION_FAILED",b,401,!1,c),this.name="AuthenticationError"}}class n extends k{constructor(a,b){super(`API key not configured for ${a}. Please set the appropriate environment variable.`,"API_KEY_MISSING",a,void 0,!1,b),this.name="APIKeyError"}}class o extends k{constructor(a,b,c){super(a,"VALIDATION_FAILED",b,400,!1),this.validationErrors=c,this.name="ValidationError"}}class p extends k{constructor(a,b,c){super(`Request timed out after ${b}ms`,"TIMEOUT",a,408,!0,c),this.name="TimeoutError"}}class q extends k{constructor(a,b,c){super(a,"CONTENT_FILTERED",b,400,!1,c),this.name="ContentFilterError"}}class r extends k{constructor(a,b,c){super(`${a} model is currently overloaded. Please retry later.`,"MODEL_OVERLOADED",a,503,!0,c),this.retryAfterMs=b,this.name="ModelOverloadedError"}}d.Ik({source:d.fc(g),type:d.Yj().min(1),rawContent:d.Yj(),structuredData:d.g1(d.L5()).optional(),metadata:d.Ik({senderEmail:d.Yj().email().optional(),senderName:d.Yj().optional(),ipAddress:d.Yj().optional(),userAgent:d.Yj().optional(),webhookSignature:d.Yj().optional(),headers:d.g1(d.Yj()).optional(),relatedEntityIds:d.g1(d.Yj()).optional(),priorityHint:d.ai().int().min(1).max(5).optional(),tags:d.YO(d.Yj()).optional()}).optional(),timestamp:d.p6(),correlationId:d.Yj().optional()}),d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),urgency:d.ai().int().min(1).max(5),keywords:d.YO(d.Yj()),entities:d.YO(d.Ik({type:d.Yj(),value:d.Yj(),confidence:d.ai().min(0).max(1),position:d.Ik({start:d.ai(),end:d.ai()}).optional()})),subIntent:d.Yj().optional(),sentiment:d.k5(["positive","neutral","negative"]).optional()});let s=d.Ik({type:d.fc(h),params:d.g1(d.L5()),priority:d.ai().int().min(1).max(5),requiresConfirmation:d.zM(),delayMs:d.ai().int().positive().optional(),condition:d.Ik({type:d.k5(["time_range","user_available","slot_available","custom"]),params:d.g1(d.L5())}).optional()});d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),reasoning:d.Yj(),actions:d.YO(s),requiresApproval:d.zM(),priority:d.ai().int().min(1).max(5).optional(),warnings:d.YO(d.Yj()).optional(),alternatives:d.YO(d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),reason:d.Yj()})).optional()});let t={temperature:.3,maxTokens:2e3,timeout:3e4},u={temperature:.3,autoExecuteThreshold:.85,requireApprovalThreshold:.5,maxActionsPerMinute:60,maxActionsPerHour:500}},79832:(a,b,c)=>{var d=c(83367);let e=new(c(37659)).Redis(process.env.REDIS_URL||"redis://localhost:6379",{maxRetriesPerRequest:null,enableReadyCheck:!1,retryStrategy:a=>Math.min(50*a,2e3)});e.on("error",a=>{console.error("[Redis] Connection error:",a)}),e.on("connect",()=>{console.log("[Redis] Connected successfully")}),e.on("ready",()=>{console.log("[Redis] Ready to accept commands")}),e.on("close",()=>{console.log("[Redis] Connection closed")}),e.on("reconnecting",()=>{console.log("[Redis] Reconnecting...")}),new d.Queue("scheduling-reminders",{connection:e,defaultJobOptions:{attempts:3,backoff:{type:"exponential",delay:2e3},removeOnComplete:{age:604800,count:500},removeOnFail:{age:1209600}}})}};