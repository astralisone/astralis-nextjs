(()=>{var a={};a.id=6282,a.ids=[6282],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37720:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>M,patchFetch:()=>L,routeModule:()=>H,serverHooks:()=>K,workAsyncStorage:()=>I,workUnitAsyncStorage:()=>J});var d={};c.r(d),c.d(d,{GET:()=>G,POST:()=>F});var e=c(27192),f=c(91165),g=c(20972),h=c(97182),i=c(9060),j=c(261),k=c(40306),l=c(43568),m=c(43376),n=c(81827),o=c(7293),p=c(45135),q=c(23857),r=c(99510),s=c(86439),t=c(27196),u=c(90449),v=c(55511),w=c.n(v),x=c(75625),y=c(29407),z=c(59214);let A=process.env.N8N_WEBHOOK_SECRET||"",B=process.env.DEFAULT_ORG_ID||"",C={info:(a,b)=>{console.info(`[Automation Callback] ${a}`,b??"")},warn:(a,b)=>{console.warn(`[Automation Callback] ${a}`,b??"")},error:(a,b,c)=>{console.error(`[Automation Callback] ${a}`,b,c??"")}},D=x.Ik({executionId:x.Yj().min(1,"executionId is required"),workflowId:x.Yj().min(1,"workflowId is required"),status:x.k5(["success","error","running","waiting","cancelled"]),data:x.g1(x.L5()).optional(),error:x.Ik({message:x.Yj(),code:x.Yj().optional(),stack:x.Yj().optional()}).optional(),startedAt:x.Yj().optional(),finishedAt:x.Yj().optional(),executionTimeMs:x.ai().optional(),workflowName:x.Yj().optional(),mode:x.k5(["trigger","webhook","manual","scheduled"]).optional(),retryCount:x.ai().optional(),context:x.Ik({orgId:x.Yj().optional(),userId:x.Yj().optional(),correlationId:x.Yj().optional(),sourceEvent:x.Yj().optional(),metadata:x.g1(x.L5()).optional()}).optional()});async function E(a,b){let{status:c,workflowId:d,data:e,context:f}=a;if("success"!==c||!e)return;let g=e.followUpActions;if(!g||!Array.isArray(g))return;C.info("Processing follow-up actions",{workflowId:d,actionCount:g.length,correlationId:b});let h=(0,y.Ju)();for(let a of g)try{switch(a.type){case"send_notification":await h.emit("webhook:callback_received",{id:w().randomUUID(),timestamp:new Date,source:z.nm.WORKER,orgId:f?.orgId,metadata:{correlationId:b,sourceWorkflowId:d,actionType:a.type},...a.params});break;case"create_intake":await h.emit("intake:created",{id:w().randomUUID(),timestamp:new Date,source:z.nm.WORKER,orgId:f?.orgId,intakeId:w().randomUUID(),type:"automation_followup",data:a.params,metadata:{correlationId:b,sourceWorkflowId:d}});break;case"schedule_event":await h.emit("calendar:event_created",{id:w().randomUUID(),timestamp:new Date,source:z.nm.WORKER,orgId:f?.orgId,metadata:{correlationId:b,sourceWorkflowId:d,actionType:a.type,eventData:a.params}});break;default:C.warn("Unknown follow-up action type",{actionType:a.type,correlationId:b})}}catch(c){C.error("Failed to process follow-up action",c,{actionType:a.type,correlationId:b})}}async function F(a){let b=Date.now(),c=w().randomUUID();C.info("Received automation callback",{correlationId:c});try{let d,e=await a.text();if(!e)return C.warn("Empty request body",{correlationId:c}),u.NextResponse.json({error:"Bad Request",details:"Empty request body"},{status:400});let f=a.headers.get("X-Webhook-Signature")||a.headers.get("x-webhook-signature")||"",g=a.headers.get("X-Webhook-Timestamp")||a.headers.get("x-webhook-timestamp")||"",h=function(a,b,c){if(!A)return C.warn("N8N_WEBHOOK_SECRET not configured, skipping signature verification"),{valid:!0};if(!a||!b)return{valid:!1,error:"Missing signature or timestamp"};let d=1e3*parseInt(b,10),e=Date.now();if(isNaN(d)||Math.abs(e-d)>3e5)return{valid:!1,error:"Timestamp outside validity window"};let f=`${b}.${c}`,g=w().createHmac("sha256",A).update(f).digest("hex");try{let b=Buffer.from(a),c=Buffer.from(g);if(b.length!==c.length)return{valid:!1,error:"Invalid signature length"};let d=w().timingSafeEqual(b,c);return{valid:d,error:d?void 0:"Invalid signature"}}catch(a){return{valid:!1,error:"Signature comparison error"}}}(f,g,e);if(!h.valid)return C.warn("Signature verification failed",{error:h.error,correlationId:c}),u.NextResponse.json({error:"Unauthorized",details:h.error},{status:401});try{d=JSON.parse(e)}catch(a){return C.error("Failed to parse JSON",a,{correlationId:c}),u.NextResponse.json({error:"Bad Request",details:"Invalid JSON payload"},{status:400})}let i=D.safeParse(d);if(!i.success)return C.warn("Payload validation failed",{errors:i.error.errors,correlationId:c}),u.NextResponse.json({error:"Bad Request",details:"Invalid payload structure",validationErrors:i.error.errors.map(a=>({path:a.path.join("."),message:a.message}))},{status:400});let j=i.data,k=j.context?.correlationId||c;C.info("Processing automation callback",{executionId:j.executionId,workflowId:j.workflowId,status:j.status,correlationId:k});let l=j.context?.orgId||B,m=function(a){switch(a){case"success":return"automation:completed";case"error":case"cancelled":return"automation:failed";default:return"automation:triggered"}}(j.status);try{await (0,y.T$)(m,{id:j.executionId,timestamp:new Date,source:z.nm.WORKER,orgId:l,workflowId:j.workflowId,workflowName:j.workflowName||"Unknown Workflow",status:j.status,executionTime:j.executionTimeMs||0,result:j.data,error:j.error?.message,metadata:{correlationId:k,mode:j.mode,retryCount:j.retryCount,startedAt:j.startedAt,finishedAt:j.finishedAt,context:j.context}}),C.info("Emitted automation event",{eventType:m,executionId:j.executionId,correlationId:k})}catch(a){C.error("Failed to emit event",a,{eventType:m,executionId:j.executionId,correlationId:k})}E(j,k).catch(a=>{C.error("Follow-up action processing failed",a,{correlationId:k})});let n=Date.now()-b;return u.NextResponse.json({success:!0,correlationId:k,executionId:j.executionId,workflowId:j.workflowId,status:"acknowledged",eventEmitted:m,processingTimeMs:n},{status:200})}catch(a){return C.error("Error processing automation callback",a,{correlationId:c}),u.NextResponse.json({error:"Internal Server Error",correlationId:c,details:a instanceof Error?a.message:"Unknown error"},{status:500})}}async function G(){return u.NextResponse.json({success:!0,service:"automation-callback-webhook",status:"active",timestamp:new Date().toISOString(),description:"Receives n8n workflow completion callbacks",expectedPayload:{executionId:"string (required)",workflowId:"string (required)",status:"'success' | 'error' | 'running' | 'waiting' | 'cancelled' (required)",data:"Record<string, unknown> (optional)",error:"{ message: string, code?: string } (optional)",context:"{ orgId?, userId?, correlationId?, sourceEvent?, metadata? } (optional)"},config:{signatureVerification:!!A,defaultOrgConfigured:!!B}})}let H=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/webhooks/automation/route",pathname:"/api/webhooks/automation",filename:"route",bundlePath:"app/api/webhooks/automation/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/gadmin/Projects/astralis-nextjs/src/app/api/webhooks/automation/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:I,workUnitAsyncStorage:J,serverHooks:K}=H;function L(){return(0,g.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:J})}async function M(a,b,c){var d;let e="/api/webhooks/automation/route";"/index"===e&&(e="/");let g=await H.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||H.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===H.isDev||!E,I=E&&!G,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>H.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>H.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await H.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})},z),b}},l=await H.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await H.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{"use strict";a.exports=require("crypto")},56931:()=>{},59214:(a,b,c)=>{"use strict";c.d(b,{Dd:()=>f,HA:()=>u,Ls:()=>t,MU:()=>p,OE:()=>l,PS:()=>h,VN:()=>j,W9:()=>q,n$:()=>e,nm:()=>g,qx:()=>k,tc:()=>i,uE:()=>n,v3:()=>m,yI:()=>o,z3:()=>r});var d=c(75625);let e=d.Ik({role:d.k5(["system","user","assistant"]),content:d.Yj(),name:d.Yj().optional()});var f=function(a){return a.OPENAI="OPENAI",a.CLAUDE="CLAUDE",a}({}),g=function(a){return a.EMAIL="EMAIL",a.WEBHOOK="WEBHOOK",a.DB_TRIGGER="DB_TRIGGER",a.WORKER="WORKER",a.API="API",a.SCHEDULE="SCHEDULE",a}({}),h=function(a){return a.ASSIGN_PIPELINE="ASSIGN_PIPELINE",a.CREATE_TASK="CREATE_TASK",a.CREATE_EVENT="CREATE_EVENT",a.UPDATE_EVENT="UPDATE_EVENT",a.CANCEL_EVENT="CANCEL_EVENT",a.SEND_NOTIFICATION="SEND_NOTIFICATION",a.TRIGGER_AUTOMATION="TRIGGER_AUTOMATION",a.ESCALATE="ESCALATE",a.NO_ACTION="NO_ACTION",a}({}),i=function(a){return a.PENDING="PENDING",a.EXECUTED="EXECUTED",a.FAILED="FAILED",a.REJECTED="REJECTED",a.REQUIRES_APPROVAL="REQUIRES_APPROVAL",a}({});let j={maxRetries:3,retryBaseDelay:1e3};class k extends Error{constructor(a,b,c,d,e=!1,f){super(a),this.code=b,this.provider=c,this.statusCode=d,this.retryable=e,this.originalError=f,this.name="LLMError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,k)}}class l extends k{constructor(a,b,c,d){super(a,"RATE_LIMIT_EXCEEDED",b,429,!0,d),this.retryAfterMs=c,this.name="RateLimitError"}}class m extends k{constructor(a,b,c){super(a,"AUTHENTICATION_FAILED",b,401,!1,c),this.name="AuthenticationError"}}class n extends k{constructor(a,b){super(`API key not configured for ${a}. Please set the appropriate environment variable.`,"API_KEY_MISSING",a,void 0,!1,b),this.name="APIKeyError"}}class o extends k{constructor(a,b,c){super(a,"VALIDATION_FAILED",b,400,!1),this.validationErrors=c,this.name="ValidationError"}}class p extends k{constructor(a,b,c){super(`Request timed out after ${b}ms`,"TIMEOUT",a,408,!0,c),this.name="TimeoutError"}}class q extends k{constructor(a,b,c){super(a,"CONTENT_FILTERED",b,400,!1,c),this.name="ContentFilterError"}}class r extends k{constructor(a,b,c){super(`${a} model is currently overloaded. Please retry later.`,"MODEL_OVERLOADED",a,503,!0,c),this.retryAfterMs=b,this.name="ModelOverloadedError"}}d.Ik({source:d.fc(g),type:d.Yj().min(1),rawContent:d.Yj(),structuredData:d.g1(d.L5()).optional(),metadata:d.Ik({senderEmail:d.Yj().email().optional(),senderName:d.Yj().optional(),ipAddress:d.Yj().optional(),userAgent:d.Yj().optional(),webhookSignature:d.Yj().optional(),headers:d.g1(d.Yj()).optional(),relatedEntityIds:d.g1(d.Yj()).optional(),priorityHint:d.ai().int().min(1).max(5).optional(),tags:d.YO(d.Yj()).optional()}).optional(),timestamp:d.p6(),correlationId:d.Yj().optional()}),d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),urgency:d.ai().int().min(1).max(5),keywords:d.YO(d.Yj()),entities:d.YO(d.Ik({type:d.Yj(),value:d.Yj(),confidence:d.ai().min(0).max(1),position:d.Ik({start:d.ai(),end:d.ai()}).optional()})),subIntent:d.Yj().optional(),sentiment:d.k5(["positive","neutral","negative"]).optional()});let s=d.Ik({type:d.fc(h),params:d.g1(d.L5()),priority:d.ai().int().min(1).max(5),requiresConfirmation:d.zM(),delayMs:d.ai().int().positive().optional(),condition:d.Ik({type:d.k5(["time_range","user_available","slot_available","custom"]),params:d.g1(d.L5())}).optional()});d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),reasoning:d.Yj(),actions:d.YO(s),requiresApproval:d.zM(),priority:d.ai().int().min(1).max(5).optional(),warnings:d.YO(d.Yj()).optional(),alternatives:d.YO(d.Ik({intent:d.Yj(),confidence:d.ai().min(0).max(1),reason:d.Yj()})).optional()});let t={temperature:.3,maxTokens:2e3,timeout:3e4},u={temperature:.3,autoExecuteThreshold:.85,requireApprovalThreshold:.5,maxActionsPerMinute:60,maxActionsPerHour:500}},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71003:()=>{},76934:(a,b,c)=>{"use strict";function d(){return"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}c.d(b,{Ju:()=>h,T$:()=>i,io:()=>g});let e="undefined"!=typeof process&&!1,f={debug:(a,b)=>{e&&console.debug(`[EventBus] ${a}`,b??"")},info:(a,b)=>{console.info(`[EventBus] ${a}`,b??"")},warn:(a,b)=>{console.warn(`[EventBus] ${a}`,b??"")},error:(a,b,c)=>{console.error(`[EventBus] ${a}`,b,c??"")}};class g{static{this.instance=null}constructor(a={}){this.subscriptions=new Map,this.eventHistory=[],this.historySize=a.historySize??100,this.logger=a.logger??f,this.debug=a.debug??!1,this.defaultOrgId=a.defaultOrgId,this.stats={totalEventsEmitted:0,totalHandlersInvoked:0,totalErrors:0,eventCounts:new Map},this.logger.info("EventBus initialized",{historySize:this.historySize})}static getInstance(a){return g.instance||(g.instance=new g(a)),g.instance}static resetInstance(){g.instance&&(g.instance.removeAllListeners(),g.instance=null)}on(a,b){let c=this.generateSubscriptionId();return this.subscriptions.has(a)||this.subscriptions.set(a,new Map),this.subscriptions.get(a).set(c,{eventType:a,handler:b,subscriptionId:c,once:!1}),this.debug&&this.logger.debug(`Handler registered for event "${a}"`,{subscriptionId:c}),c}once(a,b){let c=this.generateSubscriptionId();return this.subscriptions.has(a)||this.subscriptions.set(a,new Map),this.subscriptions.get(a).set(c,{eventType:a,handler:b,subscriptionId:c,once:!0}),this.debug&&this.logger.debug(`Once handler registered for event "${a}"`,{subscriptionId:c}),c}onAny(a){let b=this.generateSubscriptionId();return this.subscriptions.has("*")||this.subscriptions.set("*",new Map),this.subscriptions.get("*").set(b,{eventType:"*",handler:a,subscriptionId:b,once:!1}),this.debug&&this.logger.debug("Wildcard handler registered",{subscriptionId:b}),b}off(a){for(let[,b]of this.subscriptions)if(b.has(a))return b.delete(a),this.debug&&this.logger.debug("Handler removed",{subscriptionId:a}),!0;return!1}removeAllListeners(a){a?(this.subscriptions.delete(a),this.logger.info(`All handlers removed for event "${a}"`)):(this.subscriptions.clear(),this.logger.info("All handlers removed"))}async emit(a,b,c){let e=d(),f=new Date,g=[],h=[],i={type:a,payload:b,timestamp:f,source:c?.source??"system",eventId:e,correlationId:c?.correlationId,orgId:c?.orgId??this.defaultOrgId,metadata:c?.metadata};this.stats.totalEventsEmitted++,this.stats.eventCounts.set(a,(this.stats.eventCounts.get(a)??0)+1),this.debug&&this.logger.debug(`Emitting event "${a}"`,{eventId:e,source:i.source});let j=[],k=this.subscriptions.get(a);if(k)for(let a of k.values())j.push(a);let l=this.subscriptions.get("*");if(l)for(let a of l.values())j.push(a);let m=[],n=j.map(async b=>{let c=Date.now();try{return await b.handler(i),this.stats.totalHandlersInvoked++,b.once&&m.push(b.subscriptionId),{subscriptionId:b.subscriptionId,success:!0,executionTimeMs:Date.now()-c}}catch(f){let d=f instanceof Error?f:Error(String(f));return this.stats.totalErrors++,this.logger.error(`Handler ${b.subscriptionId} failed for event "${a}"`,d,{eventId:e,subscriptionId:b.subscriptionId}),{subscriptionId:b.subscriptionId,success:!1,error:d,executionTimeMs:Date.now()-c}}}),o=await Promise.all(n);for(let a of m)this.off(a);for(let a of o)g.push(a),a.error&&h.push(a.error);return this.addToHistory(i,g.length,h.map(a=>a.message)),this.debug&&this.logger.debug(`Event "${a}" processing complete`,{eventId:e,handlersInvoked:g.length,successCount:g.filter(a=>a.success).length,errorCount:h.length}),{eventType:a,eventId:e,timestamp:f,handlersInvoked:g.length,results:g,errors:h}}emitSync(a,b,c){this.emit(a,b,c).catch(b=>{this.logger.error(`Sync emit failed for event "${a}"`,b)})}getHistory(a,b){let c=[...this.eventHistory];if(a){let b=Array.isArray(a)?a:[a];c=c.filter(a=>b.includes(a.event.type))}return b&&b>0&&(c=c.slice(-b)),c}async replay(a){this.logger.info(`Replaying ${a.length} events`);let b=[];for(let c of a){let a=await this.emit(c.event.type,c.event.payload,{source:c.event.source,correlationId:c.event.correlationId,orgId:c.event.orgId,metadata:{...c.event.metadata,replayed:!0,originalEventId:c.event.eventId,originalTimestamp:c.event.timestamp.toISOString()}});b.push(a)}return b}clearHistory(){this.eventHistory=[],this.logger.info("Event history cleared")}getStats(){let a={};for(let[b,c]of this.stats.eventCounts)a[b]=c;let b={};for(let[a,c]of this.subscriptions)b[a]=c.size;return{totalEventsEmitted:this.stats.totalEventsEmitted,totalHandlersInvoked:this.stats.totalHandlersInvoked,totalErrors:this.stats.totalErrors,eventCounts:a,subscriptionCounts:b,historySize:this.eventHistory.length}}listenerCount(a){let b=this.subscriptions.get(a),c=this.subscriptions.get("*");return(b?.size??0)+(c?.size??0)}eventNames(){let a=[];for(let b of this.subscriptions.keys())"*"!==b&&a.push(b);return a}getSubscriptions(){let a=[];for(let b of this.subscriptions.values())for(let c of b.values())a.push(c);return a}generateSubscriptionId(){return`sub_${d().slice(0,8)}`}addToHistory(a,b,c){let e={id:a.eventId??d(),event:a,timestamp:new Date,processed:!0,handlersInvoked:b,errors:c?.length?c:void 0};this.eventHistory.push(e),this.eventHistory.length>this.historySize&&(this.eventHistory=this.eventHistory.slice(-this.historySize))}}function h(a){return g.getInstance(a)}async function i(a,b,c){return g.getInstance().emit(a,b,c)}},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[8114,5449,8139,9229,5625,624,9407],()=>b(b.s=37720));module.exports=c})();