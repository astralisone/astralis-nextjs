(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{2743:(a,b,c)=>{"use strict";c.r(b),c.d(b,{CompactEncrypt:()=>bc,CompactSign:()=>bf,EmbeddedJWK:()=>bo,EncryptJWT:()=>bk,FlattenedEncrypt:()=>aY,FlattenedSign:()=>be,GeneralEncrypt:()=>a$,GeneralSign:()=>bh,SignJWT:()=>bj,UnsecuredJWT:()=>bx,base64url:()=>e,calculateJwkThumbprint:()=>bm,calculateJwkThumbprintUri:()=>bn,compactDecrypt:()=>aQ,compactVerify:()=>a3,createLocalJWKSet:()=>bt,createRemoteJWKSet:()=>bw,cryptoRuntime:()=>bH,decodeJwt:()=>bB,decodeProtectedHeader:()=>bA,errors:()=>d,exportJWK:()=>aV,exportPKCS8:()=>aU,exportSPKI:()=>aT,flattenedDecrypt:()=>aP,flattenedVerify:()=>a2,generalDecrypt:()=>aR,generalVerify:()=>a4,generateKeyPair:()=>bF,generateSecret:()=>bG,importJWK:()=>aF,importPKCS8:()=>aE,importSPKI:()=>aC,importX509:()=>aD,jwtDecrypt:()=>bb,jwtVerify:()=>ba});var d={};c.r(d),c.d(d,{JOSEAlgNotAllowed:()=>w,JOSEError:()=>t,JOSENotSupported:()=>x,JWEDecompressionFailed:()=>z,JWEDecryptionFailed:()=>y,JWEInvalid:()=>A,JWKInvalid:()=>D,JWKSInvalid:()=>E,JWKSMultipleMatchingKeys:()=>G,JWKSNoMatchingKey:()=>F,JWKSTimeout:()=>H,JWSInvalid:()=>B,JWSSignatureVerificationFailed:()=>I,JWTClaimValidationFailed:()=>u,JWTExpired:()=>v,JWTInvalid:()=>C});var e={};c.r(e),c.d(e,{decode:()=>bz,encode:()=>by});let f=crypto,g=async(a,b)=>{let c=`SHA-${a.slice(-3)}`;return new Uint8Array(await f.subtle.digest(c,b))},h=new TextEncoder,i=new TextDecoder;function j(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;return a.forEach(a=>{b.set(a,c),c+=a.length}),b}function k(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function l(a){let b=Math.floor(a/0x100000000),c=new Uint8Array(8);return k(c,b,0),k(c,a%0x100000000,4),c}function m(a){let b=new Uint8Array(4);return k(b,a),b}function n(a){return j(m(a.length),a)}async function o(a,b,c){let d=Math.ceil((b>>3)/32),e=new Uint8Array(32*d);for(let b=0;b<d;b++){let d=new Uint8Array(4+a.length+c.length);d.set(m(b+1)),d.set(a,4),d.set(c,4+a.length),e.set(await g("sha256",d),32*b)}return e.slice(0,b>>3)}let p=a=>{let b=a;"string"==typeof b&&(b=h.encode(b));let c=[];for(let a=0;a<b.length;a+=32768)c.push(String.fromCharCode.apply(null,b.subarray(a,a+32768)));return btoa(c.join(""))},q=a=>p(a).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),r=a=>{let b=atob(a),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);return c},s=a=>{let b=a;b instanceof Uint8Array&&(b=i.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return r(b)}catch(a){throw TypeError("The input to be decoded is not correctly encoded.")}};class t extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(a){var b;super(a),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,null==(b=Error.captureStackTrace)||b.call(Error,this,this.constructor)}}class u extends t{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(a,b="unspecified",c="unspecified"){super(a),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=b,this.reason=c}}class v extends t{static get code(){return"ERR_JWT_EXPIRED"}constructor(a,b="unspecified",c="unspecified"){super(a),this.code="ERR_JWT_EXPIRED",this.claim=b,this.reason=c}}class w extends t{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}}class x extends t{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}}class y extends t{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}}class z extends t{constructor(){super(...arguments),this.code="ERR_JWE_DECOMPRESSION_FAILED",this.message="decompression operation failed"}static get code(){return"ERR_JWE_DECOMPRESSION_FAILED"}}class A extends t{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}}class B extends t{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}}class C extends t{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}class D extends t{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}}class E extends t{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}}class F extends t{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}}class G extends t{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator;class H extends t{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}}class I extends t{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}let J=f.getRandomValues.bind(f);function K(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new x(`Unsupported JWE Algorithm: ${a}`)}}let L=a=>J(new Uint8Array(K(a)>>3)),M=(a,b)=>{if(b.length<<3!==K(a))throw new A("Invalid Initialization Vector length")},N=(a,b)=>{let c=a.byteLength<<3;if(c!==b)throw new A(`Invalid Content Encryption Key length. Expected ${b} bits, got ${c} bits`)};function O(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function P(a,b){return a.name===b}function Q(a){return parseInt(a.name.slice(4),10)}function R(a,b){if(b.length&&!b.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(b.length>2){let c=b.pop();a+=`one of ${b.join(", ")}, or ${c}.`}else 2===b.length?a+=`one of ${b[0]} or ${b[1]}.`:a+=`${b[0]}.`;throw TypeError(a)}}function S(a,b,...c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if(!P(a.algorithm,"AES-GCM"))throw O("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw O(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!P(a.algorithm,"AES-KW"))throw O("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw O(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw O("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!P(a.algorithm,"PBKDF2"))throw O("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!P(a.algorithm,"RSA-OAEP"))throw O("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(Q(a.algorithm.hash)!==c)throw O(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}R(a,c)}function T(a,b,...c){if(c.length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor&&b.constructor.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let U=(a,...b)=>T("Key must be ",a,...b);function V(a,b,...c){return T(`Key for the ${a} algorithm must be `,b,...c)}let W=["CryptoKey"];async function X(a,b,c,d,e,g){let h,i;if(!(b instanceof Uint8Array))throw TypeError(U(b,"Uint8Array"));let k=parseInt(a.slice(1,4),10),m=await f.subtle.importKey("raw",b.subarray(k>>3),"AES-CBC",!1,["decrypt"]),n=await f.subtle.importKey("raw",b.subarray(0,k>>3),{hash:`SHA-${k<<1}`,name:"HMAC"},!1,["sign"]),o=j(g,d,c,l(g.length<<3)),p=new Uint8Array((await f.subtle.sign("HMAC",n,o)).slice(0,k>>3));try{h=((a,b)=>{if(!(a instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(b instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(a.length!==b.length)throw TypeError("Input buffers must have the same length");let c=a.length,d=0,e=-1;for(;++e<c;)d|=a[e]^b[e];return 0===d})(e,p)}catch(a){}if(!h)throw new y;try{i=new Uint8Array(await f.subtle.decrypt({iv:d,name:"AES-CBC"},m,c))}catch(a){}if(!i)throw new y;return i}async function Y(a,b,c,d,e,g){let h;b instanceof Uint8Array?h=await f.subtle.importKey("raw",b,"AES-GCM",!1,["decrypt"]):(S(b,a,"decrypt"),h=b);try{return new Uint8Array(await f.subtle.decrypt({additionalData:g,iv:d,name:"AES-GCM",tagLength:128},h,j(c,e)))}catch(a){throw new y}}let Z=async(a,b,c,d,e,f)=>{if(!(b instanceof CryptoKey)&&!(b instanceof Uint8Array))throw TypeError(U(b,...W,"Uint8Array"));switch(M(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return b instanceof Uint8Array&&N(b,parseInt(a.slice(-3),10)),X(a,b,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":return b instanceof Uint8Array&&N(b,parseInt(a.slice(1,4),10)),Y(a,b,c,d,e,f);default:throw new x("Unsupported JWE Content Encryption Algorithm")}},$=async()=>{throw new x('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `inflateRaw` decrypt option to provide Inflate Raw implementation.')},_=async()=>{throw new x('JWE "zip" (Compression Algorithm) Header Parameter is not supported by your javascript runtime. You need to use the `deflateRaw` encrypt option to provide Deflate Raw implementation.')},aa=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0};function ab(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}let ac=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function ad(a,b){if(a.algorithm.length!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function ae(a,b,c){if(a instanceof CryptoKey)return S(a,b,c),a;if(a instanceof Uint8Array)return f.subtle.importKey("raw",a,"AES-KW",!0,[c]);throw TypeError(U(a,...W,"Uint8Array"))}let af=async(a,b,c)=>{let d=await ae(b,a,"wrapKey");ad(d,a);let e=await f.subtle.importKey("raw",c,...ac);return new Uint8Array(await f.subtle.wrapKey("raw",e,d,"AES-KW"))},ag=async(a,b,c)=>{let d=await ae(b,a,"unwrapKey");ad(d,a);let e=await f.subtle.unwrapKey("raw",c,d,"AES-KW",...ac);return new Uint8Array(await f.subtle.exportKey("raw",e))};async function ah(a,b,c,d,e=new Uint8Array(0),g=new Uint8Array(0)){let i;if(!(a instanceof CryptoKey))throw TypeError(U(a,...W));if(S(a,"ECDH"),!(b instanceof CryptoKey))throw TypeError(U(b,...W));S(b,"ECDH","deriveBits");let k=j(n(h.encode(c)),n(e),n(g),m(d));return i="X25519"===a.algorithm.name?256:"X448"===a.algorithm.name?448:Math.ceil(parseInt(a.algorithm.namedCurve.substr(-3),10)/8)<<3,o(new Uint8Array(await f.subtle.deriveBits({name:a.algorithm.name,public:a},b,i)),d,k)}async function ai(a){if(!(a instanceof CryptoKey))throw TypeError(U(a,...W));return f.subtle.generateKey(a.algorithm,!0,["deriveBits"])}function aj(a){if(!(a instanceof CryptoKey))throw TypeError(U(a,...W));return["P-256","P-384","P-521"].includes(a.algorithm.namedCurve)||"X25519"===a.algorithm.name||"X448"===a.algorithm.name}async function ak(a,b,c,d){if(!(a instanceof Uint8Array)||a.length<8)throw new A("PBES2 Salt Input must be 8 or more octets");let e=j(h.encode(b),new Uint8Array([0]),a),g=parseInt(b.slice(13,16),10),i={hash:`SHA-${b.slice(8,11)}`,iterations:c,name:"PBKDF2",salt:e},k=await function(a,b){if(a instanceof Uint8Array)return f.subtle.importKey("raw",a,"PBKDF2",!1,["deriveBits"]);if(a instanceof CryptoKey)return S(a,b,"deriveBits","deriveKey"),a;throw TypeError(U(a,...W,"Uint8Array"))}(d,b);if(k.usages.includes("deriveBits"))return new Uint8Array(await f.subtle.deriveBits(i,k,g));if(k.usages.includes("deriveKey"))return f.subtle.deriveKey(i,k,{length:g,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let al=async(a,b,c,d=2048,e=J(new Uint8Array(16)))=>{let f=await ak(e,a,d,b);return{encryptedKey:await af(a.slice(-6),f,c),p2c:d,p2s:q(e)}},am=async(a,b,c,d,e)=>{let f=await ak(e,a,d,b);return ag(a.slice(-6),f,c)};function an(a){switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new x(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}let ao=(a,b)=>{if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}},ap=async(a,b,c)=>{if(!(b instanceof CryptoKey))throw TypeError(U(b,...W));if(S(b,a,"encrypt","wrapKey"),ao(a,b),b.usages.includes("encrypt"))return new Uint8Array(await f.subtle.encrypt(an(a),b,c));if(b.usages.includes("wrapKey")){let d=await f.subtle.importKey("raw",c,...ac);return new Uint8Array(await f.subtle.wrapKey("raw",d,b,an(a)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},aq=async(a,b,c)=>{if(!(b instanceof CryptoKey))throw TypeError(U(b,...W));if(S(b,a,"decrypt","unwrapKey"),ao(a,b),b.usages.includes("decrypt"))return new Uint8Array(await f.subtle.decrypt(an(a),b,c));if(b.usages.includes("unwrapKey")){let d=await f.subtle.unwrapKey("raw",c,b,an(a),...ac);return new Uint8Array(await f.subtle.exportKey("raw",d))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function ar(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new x(`Unsupported JWE Algorithm: ${a}`)}}let as=a=>J(new Uint8Array(ar(a)>>3)),at=(a,b)=>{let c=(a.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${b}-----
${c}
-----END ${b}-----`},au=async(a,b,c)=>{if(!(c instanceof CryptoKey))throw TypeError(U(c,...W));if(!c.extractable)throw TypeError("CryptoKey is not extractable");if(c.type!==a)throw TypeError(`key is not a ${a} key`);return at(p(new Uint8Array(await f.subtle.exportKey(b,c))),`${a.toUpperCase()} KEY`)},av=(a,b,c=0)=>{0===c&&(b.unshift(b.length),b.unshift(6));let d=a.indexOf(b[0],c);if(-1===d)return!1;let e=a.subarray(d,d+b.length);return e.length===b.length&&(e.every((a,c)=>a===b[c])||av(a,b,d+1))},aw=a=>{switch(!0){case av(a,[42,134,72,206,61,3,1,7]):return"P-256";case av(a,[43,129,4,0,34]):return"P-384";case av(a,[43,129,4,0,35]):return"P-521";case av(a,[43,101,110]):return"X25519";case av(a,[43,101,111]):return"X448";case av(a,[43,101,112]):return"Ed25519";case av(a,[43,101,113]):return"Ed448";default:throw new x("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},ax=async(a,b,c,d,e)=>{var g;let h,i,j=new Uint8Array(atob(c.replace(a,"")).split("").map(a=>a.charCodeAt(0))),k="spki"===b;switch(d){case"PS256":case"PS384":case"PS512":h={name:"RSA-PSS",hash:`SHA-${d.slice(-3)}`},i=k?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":h={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${d.slice(-3)}`},i=k?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h={name:"RSA-OAEP",hash:`SHA-${parseInt(d.slice(-3),10)||1}`},i=k?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":h={name:"ECDSA",namedCurve:"P-256"},i=k?["verify"]:["sign"];break;case"ES384":h={name:"ECDSA",namedCurve:"P-384"},i=k?["verify"]:["sign"];break;case"ES512":h={name:"ECDSA",namedCurve:"P-521"},i=k?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let a=aw(j);h=a.startsWith("P-")?{name:"ECDH",namedCurve:a}:{name:a},i=k?[]:["deriveBits"];break}case"EdDSA":h={name:aw(j)},i=k?["verify"]:["sign"];break;default:throw new x('Invalid or unsupported "alg" (Algorithm) value')}return f.subtle.importKey(b,j,h,null!=(g=null==e?void 0:e.extractable)&&g,i)},ay=(a,b,c)=>ax(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",a,b,c);function az(a){let b=[],c=0;for(;c<a.length;){let d=aA(a.subarray(c));b.push(d),c+=d.byteLength}return b}function aA(a){let b=0,c=31&a[0];if(b++,31===c){for(c=0;a[b]>=128;)c=128*c+a[b]-128,b++;c=128*c+a[b]-128,b++}let d=0;if(a[b]<128)d=a[b],b++;else if(128===d){for(d=0;0!==a[b+d]||0!==a[b+d+1];){if(d>a.byteLength)throw TypeError("invalid indefinite form length");d++}let c=b+d+2;return{byteLength:c,contents:a.subarray(b,b+d),raw:a.subarray(0,c)}}else{let c=127&a[b];b++,d=0;for(let e=0;e<c;e++)d=256*d+a[b],b++}let e=b+d;return{byteLength:e,contents:a.subarray(b,e),raw:a.subarray(0,e)}}let aB=async a=>{var b,c;if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:d,keyUsages:e}=function(a){let b,c;switch(a.kty){case"oct":switch(a.alg){case"HS256":case"HS384":case"HS512":b={name:"HMAC",hash:`SHA-${a.alg.slice(-3)}`},c=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":throw new x(`${a.alg} keys cannot be imported as CryptoKey instances`);case"A128GCM":case"A192GCM":case"A256GCM":case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":b={name:"AES-GCM"},c=["encrypt","decrypt"];break;case"A128KW":case"A192KW":case"A256KW":b={name:"AES-KW"},c=["wrapKey","unwrapKey"];break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":b={name:"PBKDF2"},c=["deriveBits"];break;default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"EdDSA":b={name:a.crv},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new x('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),g=[d,null!=(b=a.ext)&&b,null!=(c=a.key_ops)?c:e];if("PBKDF2"===d.name)return f.subtle.importKey("raw",s(a.k),...g);let h={...a};return delete h.alg,delete h.use,f.subtle.importKey("jwk",h,...g)};async function aC(a,b,c){if("string"!=typeof a||0!==a.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return ay(a,b,c)}async function aD(a,b,c){let d;if("string"!=typeof a||0!==a.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');try{d=at(function(a){let b=az(az(aA(a).contents)[0].contents);return p(b[160===b[0].raw[0]?6:5].raw)}(r(a.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""))),"PUBLIC KEY")}catch(a){throw TypeError("Failed to parse the X.509 certificate",{cause:a})}return ay(d,b,c)}async function aE(a,b,c){if("string"!=typeof a||0!==a.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return ax(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",a,b,c)}async function aF(a,b,c){var d;if(!ab(a))throw TypeError("JWK must be an object");switch(b||(b=a.alg),a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');if(null!=c||(c=!0!==a.ext),c)return aB({...a,alg:b,ext:null!=(d=a.ext)&&d});return s(a.k);case"RSA":if(void 0!==a.oth)throw new x('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return aB({...a,alg:b});default:throw new x('Unsupported "kty" (Key Type) Parameter value')}}let aG=(a,b,c)=>{a.startsWith("HS")||"dir"===a||a.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(a)?((a,b)=>{if(!(b instanceof Uint8Array)){if(!(b instanceof CryptoKey))throw TypeError(V(a,b,...W,"Uint8Array"));if("secret"!==b.type)throw TypeError(`${W.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}})(a,b):((a,b,c)=>{if(!(b instanceof CryptoKey))throw TypeError(V(a,b,...W));if("secret"===b.type)throw TypeError(`${W.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${W.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${W.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${W.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${W.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)})(a,b,c)};async function aH(a,b,c,d,e){if(!(c instanceof Uint8Array))throw TypeError(U(c,"Uint8Array"));let g=parseInt(a.slice(1,4),10),h=await f.subtle.importKey("raw",c.subarray(g>>3),"AES-CBC",!1,["encrypt"]),i=await f.subtle.importKey("raw",c.subarray(0,g>>3),{hash:`SHA-${g<<1}`,name:"HMAC"},!1,["sign"]),k=new Uint8Array(await f.subtle.encrypt({iv:d,name:"AES-CBC"},h,b)),m=j(e,d,k,l(e.length<<3));return{ciphertext:k,tag:new Uint8Array((await f.subtle.sign("HMAC",i,m)).slice(0,g>>3))}}async function aI(a,b,c,d,e){let g;c instanceof Uint8Array?g=await f.subtle.importKey("raw",c,"AES-GCM",!1,["encrypt"]):(S(c,a,"encrypt"),g=c);let h=new Uint8Array(await f.subtle.encrypt({additionalData:e,iv:d,name:"AES-GCM",tagLength:128},g,b)),i=h.slice(-16);return{ciphertext:h.slice(0,-16),tag:i}}let aJ=async(a,b,c,d,e)=>{if(!(c instanceof CryptoKey)&&!(c instanceof Uint8Array))throw TypeError(U(c,...W,"Uint8Array"));switch(M(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return c instanceof Uint8Array&&N(c,parseInt(a.slice(-3),10)),aH(a,b,c,d,e);case"A128GCM":case"A192GCM":case"A256GCM":return c instanceof Uint8Array&&N(c,parseInt(a.slice(1,4),10)),aI(a,b,c,d,e);default:throw new x("Unsupported JWE Content Encryption Algorithm")}};async function aK(a,b,c,d){let e=a.slice(0,7);d||(d=L(e));let{ciphertext:f,tag:g}=await aJ(e,c,b,d,new Uint8Array(0));return{encryptedKey:f,iv:q(d),tag:q(g)}}async function aL(a,b,c,d,e){return Z(a.slice(0,7),b,c,d,e,new Uint8Array(0))}async function aM(a,b,c,d,e){switch(aG(a,b,"decrypt"),a){case"dir":if(void 0!==c)throw new A("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new A("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!ab(d.epk))throw new A('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!aj(b))throw new x("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await aF(d.epk,a);if(void 0!==d.apu){if("string"!=typeof d.apu)throw new A('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=s(d.apu)}catch(a){throw new A("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new A('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=s(d.apv)}catch(a){throw new A("Failed to base64url decode the apv")}}let h=await ah(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?ar(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new A("JWE Encrypted Key missing");return ag(a.slice(-6),h,c)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===c)throw new A("JWE Encrypted Key missing");return aq(a,b,c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new A("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new A('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=(null==e?void 0:e.maxPBES2Count)||1e4;if(d.p2c>g)throw new A('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new A('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=s(d.p2s)}catch(a){throw new A("Failed to base64url decode the p2s")}return am(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new A("JWE Encrypted Key missing");return ag(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new A("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new A('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new A('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=s(d.iv)}catch(a){throw new A("Failed to base64url decode the iv")}try{f=s(d.tag)}catch(a){throw new A("Failed to base64url decode the tag")}return aL(a,b,c,e,f)}default:throw new x('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let aN=function(a,b,c,d,e){let f;if(void 0!==e.crit&&void 0===d.crit)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new x(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)},aO=(a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)};async function aP(a,b,c){var d;let e,f,g,k,l,m,n;if(!ab(a))throw new A("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new A("JOSE Header missing");if("string"!=typeof a.iv)throw new A("JWE Initialization Vector missing or incorrect type");if("string"!=typeof a.ciphertext)throw new A("JWE Ciphertext missing or incorrect type");if("string"!=typeof a.tag)throw new A("JWE Authentication Tag missing or incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new A("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new A("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new A("JWE AAD incorrect type");if(void 0!==a.header&&!ab(a.header))throw new A("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!ab(a.unprotected))throw new A("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=s(a.protected);e=JSON.parse(i.decode(b))}catch(a){throw new A("JWE Protected Header is invalid")}if(!aa(e,a.header,a.unprotected))throw new A("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let o={...e,...a.header,...a.unprotected};if(aN(A,new Map,null==c?void 0:c.crit,e,o),void 0!==o.zip){if(!e||!e.zip)throw new A('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==o.zip)throw new x('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:p,enc:q}=o;if("string"!=typeof p||!p)throw new A("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof q||!q)throw new A("missing JWE Encryption Algorithm (enc) in JWE Header");let r=c&&aO("keyManagementAlgorithms",c.keyManagementAlgorithms),t=c&&aO("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(r&&!r.has(p))throw new w('"alg" (Algorithm) Header Parameter not allowed');if(t&&!t.has(q))throw new w('"enc" (Encryption Algorithm) Header Parameter not allowed');if(void 0!==a.encrypted_key)try{f=s(a.encrypted_key)}catch(a){throw new A("Failed to base64url decode the encrypted_key")}let u=!1;"function"==typeof b&&(b=await b(e,a),u=!0);try{g=await aM(p,b,f,o,c)}catch(a){if(a instanceof TypeError||a instanceof A||a instanceof x)throw a;g=as(q)}try{k=s(a.iv)}catch(a){throw new A("Failed to base64url decode the iv")}try{l=s(a.tag)}catch(a){throw new A("Failed to base64url decode the tag")}let v=h.encode(null!=(d=a.protected)?d:"");m=void 0!==a.aad?j(v,h.encode("."),h.encode(a.aad)):v;try{n=s(a.ciphertext)}catch(a){throw new A("Failed to base64url decode the ciphertext")}let y=await Z(q,g,n,k,l,m);"DEF"===o.zip&&(y=await ((null==c?void 0:c.inflateRaw)||$)(y));let z={plaintext:y};if(void 0!==a.protected&&(z.protectedHeader=e),void 0!==a.aad)try{z.additionalAuthenticatedData=s(a.aad)}catch(a){throw new A("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(z.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(z.unprotectedHeader=a.header),u)?{...z,key:b}:z}async function aQ(a,b,c){if(a instanceof Uint8Array&&(a=i.decode(a)),"string"!=typeof a)throw new A("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:j}=a.split(".");if(5!==j)throw new A("Invalid Compact JWE");let k=await aP({ciphertext:g,iv:f||void 0,protected:d||void 0,tag:h||void 0,encrypted_key:e||void 0},b,c),l={plaintext:k.plaintext,protectedHeader:k.protectedHeader};return"function"==typeof b?{...l,key:k.key}:l}async function aR(a,b,c){if(!ab(a))throw new A("General JWE must be an object");if(!Array.isArray(a.recipients)||!a.recipients.every(ab))throw new A("JWE Recipients missing or incorrect type");if(!a.recipients.length)throw new A("JWE Recipients has no members");for(let d of a.recipients)try{return await aP({aad:a.aad,ciphertext:a.ciphertext,encrypted_key:d.encrypted_key,header:d.header,iv:a.iv,protected:a.protected,tag:a.tag,unprotected:a.unprotected},b,c)}catch(a){}throw new y}let aS=async a=>{if(a instanceof Uint8Array)return{kty:"oct",k:q(a)};if(!(a instanceof CryptoKey))throw TypeError(U(a,...W,"Uint8Array"));if(!a.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:b,key_ops:c,alg:d,use:e,...g}=await f.subtle.exportKey("jwk",a);return g};async function aT(a){return au("public","spki",a)}async function aU(a){return au("private","pkcs8",a)}async function aV(a){return aS(a)}async function aW(a,b,c,d,e={}){let f,g,h;switch(aG(a,c,"encrypt"),a){case"dir":h=c;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!aj(c))throw new x("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:i,apv:j}=e,{epk:k}=e;k||(k=(await ai(c)).privateKey);let{x:l,y:m,crv:n,kty:o}=await aV(k),p=await ah(c,k,"ECDH-ES"===a?b:a,"ECDH-ES"===a?ar(b):parseInt(a.slice(-5,-2),10),i,j);if(g={epk:{x:l,crv:n,kty:o}},"EC"===o&&(g.epk.y=m),i&&(g.apu=q(i)),j&&(g.apv=q(j)),"ECDH-ES"===a){h=p;break}h=d||as(b);let r=a.slice(-6);f=await af(r,p,h);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h=d||as(b),f=await ap(a,c,h);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{h=d||as(b);let{p2c:i,p2s:j}=e;({encryptedKey:f,...g}=await al(a,c,h,i,j));break}case"A128KW":case"A192KW":case"A256KW":h=d||as(b),f=await af(a,c,h);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{h=d||as(b);let{iv:i}=e;({encryptedKey:f,...g}=await aK(a,c,h,i));break}default:throw new x('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:h,encryptedKey:f,parameters:g}}let aX=Symbol();class aY{constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=a}setKeyManagementParameters(a){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=a,this}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setSharedUnprotectedHeader(a){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}setAdditionalAuthenticatedData(a){return this._aad=a,this}setContentEncryptionKey(a){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=a,this}setInitializationVector(a){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=a,this}async encrypt(a,b){let c,d,e,f,g,k,l;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new A("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!aa(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new A("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let m={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(aN(A,new Map,null==b?void 0:b.crit,this._protectedHeader,m),void 0!==m.zip){if(!this._protectedHeader||!this._protectedHeader.zip)throw new A('JWE "zip" (Compression Algorithm) Header MUST be integrity protected');if("DEF"!==m.zip)throw new x('Unsupported JWE "zip" (Compression Algorithm) Header Parameter value')}let{alg:n,enc:o}=m;if("string"!=typeof n||!n)throw new A('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof o||!o)throw new A('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if("dir"===n){if(this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Encryption")}else if("ECDH-ES"===n&&this._cek)throw TypeError("setContentEncryptionKey cannot be called when using Direct Key Agreement");{let e;({cek:d,encryptedKey:c,parameters:e}=await aW(n,o,a,this._cek,this._keyManagementParameters)),e&&(b&&aX in b?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...e}:this.setUnprotectedHeader(e):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...e}:this.setProtectedHeader(e))}if(this._iv||(this._iv=L(o)),f=this._protectedHeader?h.encode(q(JSON.stringify(this._protectedHeader))):h.encode(""),this._aad?(g=q(this._aad),e=j(f,h.encode("."),h.encode(g))):e=f,"DEF"===m.zip){let a=await ((null==b?void 0:b.deflateRaw)||_)(this._plaintext);({ciphertext:k,tag:l}=await aJ(o,a,d,this._iv,e))}else({ciphertext:k,tag:l}=await aJ(o,this._plaintext,d,this._iv,e));let p={ciphertext:q(k),iv:q(this._iv),tag:q(l)};return c&&(p.encrypted_key=q(c)),g&&(p.aad=g),this._protectedHeader&&(p.protected=i.decode(f)),this._sharedUnprotectedHeader&&(p.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(p.header=this._unprotectedHeader),p}}class aZ{constructor(a,b,c){this.parent=a,this.key=b,this.options=c}setUnprotectedHeader(a){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=a,this}addRecipient(...a){return this.parent.addRecipient(...a)}encrypt(...a){return this.parent.encrypt(...a)}done(){return this.parent}}class a${constructor(a){this._recipients=[],this._plaintext=a}addRecipient(a,b){let c=new aZ(this,a,{crit:null==b?void 0:b.crit});return this._recipients.push(c),c}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setSharedUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}setAdditionalAuthenticatedData(a){return this._aad=a,this}async encrypt(a){var b,c,d;let e;if(!this._recipients.length)throw new A("at least one recipient must be added");if(a={deflateRaw:null==a?void 0:a.deflateRaw},1===this._recipients.length){let[b]=this._recipients,c=await new aY(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(b.unprotectedHeader).encrypt(b.key,{...b.options,...a}),d={ciphertext:c.ciphertext,iv:c.iv,recipients:[{}],tag:c.tag};return c.aad&&(d.aad=c.aad),c.protected&&(d.protected=c.protected),c.unprotected&&(d.unprotected=c.unprotected),c.encrypted_key&&(d.recipients[0].encrypted_key=c.encrypted_key),c.header&&(d.recipients[0].header=c.header),d}for(let a=0;a<this._recipients.length;a++){let b=this._recipients[a];if(!aa(this._protectedHeader,this._unprotectedHeader,b.unprotectedHeader))throw new A("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let c={...this._protectedHeader,...this._unprotectedHeader,...b.unprotectedHeader},{alg:d}=c;if("string"!=typeof d||!d)throw new A('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===d||"ECDH-ES"===d)throw new A('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof c.enc||!c.enc)throw new A('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(e){if(e!==c.enc)throw new A('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else e=c.enc;if(aN(A,new Map,b.options.crit,this._protectedHeader,c),void 0!==c.zip&&(!this._protectedHeader||!this._protectedHeader.zip))throw new A('JWE "zip" (Compression Algorithm) Header MUST be integrity protected')}let f=as(e),g={ciphertext:"",iv:"",recipients:[],tag:""};for(let h=0;h<this._recipients.length;h++){let i=this._recipients[h],j={};g.recipients.push(j);let k=({...this._protectedHeader,...this._unprotectedHeader,...i.unprotectedHeader}).alg.startsWith("PBES2")?2048+h:void 0;if(0===h){let b=await new aY(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(f).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(i.unprotectedHeader).setKeyManagementParameters({p2c:k}).encrypt(i.key,{...i.options,...a,[aX]:!0});g.ciphertext=b.ciphertext,g.iv=b.iv,g.tag=b.tag,b.aad&&(g.aad=b.aad),b.protected&&(g.protected=b.protected),b.unprotected&&(g.unprotected=b.unprotected),j.encrypted_key=b.encrypted_key,b.header&&(j.header=b.header);continue}let{encryptedKey:l,parameters:m}=await aW((null==(b=i.unprotectedHeader)?void 0:b.alg)||(null==(c=this._protectedHeader)?void 0:c.alg)||(null==(d=this._unprotectedHeader)?void 0:d.alg),e,i.key,f,{p2c:k});j.encrypted_key=q(l),(i.unprotectedHeader||m)&&(j.header={...i.unprotectedHeader,...m})}return g}}function a_(a,b){let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:a.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"EdDSA":return{name:b.name};default:throw new x(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}function a0(a,b,c){if(b instanceof CryptoKey)return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!P(a.algorithm,"HMAC"))throw O("HMAC");let c=parseInt(b.slice(2),10);if(Q(a.algorithm.hash)!==c)throw O(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!P(a.algorithm,"RSASSA-PKCS1-v1_5"))throw O("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(Q(a.algorithm.hash)!==c)throw O(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!P(a.algorithm,"RSA-PSS"))throw O("RSA-PSS");let c=parseInt(b.slice(2),10);if(Q(a.algorithm.hash)!==c)throw O(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw O("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!P(a.algorithm,"ECDSA"))throw O("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw O(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}R(a,c)}(b,a,c),b;if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(U(b,...W));return f.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}throw TypeError(U(b,...W,"Uint8Array"))}let a1=async(a,b,c,d)=>{let e=await a0(a,b,"verify");ao(a,e);let g=a_(a,e.algorithm);try{return await f.subtle.verify(g,e,c,d)}catch(a){return!1}};async function a2(a,b,c){var d;let e,f;if(!ab(a))throw new B("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new B('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new B("JWS Protected Header incorrect type");if(void 0===a.payload)throw new B("JWS Payload missing");if("string"!=typeof a.signature)throw new B("JWS Signature missing or incorrect type");if(void 0!==a.header&&!ab(a.header))throw new B("JWS Unprotected Header incorrect type");let g={};if(a.protected)try{let b=s(a.protected);g=JSON.parse(i.decode(b))}catch(a){throw new B("JWS Protected Header is invalid")}if(!aa(g,a.header))throw new B("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let k={...g,...a.header},l=aN(B,new Map([["b64",!0]]),null==c?void 0:c.crit,g,k),m=!0;if(l.has("b64")&&"boolean"!=typeof(m=g.b64))throw new B('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:n}=k;if("string"!=typeof n||!n)throw new B('JWS "alg" (Algorithm) Header Parameter missing or invalid');let o=c&&aO("algorithms",c.algorithms);if(o&&!o.has(n))throw new w('"alg" (Algorithm) Header Parameter not allowed');if(m){if("string"!=typeof a.payload)throw new B("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new B("JWS Payload must be a string or an Uint8Array instance");let p=!1;"function"==typeof b&&(b=await b(g,a),p=!0),aG(n,b,"verify");let q=j(h.encode(null!=(d=a.protected)?d:""),h.encode("."),"string"==typeof a.payload?h.encode(a.payload):a.payload);try{e=s(a.signature)}catch(a){throw new B("Failed to base64url decode the signature")}if(!await a1(n,b,e,q))throw new I;if(m)try{f=s(a.payload)}catch(a){throw new B("Failed to base64url decode the payload")}else f="string"==typeof a.payload?h.encode(a.payload):a.payload;let r={payload:f};return(void 0!==a.protected&&(r.protectedHeader=g),void 0!==a.header&&(r.unprotectedHeader=a.header),p)?{...r,key:b}:r}async function a3(a,b,c){if(a instanceof Uint8Array&&(a=i.decode(a)),"string"!=typeof a)throw new B("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new B("Invalid Compact JWS");let h=await a2({payload:e,protected:d,signature:f},b,c),j={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...j,key:h.key}:j}async function a4(a,b,c){if(!ab(a))throw new B("General JWS must be an object");if(!Array.isArray(a.signatures)||!a.signatures.every(ab))throw new B("JWS Signatures missing or incorrect type");for(let d of a.signatures)try{return await a2({header:d.header,payload:a.payload,protected:d.protected,signature:d.signature},b,c)}catch(a){}throw new I}let a5=a=>Math.floor(a.getTime()/1e3),a6=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,a7=a=>{let b=a6.exec(a);if(!b)throw TypeError("Invalid time period format");let c=parseFloat(b[1]);switch(b[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(c);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(60*c);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(3600*c);case"day":case"days":case"d":return Math.round(86400*c);case"week":case"weeks":case"w":return Math.round(604800*c);default:return Math.round(0x1e187e0*c)}},a8=a=>a.toLowerCase().replace(/^application\//,""),a9=(a,b,c={})=>{let d,e,{typ:f}=c;if(f&&("string"!=typeof a.typ||a8(a.typ)!==a8(f)))throw new u('unexpected "typ" JWT header value',"typ","check_failed");try{d=JSON.parse(i.decode(b))}catch(a){}if(!ab(d))throw new C("JWT Claims Set must be a top-level JSON object");let{requiredClaims:g=[],issuer:h,subject:j,audience:k,maxTokenAge:l}=c;for(let a of(void 0!==l&&g.push("iat"),void 0!==k&&g.push("aud"),void 0!==j&&g.push("sub"),void 0!==h&&g.push("iss"),new Set(g.reverse())))if(!(a in d))throw new u(`missing required "${a}" claim`,a,"missing");if(h&&!(Array.isArray(h)?h:[h]).includes(d.iss))throw new u('unexpected "iss" claim value',"iss","check_failed");if(j&&d.sub!==j)throw new u('unexpected "sub" claim value',"sub","check_failed");if(k&&!((a,b)=>"string"==typeof a?b.includes(a):!!Array.isArray(a)&&b.some(Set.prototype.has.bind(new Set(a))))(d.aud,"string"==typeof k?[k]:k))throw new u('unexpected "aud" claim value',"aud","check_failed");switch(typeof c.clockTolerance){case"string":e=a7(c.clockTolerance);break;case"number":e=c.clockTolerance;break;case"undefined":e=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:m}=c,n=a5(m||new Date);if((void 0!==d.iat||l)&&"number"!=typeof d.iat)throw new u('"iat" claim must be a number',"iat","invalid");if(void 0!==d.nbf){if("number"!=typeof d.nbf)throw new u('"nbf" claim must be a number',"nbf","invalid");if(d.nbf>n+e)throw new u('"nbf" claim timestamp check failed',"nbf","check_failed")}if(void 0!==d.exp){if("number"!=typeof d.exp)throw new u('"exp" claim must be a number',"exp","invalid");if(d.exp<=n-e)throw new v('"exp" claim timestamp check failed',"exp","check_failed")}if(l){let a=n-d.iat;if(a-e>("number"==typeof l?l:a7(l)))throw new v('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(a<0-e)throw new u('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return d};async function ba(a,b,c){var d;let e=await a3(a,b,c);if((null==(d=e.protectedHeader.crit)?void 0:d.includes("b64"))&&!1===e.protectedHeader.b64)throw new C("JWTs MUST NOT use unencoded payload");let f={payload:a9(e.protectedHeader,e.payload,c),protectedHeader:e.protectedHeader};return"function"==typeof b?{...f,key:e.key}:f}async function bb(a,b,c){let d=await aQ(a,b,c),e=a9(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new u('replicated "iss" claim header parameter mismatch',"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new u('replicated "sub" claim header parameter mismatch',"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new u('replicated "aud" claim header parameter mismatch',"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}class bc{constructor(a){this._flattened=new aY(a)}setContentEncryptionKey(a){return this._flattened.setContentEncryptionKey(a),this}setInitializationVector(a){return this._flattened.setInitializationVector(a),this}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}setKeyManagementParameters(a){return this._flattened.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this._flattened.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}let bd=async(a,b,c)=>{let d=await a0(a,b,"sign");return ao(a,d),new Uint8Array(await f.subtle.sign(a_(a,d.algorithm),d,c))};class be{constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=a}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}async sign(a,b){let c;if(!this._protectedHeader&&!this._unprotectedHeader)throw new B("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!aa(this._protectedHeader,this._unprotectedHeader))throw new B("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this._protectedHeader,...this._unprotectedHeader},e=aN(B,new Map([["b64",!0]]),null==b?void 0:b.crit,this._protectedHeader,d),f=!0;if(e.has("b64")&&"boolean"!=typeof(f=this._protectedHeader.b64))throw new B('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:g}=d;if("string"!=typeof g||!g)throw new B('JWS "alg" (Algorithm) Header Parameter missing or invalid');aG(g,a,"sign");let k=this._payload;f&&(k=h.encode(q(k)));let l=j(c=this._protectedHeader?h.encode(q(JSON.stringify(this._protectedHeader))):h.encode(""),h.encode("."),k),m={signature:q(await bd(g,a,l)),payload:""};return f&&(m.payload=i.decode(k)),this._unprotectedHeader&&(m.header=this._unprotectedHeader),this._protectedHeader&&(m.protected=i.decode(c)),m}}class bf{constructor(a){this._flattened=new be(a)}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}async sign(a,b){let c=await this._flattened.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}class bg{constructor(a,b,c){this.parent=a,this.key=b,this.options=c}setProtectedHeader(a){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=a,this}setUnprotectedHeader(a){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=a,this}addSignature(...a){return this.parent.addSignature(...a)}sign(...a){return this.parent.sign(...a)}done(){return this.parent}}class bh{constructor(a){this._signatures=[],this._payload=a}addSignature(a,b){let c=new bg(this,a,b);return this._signatures.push(c),c}async sign(){if(!this._signatures.length)throw new B("at least one signature must be added");let a={signatures:[],payload:""};for(let b=0;b<this._signatures.length;b++){let c=this._signatures[b],d=new be(this._payload);d.setProtectedHeader(c.protectedHeader),d.setUnprotectedHeader(c.unprotectedHeader);let{payload:e,...f}=await d.sign(c.key,c.options);if(0===b)a.payload=e;else if(a.payload!==e)throw new B("inconsistent use of JWS Unencoded Payload (RFC7797)");a.signatures.push(f)}return a}}class bi{constructor(a){if(!ab(a))throw TypeError("JWT Claims Set MUST be an object");this._payload=a}setIssuer(a){return this._payload={...this._payload,iss:a},this}setSubject(a){return this._payload={...this._payload,sub:a},this}setAudience(a){return this._payload={...this._payload,aud:a},this}setJti(a){return this._payload={...this._payload,jti:a},this}setNotBefore(a){return"number"==typeof a?this._payload={...this._payload,nbf:a}:this._payload={...this._payload,nbf:a5(new Date)+a7(a)},this}setExpirationTime(a){return"number"==typeof a?this._payload={...this._payload,exp:a}:this._payload={...this._payload,exp:a5(new Date)+a7(a)},this}setIssuedAt(a){return void 0===a?this._payload={...this._payload,iat:a5(new Date)}:this._payload={...this._payload,iat:a},this}}class bj extends bi{setProtectedHeader(a){return this._protectedHeader=a,this}async sign(a,b){var c;let d=new bf(h.encode(JSON.stringify(this._payload)));if(d.setProtectedHeader(this._protectedHeader),Array.isArray(null==(c=this._protectedHeader)?void 0:c.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new C("JWTs MUST NOT use unencoded payload");return d.sign(a,b)}}class bk extends bi{setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setKeyManagementParameters(a){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=a,this}setContentEncryptionKey(a){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=a,this}setInitializationVector(a){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=a,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(a,b){let c=new bc(h.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),c.setProtectedHeader(this._protectedHeader),this._iv&&c.setInitializationVector(this._iv),this._cek&&c.setContentEncryptionKey(this._cek),this._keyManagementParameters&&c.setKeyManagementParameters(this._keyManagementParameters),c.encrypt(a,b)}}let bl=(a,b)=>{if("string"!=typeof a||!a)throw new D(`${b} missing or invalid`)};async function bm(a,b){let c;if(!ab(a))throw TypeError("JWK must be an object");if(null!=b||(b="sha256"),"sha256"!==b&&"sha384"!==b&&"sha512"!==b)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(a.kty){case"EC":bl(a.crv,'"crv" (Curve) Parameter'),bl(a.x,'"x" (X Coordinate) Parameter'),bl(a.y,'"y" (Y Coordinate) Parameter'),c={crv:a.crv,kty:a.kty,x:a.x,y:a.y};break;case"OKP":bl(a.crv,'"crv" (Subtype of Key Pair) Parameter'),bl(a.x,'"x" (Public Key) Parameter'),c={crv:a.crv,kty:a.kty,x:a.x};break;case"RSA":bl(a.e,'"e" (Exponent) Parameter'),bl(a.n,'"n" (Modulus) Parameter'),c={e:a.e,kty:a.kty,n:a.n};break;case"oct":bl(a.k,'"k" (Key Value) Parameter'),c={k:a.k,kty:a.kty};break;default:throw new x('"kty" (Key Type) Parameter missing or unsupported')}let d=h.encode(JSON.stringify(c));return q(await g(b,d))}async function bn(a,b){null!=b||(b="sha256");let c=await bm(a,b);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${b.slice(-3)}:${c}`}async function bo(a,b){let c={...a,...null==b?void 0:b.header};if(!ab(c.jwk))throw new B('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let d=await aF({...c.jwk,ext:!0},c.alg,!0);if(d instanceof Uint8Array||"public"!==d.type)throw new B('"jwk" (JSON Web Key) Header Parameter must be a public key');return d}function bp(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(bq)}function bq(a){return ab(a)}class br{constructor(a){if(this._cached=new WeakMap,!bp(a))throw new E("JSON Web Key Set malformed");this._jwks=function(a){return"function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a))}(a)}async getKey(a,b){let{alg:c,kid:d}={...a,...null==b?void 0:b.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new x('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this._jwks.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&"string"==typeof a.alg&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b&&"EdDSA"===c&&(b="Ed25519"===a.crv||"Ed448"===a.crv),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES256K":b="secp256k1"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new F;if(1!==h){let a=new G,{_cached:b}=this;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await bs(b,a,c)}catch(a){continue}},a}return bs(this._cached,g,c)}}async function bs(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await aF({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new E("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function bt(a){let b=new br(a);return async function(a,c){return b.getKey(a,c)}}let bu=async(a,b,c)=>{let d,e,f=!1;"function"==typeof AbortController&&(d=new AbortController,e=setTimeout(()=>{f=!0,d.abort()},b));let g=await fetch(a.href,{signal:d?d.signal:void 0,redirect:"manual",headers:c.headers}).catch(a=>{if(f)throw new H;throw a});if(void 0!==e&&clearTimeout(e),200!==g.status)throw new t("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await g.json()}catch(a){throw new t("Failed to parse the JSON Web Key Set HTTP response as JSON")}};class bv extends br{constructor(a,b){if(super({keys:[]}),this._jwks=void 0,!(a instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(a.href),this._options={agent:null==b?void 0:b.agent,headers:null==b?void 0:b.headers},this._timeoutDuration="number"==typeof(null==b?void 0:b.timeoutDuration)?null==b?void 0:b.timeoutDuration:5e3,this._cooldownDuration="number"==typeof(null==b?void 0:b.cooldownDuration)?null==b?void 0:b.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof(null==b?void 0:b.cacheMaxAge)?null==b?void 0:b.cacheMaxAge:6e5}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(a,b){this._jwks&&this.fresh()||await this.reload();try{return await super.getKey(a,b)}catch(c){if(c instanceof F&&!1===this.coolingDown())return await this.reload(),super.getKey(a,b);throw c}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent)&&(this._pendingFetch=void 0),this._pendingFetch||(this._pendingFetch=bu(this._url,this._timeoutDuration,this._options).then(a=>{if(!bp(a))throw new E("JSON Web Key Set malformed");this._jwks={keys:a.keys},this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(a=>{throw this._pendingFetch=void 0,a})),await this._pendingFetch}}function bw(a,b){let c=new bv(a,b);return async function(a,b){return c.getKey(a,b)}}class bx extends bi{encode(){let a=q(JSON.stringify({alg:"none"})),b=q(JSON.stringify(this._payload));return`${a}.${b}.`}static decode(a,b){let c;if("string"!=typeof a)throw new C("Unsecured JWT must be a string");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g||""!==f)throw new C("Invalid Unsecured JWT");try{if(c=JSON.parse(i.decode(s(d))),"none"!==c.alg)throw Error()}catch(a){throw new C("Invalid Unsecured JWT")}return{payload:a9(c,s(e),b),header:c}}}let by=q,bz=s;function bA(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(i.decode(bz(b)));if(!ab(a))throw Error();return a}catch(a){throw TypeError("Invalid Token or Protected Header formatting")}}function bB(a){let b,c;if("string"!=typeof a)throw new C("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new C("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new C("Invalid JWT");if(!d)throw new C("JWTs must contain a payload");try{b=bz(d)}catch(a){throw new C("Failed to base64url decode the payload")}try{c=JSON.parse(i.decode(b))}catch(a){throw new C("Failed to parse the decoded payload as JSON")}if(!ab(c))throw new C("Invalid JWT Claims Set");return c}async function bC(a,b){var c;let d,e,g;switch(a){case"HS256":case"HS384":case"HS512":d=parseInt(a.slice(-3),10),e={name:"HMAC",hash:`SHA-${d}`,length:d},g=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return J(new Uint8Array((d=parseInt(a.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":e={name:"AES-KW",length:d=parseInt(a.slice(1,4),10)},g=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":e={name:"AES-GCM",length:d=parseInt(a.slice(1,4),10)},g=["encrypt","decrypt"];break;default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return f.subtle.generateKey(e,null!=(c=null==b?void 0:b.extractable)&&c,g)}function bD(a){var b;let c=null!=(b=null==a?void 0:a.modulusLength)?b:2048;if("number"!=typeof c||c<2048)throw new x("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return c}async function bE(a,b){var c,d,e;let g,h;switch(a){case"PS256":case"PS384":case"PS512":g={name:"RSA-PSS",hash:`SHA-${a.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bD(b)},h=["sign","verify"];break;case"RS256":case"RS384":case"RS512":g={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bD(b)},h=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":g={name:"RSA-OAEP",hash:`SHA-${parseInt(a.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:bD(b)},h=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":g={name:"ECDSA",namedCurve:"P-256"},h=["sign","verify"];break;case"ES384":g={name:"ECDSA",namedCurve:"P-384"},h=["sign","verify"];break;case"ES512":g={name:"ECDSA",namedCurve:"P-521"},h=["sign","verify"];break;case"EdDSA":h=["sign","verify"];let i=null!=(c=null==b?void 0:b.crv)?c:"Ed25519";switch(i){case"Ed25519":case"Ed448":g={name:i};break;default:throw new x("Invalid or unsupported crv option provided")}break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{h=["deriveKey","deriveBits"];let a=null!=(d=null==b?void 0:b.crv)?d:"P-256";switch(a){case"P-256":case"P-384":case"P-521":g={name:"ECDH",namedCurve:a};break;case"X25519":case"X448":g={name:a};break;default:throw new x("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new x('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return f.subtle.generateKey(g,null!=(e=null==b?void 0:b.extractable)&&e,h)}async function bF(a,b){return bE(a,b)}async function bG(a,b){return bC(a,b)}let bH="WebCryptoAPI"},6522:a=>{a.exports=function(a){return a&&a.__esModule?a:{default:a}},a.exports.__esModule=!0,a.exports.default=a.exports}}]);
//# sourceMappingURL=226.js.map