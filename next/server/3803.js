"use strict";exports.id=3803,exports.ids=[3803],exports.modules={3687:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.GoogleAuth=b.GoogleAuthExceptionMessages=void 0;let d=c(79646),e=c(29021),f=c(20147),g=c(48928),h=c(21820),i=c(33873),j=c(13366),k=c(8910),l=c(18873),m=c(68624),n=c(75258),o=c(93088),p=c(67269),q=c(48534),r=c(80571),s=c(12235),t=c(48963),u=c(17849);b.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class v{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#a=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(a={}){if(this._cachedProjectId=a.projectId||null,this.cachedCredential=a.authClient||null,this.keyFilename=a.keyFilename||a.keyFile,this.scopes=a.scopes,this.clientOptions=a.clientOptions||{},this.jsonContent=a.credentials||null,this.apiKey=a.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(b.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);a.universeDomain&&(this.clientOptions.universeDomain=a.universeDomain)}setGapicJWTValues(a){a.defaultServicePath=this.defaultServicePath,a.useJWTAccessWithScope=this.useJWTAccessWithScope,a.defaultScopes=this.defaultScopes}getProjectId(a){if(!a)return this.getProjectIdAsync();this.getProjectIdAsync().then(b=>a(null,b),a)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(a){if(a instanceof Error&&a.message===b.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw a}}async findAndCacheProjectId(){let a=null;if(a||=await this.getProductionProjectId(),a||=await this.getFileProjectId(),a||=await this.getDefaultServiceProjectId(),a||=await this.getGCEProjectId(),a||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=a,a;throw Error(b.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let a;try{a=await g.universe("universe-domain"),a||=s.DEFAULT_UNIVERSE}catch(b){if(b&&b?.response?.status===404)a=s.DEFAULT_UNIVERSE;else throw b}return a}async getUniverseDomain(){let a=(0,u.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{a??=(await this.getClient()).universeDomain}catch{a??=s.DEFAULT_UNIVERSE}return a}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(a={},b){let c;if("function"==typeof a?b=a:c=a,!b)return this.getApplicationDefaultAsync(c);this.getApplicationDefaultAsync(c).then(a=>b(null,a.credential,a.projectId),b)}async getApplicationDefaultAsync(a={}){let c;if(this.cachedCredential)return await this.#b(this.cachedCredential,null);if((c=await this._tryGetApplicationCredentialsFromEnvironmentVariable(a))||(c=await this._tryGetApplicationCredentialsFromWellKnownFile(a)))return c instanceof n.JWT?c.scopes=this.scopes:c instanceof r.BaseExternalAccountClient&&(c.scopes=this.getAnyScopes()),await this.#b(c);if(await this._checkIsGCE())return a.scopes=this.getAnyScopes(),await this.#b(new k.Compute(a));throw Error(b.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #b(a,b=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let c=await this.getProjectIdOptional();return b&&(a.quotaProjectId=b),this.cachedCredential=a,{credential:a,projectId:c}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=g.getGCPResidency()||await g.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(a){let b=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!b||0===b.length)return null;try{return this._getApplicationCredentialsFromFilePath(b,a)}catch(a){throw a instanceof Error&&(a.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${a.message}`),a}}async _tryGetApplicationCredentialsFromWellKnownFile(a){let b=null;if(this._isWindows())b=process.env.APPDATA;else{let a=process.env.HOME;a&&(b=i.join(a,".config"))}return(b&&(b=i.join(b,"gcloud","application_default_credentials.json"),e.existsSync(b)||(b=null)),b)?await this._getApplicationCredentialsFromFilePath(b,a):null}async _getApplicationCredentialsFromFilePath(a,b={}){if(!a||0===a.length)throw Error("The file path is invalid.");try{if(a=e.realpathSync(a),!e.lstatSync(a).isFile())throw Error()}catch(b){throw b instanceof Error&&(b.message=`The file at ${a} does not exist, or it is not a file. ${b.message}`),b}let c=e.createReadStream(a);return this.fromStream(c,b)}fromImpersonatedJSON(a){if(!a)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(a.type!==p.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${p.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!a.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!a.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let b=this.fromJSON(a.source_credentials);if(a.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${a.service_account_impersonation_url}`);let c=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(a.service_account_impersonation_url)?.groups?.target;if(!c)throw RangeError(`Cannot extract target principal from ${a.service_account_impersonation_url}`);let d=(this.scopes||a.scopes||this.defaultScopes)??[];return new p.Impersonated({...a,sourceClient:b,targetPrincipal:c,targetScopes:Array.isArray(d)?d:[d]})}fromJSON(a,b={}){let c,d=(0,u.originalOrCamelOptions)(b).get("universe_domain");return a.type===o.USER_REFRESH_ACCOUNT_TYPE?(c=new o.UserRefreshClient(b)).fromJSON(a):a.type===p.IMPERSONATED_ACCOUNT_TYPE?c=this.fromImpersonatedJSON(a):a.type===r.EXTERNAL_ACCOUNT_TYPE?(c=q.ExternalAccountClient.fromJSON({...a,...b})).scopes=this.getAnyScopes():a.type===t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?c=new t.ExternalAccountAuthorizedUserClient({...a,...b}):(b.scopes=this.scopes,c=new n.JWT(b),this.setGapicJWTValues(c),c.fromJSON(a)),d&&(c.universeDomain=d),c}_cacheClientFromJSON(a,b){let c=this.fromJSON(a,b);return this.jsonContent=a,this.cachedCredential=c,c}fromStream(a,b={},c){let d={};if("function"==typeof b?c=b:d=b,!c)return this.fromStreamAsync(a,d);this.fromStreamAsync(a,d).then(a=>c(null,a),c)}fromStreamAsync(a,b){return new Promise((c,d)=>{if(!a)throw Error("Must pass in a stream containing the Google auth settings.");let e=[];a.setEncoding("utf8").on("error",d).on("data",a=>e.push(a)).on("end",()=>{try{try{let a=JSON.parse(e.join("")),d=this._cacheClientFromJSON(a,b);return c(d)}catch(b){if(!this.keyFilename)throw b;let a=new n.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),c(a)}}catch(a){return d(a)}})})}fromAPIKey(a,b={}){return new n.JWT({...b,apiKey:a})}_isWindows(){let a=h.platform();return!!a&&!!(a.length>=3)&&"win"===a.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(a=>{(0,d.exec)("gcloud config config-helper --format json",(b,c)=>{if(!b&&c)try{let b=JSON.parse(c).configuration.properties.core.project;a(b);return}catch(a){}a(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let a=await this.getClient();if(a&&a.projectId)return a.projectId}let a=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return a?a.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==r.EXTERNAL_ACCOUNT_TYPE)return null;let a=await this.getClient();return await a.getProjectId()}async getGCEProjectId(){try{return await g.project("project-id")}catch(a){return null}}getCredentials(a){if(!a)return this.getCredentialsAsync();this.getCredentialsAsync().then(b=>a(null,b),a)}async getCredentialsAsync(){let a=await this.getClient();if(a instanceof p.Impersonated)return{client_email:a.getTargetPrincipal()};if(a instanceof r.BaseExternalAccountClient){let b=a.getServiceAccountEmail();if(b)return{client_email:b,universe_domain:a.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[a,b]=await Promise.all([g.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:a,universe_domain:b}}throw Error(b.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#a=this.#a||this.#c();try{return await this.#a}finally{this.#a=null}}async #c(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let a=i.resolve(this.keyFilename),b=e.createReadStream(a);return await this.fromStreamAsync(b,this.clientOptions)}if(this.apiKey){let a=await this.fromAPIKey(this.apiKey,this.clientOptions);a.scopes=this.scopes;let{credential:b}=await this.#b(a);return b}{let{credential:a}=await this.getApplicationDefaultAsync(this.clientOptions);return a}}async getIdTokenClient(a){let b=await this.getClient();if(!("fetchIdToken"in b))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new l.IdTokenClient({targetAudience:a,idTokenProvider:b})}async getAccessToken(){let a=await this.getClient();return(await a.getAccessToken()).token}async getRequestHeaders(a){return(await this.getClient()).getRequestHeaders(a)}async authorizeRequest(a={}){let b=a.url,c=await this.getClient(),d=await c.getRequestHeaders(b);return a.headers=f.Gaxios.mergeHeaders(a.headers,d),a}async fetch(...a){return(await this.getClient()).fetch(...a)}async request(a){return(await this.getClient()).request(a)}getEnv(){return(0,m.getEnv)()}async sign(a,b){let c=await this.getClient(),d=await this.getUniverseDomain();if(b=b||`https://iamcredentials.${d}/v1/projects/-/serviceAccounts/`,c instanceof p.Impersonated)return(await c.sign(a)).signedBlob;let e=(0,j.createCrypto)();if(c instanceof n.JWT&&c.key)return await e.sign(c.key,a);let f=await this.getCredentials();if(!f.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(e,f.client_email,a,b)}async signBlob(a,b,c,d){let e=new URL(d+`${b}:signBlob`);return(await this.request({method:"POST",url:e.href,data:{payload:a.encodeBase64StringUtf8(c)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}b.GoogleAuth=v},5569:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.FileSubjectTokenSupplier=void 0;let d=c(28354),e=c(29021),f=(0,d.promisify)(e.readFile??(()=>{})),g=(0,d.promisify)(e.realpath??(()=>{})),h=(0,d.promisify)(e.lstat??(()=>{}));class i{filePath;formatType;subjectTokenFieldName;constructor(a){this.filePath=a.filePath,this.formatType=a.formatType,this.subjectTokenFieldName=a.subjectTokenFieldName}async getSubjectToken(){let a,b=this.filePath;try{if(b=await g(b),!(await h(b)).isFile())throw Error()}catch(a){throw a instanceof Error&&(a.message=`The file at ${b} does not exist, or it is not a file. ${a.message}`),a}let c=await f(b,{encoding:"utf8"});if("text"===this.formatType?a=c:"json"===this.formatType&&this.subjectTokenFieldName&&(a=JSON.parse(c)[this.subjectTokenFieldName]),!a)throw Error("Unable to parse the subject_token from the credential_source file");return a}}b.FileSubjectTokenSupplier=i},8910:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.Compute=void 0;let d=c(20147),e=c(48928),f=c(45070);class g extends f.OAuth2Client{serviceAccountEmail;scopes;constructor(a={}){super(a),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=a.serviceAccountEmail||"default",this.scopes=Array.isArray(a.scopes)?a.scopes:a.scopes?[a.scopes]:[]}async refreshTokenNoCache(){let a,b=`service-accounts/${this.serviceAccountEmail}/token`;try{let c={property:b};this.scopes.length>0&&(c.params={scopes:this.scopes.join(",")}),a=await e.instance(c)}catch(a){throw a instanceof d.GaxiosError&&(a.message=`Could not refresh access token: ${a.message}`,this.wrapError(a)),a}let c=a;return a&&a.expires_in&&(c.expiry_date=new Date().getTime()+1e3*a.expires_in,delete c.expires_in),this.emit("tokens",c),{tokens:c,res:null}}async fetchIdToken(a){let b,c=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${a}`;try{b=await e.instance({property:c})}catch(a){throw a instanceof Error&&(a.message=`Could not fetch ID token: ${a.message}`),a}return b}wrapError(a){let b=a.response;b&&b.status&&(a.status=b.status,403===b.status?a.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+a.message:404===b.status&&(a.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+a.message))}}b.Compute=g},12235:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.AuthClient=b.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=b.DEFAULT_UNIVERSE=void 0;let d=c(94735),e=c(20147),f=c(17849),g=c(28676),h=c(40993);b.DEFAULT_UNIVERSE="googleapis.com",b.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class i extends d.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=b.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=b.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(a={}){super();let c=(0,f.originalOrCamelOptions)(a);this.apiKey=a.apiKey,this.projectId=c.get("project_id")??null,this.quotaProjectId=c.get("quota_project_id"),this.credentials=c.get("credentials")??{},this.universeDomain=c.get("universe_domain")??b.DEFAULT_UNIVERSE,this.transporter=a.transporter??new e.Gaxios(a.transporterOptions),!1!==c.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(i.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(i.DEFAULT_RESPONSE_INTERCEPTOR)),a.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=a.forceRefreshOnFailure??!1}fetch(...a){let b,c=a[0],d=a[1],f=new Headers;return("string"==typeof c?b=new URL(c):c instanceof URL?b=c:c&&c.url&&(b=new URL(c.url)),c&&"object"==typeof c&&"headers"in c&&e.Gaxios.mergeHeaders(f,c.headers),d&&e.Gaxios.mergeHeaders(f,new Headers(d.headers)),"object"!=typeof c||c instanceof URL)?this.request({...d,headers:f,url:b}):this.request({...d,...c,headers:f,url:b})}setCredentials(a){this.credentials=a}addSharedMetadataHeaders(a){return!a.has("x-goog-user-project")&&this.quotaProjectId&&a.set("x-goog-user-project",this.quotaProjectId),a}addUserProjectAndAuthHeaders(a,b){let c=b.get("x-goog-user-project"),d=b.get("authorization");return c&&a.set("x-goog-user-project",c),d&&a.set("authorization",d),a}static log=(0,g.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async a=>{if(!a.headers.has("x-goog-api-client")){let b=process.version.replace(/^v/,"");a.headers.set("x-goog-api-client",`gl-node/${b}`)}let b=a.headers.get("User-Agent");b?b.includes(`${h.PRODUCT_NAME}/`)||a.headers.set("User-Agent",`${b} ${h.USER_AGENT}`):a.headers.set("User-Agent",h.USER_AGENT);try{let b=a[i.RequestMethodNameSymbol],c=`${Math.floor(1e3*Math.random())}`;a[i.RequestLogIdSymbol]=c;let d={url:a.url,headers:a.headers};b?i.log.info("%s [%s] request %j",b,c,d):i.log.info("[%s] request %j",c,d)}catch(a){}return a}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] response %j",c,d,a.data):i.log.info("[%s] response %j",d,a.data)}catch(a){}return a},rejected:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] error %j",c,d,a.response?.data):i.log.error("[%s] error %j",d,a.response?.data)}catch(a){}throw a}};static setMethodName(a,b){try{a[i.RequestMethodNameSymbol]=b}catch(a){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}b.AuthClient=i},34350:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.DefaultAwsSecurityCredentialsSupplier=void 0;let d=c(12235);class e{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(a){this.regionUrl=a.regionUrl,this.securityCredentialsUrl=a.securityCredentialsUrl,this.imdsV2SessionTokenUrl=a.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=a.additionalGaxiosOptions}async getAwsRegion(a){if(this.#d)return this.#d;let b=new Headers;if(!this.#d&&this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#e(a.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let c={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:b};d.AuthClient.setMethodName(c,"getAwsRegion");let e=await a.transporter.request(c);return e.data.substr(0,e.data.length-1)}async getAwsSecurityCredentials(a){if(this.#f)return this.#f;let b=new Headers;this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#e(a.transporter));let c=await this.#g(b,a.transporter),d=await this.#h(c,b,a.transporter);return{accessKeyId:d.AccessKeyId,secretAccessKey:d.SecretAccessKey,token:d.Token}}async #e(a){let b={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return d.AuthClient.setMethodName(b,"#getImdsV2SessionToken"),(await a.request(b)).data}async #g(a,b){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let c={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:a};return d.AuthClient.setMethodName(c,"#getAwsRoleName"),(await b.request(c)).data}async #h(a,b,c){let e={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${a}`,headers:b};return d.AuthClient.setMethodName(e,"#retrieveAwsSecurityCredentials"),(await c.request(e)).data}get #d(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #f(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}b.DefaultAwsSecurityCredentialsSupplier=e},48534:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.ExternalAccountClient=void 0;let d=c(80571),e=c(72813),f=c(69674),g=c(98230);class h{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(a){return a&&a.type===d.EXTERNAL_ACCOUNT_TYPE?a.credential_source?.environment_id?new f.AwsClient(a):a.credential_source?.executable?new g.PluggableAuthClient(a):new e.IdentityPoolClient(a):null}}b.ExternalAccountClient=h},48928:function(a,b,c){let d;var e,f=this&&this.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),g=this&&this.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),h=this&&this.__importStar||(e=function(a){return(e=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=e(a),d=0;d<c.length;d++)"default"!==c[d]&&f(b,a,c[d]);return g(b,a),b}),i=this&&this.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||f(b,a,c)};Object.defineProperty(b,"__esModule",{value:!0}),b.gcpResidencyCache=b.METADATA_SERVER_DETECTION=b.HEADERS=b.HEADER_VALUE=b.HEADER_NAME=b.SECONDARY_HOST_ADDRESS=b.HOST_ADDRESS=b.BASE_PATH=void 0,b.instance=function(a){return p("instance",a)},b.project=function(a){return p("project",a)},b.universe=function(a){return p("universe",a)},b.bulk=r,b.isAvailable=s,b.resetIsAvailableCache=function(){d=void 0},b.getGCPResidency=t,b.setGCPResidency=u,b.requestTimeout=v;let j=c(20147),k=c(62174),l=c(54047),m=h(c(28676));b.BASE_PATH="/computeMetadata/v1",b.HOST_ADDRESS="http://169.254.169.254",b.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",b.HEADER_NAME="Metadata-Flavor",b.HEADER_VALUE="Google",b.HEADERS=Object.freeze({[b.HEADER_NAME]:b.HEADER_VALUE});let n=m.log("gcp-metadata");function o(a){return a||(a=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||b.HOST_ADDRESS),/^https?:\/\//.test(a)||(a=`http://${a}`),new URL(b.BASE_PATH,a).href}async function p(a,c={},d=3,e=!1){let f=new Headers(b.HEADERS),g="",h={};("object"==typeof a?(new Headers(a.headers).forEach((a,b)=>f.set(b,a)),g=a.metadataKey,h=a.params||h,d=a.noResponseRetries||d,e=a.fastFail||e):g=a,"string"==typeof c)?g+=`/${c}`:(Object.keys(c).forEach(a=>{switch(a){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${a}' is not a valid configuration option.`)}}),c.property&&(g+=`/${c.property}`),new Headers(c.headers).forEach((a,b)=>f.set(b,a)),h=c.params||h);let i=e?q:j.request,l={url:`${o()}/${g}`,headers:f,retryConfig:{noResponseRetries:d},params:h,responseType:"text",timeout:v()};n.info("instance request %j",l);let m=await i(l);n.info("instance metadata is %s",m.data);let r=m.headers.get(b.HEADER_NAME);if(r!==b.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${b.HEADER_NAME} header. Expected '${b.HEADER_VALUE}', got ${r?`'${r}'`:"no header"}`);if("string"==typeof m.data)try{return k.parse(m.data)}catch{}return m.data}async function q(a){let c={...a,url:a.url?.toString().replace(o(),o(b.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,j.request)(a),(0,j.request)(c)])}async function r(a){let b={};return await Promise.all(a.map(a=>(async()=>{let c=await p(a);b[a.metadataKey]=c})())),b}async function s(){if(process.env.METADATA_SERVER_DETECTION){let a=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(a in b.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${a}\`, but it should be \`${Object.keys(b.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(a){case"assume-present":return!0;case"none":return!1;case"bios-only":return t()}}try{return void 0===d&&(d=p("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await d,!0}catch(a){if(process.env.DEBUG_AUTH&&console.info(a),"request-timeout"===a.type||a.response&&404===a.response.status)return!1;if(!(a.response&&404===a.response.status)&&(!a.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(a.code.toString()))){let b="UNKNOWN";a.code&&(b=a.code.toString()),process.emitWarning(`received unexpected error = ${a.message} code = ${b}`,"MetadataLookupWarning")}return!1}}function t(){return null===b.gcpResidencyCache&&u(),b.gcpResidencyCache}function u(a=null){b.gcpResidencyCache=null!==a?a:(0,l.detectGCPResidency)()}function v(){return 3e3*!t()}b.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),b.gcpResidencyCache=null,i(c(54047),b)},48963:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.ExternalAccountAuthorizedUserClient=b.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let d=c(12235),e=c(88152),f=c(20147),g=c(27910),h=c(80571);b.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class i extends e.OAuthClientAuthHandler{#i;constructor(a){super(a),this.#i=a.tokenRefreshEndpoint}async refreshToken(a,b){let c={...i.RETRY_CONFIG,url:this.#i,method:"POST",headers:b,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:a})};d.AuthClient.setMethodName(c,"refreshToken"),this.applyClientAuthenticationOptions(c);try{let a=await this.transporter.request(c),b=a.data;return b.res=a,b}catch(a){if(a instanceof f.GaxiosError&&a.response)throw(0,e.getErrorFromOAuthErrorResponse)(a.response.data,a);throw a}}}class j extends d.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(a){super(a),a.universe_domain&&(this.universeDomain=a.universe_domain),this.refreshToken=a.refresh_token;let b={confidentialClientType:"basic",clientId:a.client_id,clientSecret:a.client_secret};this.externalAccountAuthorizedUserHandler=new i({tokenRefreshEndpoint:a.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:b}),this.cachedAccessToken=null,this.quotaProjectId=a.quota_project_id,"number"!=typeof a?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=h.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!a?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=f.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,e=c.config.data instanceof g.Readable;if(!b&&(401===d||403===d)&&!e&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+1e3*a.expires_in,res:a.res},void 0!==a.refresh_token&&(this.refreshToken=a.refresh_token),this.cachedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}b.ExternalAccountAuthorizedUserClient=j},54047:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.GCE_LINUX_BIOS_PATHS=void 0,b.isGoogleCloudServerless=g,b.isGoogleComputeEngineLinux=h,b.isGoogleComputeEngineMACAddress=i,b.isGoogleComputeEngine=j,b.detectGCPResidency=function(){return g()||j()};let d=c(29021),e=c(21820);b.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let f=/^42:01/;function g(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function h(){if("linux"!==(0,e.platform)())return!1;try{(0,d.statSync)(b.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let a=(0,d.readFileSync)(b.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(a)}catch{return!1}}function i(){for(let a of Object.values((0,e.networkInterfaces)()))if(a){for(let{mac:b}of a)if(f.test(b))return!0}return!1}function j(){return h()||i()}},56726:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.CertificateSubjectTokenSupplier=b.InvalidConfigurationError=b.CertificateSourceUnavailableError=b.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let d=c(17849),e=c(29021),f=c(55511),g=c(55591);b.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class h extends Error{constructor(a){super(a),this.name="CertificateSourceUnavailableError"}}b.CertificateSourceUnavailableError=h;class i extends Error{constructor(a){super(a),this.name="InvalidConfigurationError"}}b.InvalidConfigurationError=i;class j{certificateConfigPath;trustChainPath;cert;key;constructor(a){if(!a.useDefaultCertificateConfig&&!a.certificateConfigLocation)throw new i("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(a.useDefaultCertificateConfig&&a.certificateConfigLocation)throw new i("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=a.trustChainPath,this.certificateConfigPath=a.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new i("Cannot create mTLS Agent with missing certificate or key");return new g.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#j();let{certPath:a,keyPath:b}=await this.#k();return{cert:this.cert,key:this.key}=await this.#l(a,b),await this.#m(this.cert)}async #j(){let a=this.certificateConfigPath;if(a){if(await (0,d.isValidFile)(a))return a;throw new h(`Provided certificate config path is invalid: ${a}`)}let c=process.env[b.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(c){if(await (0,d.isValidFile)(c))return c;throw new h(`Path from environment variable "${b.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${c}`)}let e=(0,d.getWellKnownCertificateConfigFileLocation)();if(await (0,d.isValidFile)(e))return e;throw new h(`Could not find certificate configuration file. Searched override path, the "${b.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${e}).`)}async #k(){let a,b=this.certificateConfigPath;try{a=await e.promises.readFile(b,"utf8")}catch(a){throw new h(`Failed to read certificate config file at: ${b}`)}try{let c=JSON.parse(a),d=c?.cert_configs?.workload?.cert_path,e=c?.cert_configs?.workload?.key_path;if(!d||!e)throw new i(`Certificate config file (${b}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:d,keyPath:e}}catch(a){if(a instanceof i)throw a;throw new i(`Failed to parse certificate config from ${b}: ${a.message}`)}}async #l(a,b){let c,d;try{c=await e.promises.readFile(a),new f.X509Certificate(c)}catch(c){let b=c instanceof Error?c.message:String(c);throw new h(`Failed to read certificate file at ${a}: ${b}`)}try{d=await e.promises.readFile(b),(0,f.createPrivateKey)(d)}catch(c){let a=c instanceof Error?c.message:String(c);throw new h(`Failed to read private key file at ${b}: ${a}`)}return{cert:c,key:d}}async #m(a){let b=new f.X509Certificate(a);if(!this.trustChainPath)return JSON.stringify([b.raw.toString("base64")]);try{let a,c=((await e.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((a,b)=>{try{return new f.X509Certificate(a)}catch(c){let a=c instanceof Error?c.message:String(c);throw new i(`Failed to parse certificate at index ${b} in trust chain file ${this.trustChainPath}: ${a}`)}}),d=c.findIndex(a=>b.raw.equals(a.raw));if(-1===d)a=[b,...c];else if(0===d)a=c;else throw new i(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${d}).`);return JSON.stringify(a.map(a=>a.raw.toString("base64")))}catch(b){if(b instanceof i)throw b;let a=b instanceof Error?b.message:String(b);throw new h(`Failed to process certificate chain from ${this.trustChainPath}: ${a}`)}}}b.CertificateSubjectTokenSupplier=j},66281:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.DownscopedClient=b.EXPIRATION_TIME_OFFSET=b.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let d=c(20147),e=c(27910),f=c(12235),g=c(50256);b.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,b.EXPIRATION_TIME_OFFSET=3e5;class h extends f.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(a,c={accessBoundary:{accessBoundaryRules:[]}}){if(super(a instanceof f.AuthClient?{}:a),a instanceof f.AuthClient?(this.authClient=a,this.credentialAccessBoundary=c):(this.authClient=a.authClient,this.credentialAccessBoundary=a.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>b.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${b.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let a of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===a.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(a){if(!a.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(a),this.cachedDownscopedAccessToken=a}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=(await this.authClient.getAccessToken()).token,b=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),c=this.authClient.credentials?.expiry_date||null,d=b.expires_in?new Date().getTime()+1e3*b.expires_in:c;return this.cachedDownscopedAccessToken={access_token:b.access_token,expiry_date:d,res:b.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}b.DownscopedClient=h},67420:(a,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.InvalidSubjectTokenError=b.InvalidMessageFieldError=b.InvalidCodeFieldError=b.InvalidTokenTypeFieldError=b.InvalidExpirationTimeFieldError=b.InvalidSuccessFieldError=b.InvalidVersionFieldError=b.ExecutableResponseError=b.ExecutableResponse=void 0;let c="urn:ietf:params:oauth:token-type:saml2",d="urn:ietf:params:oauth:token-type:id_token",e="urn:ietf:params:oauth:token-type:jwt";class f{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(a){if(!a.version)throw new h("Executable response must contain a 'version' field.");if(void 0===a.success)throw new i("Executable response must contain a 'success' field.");if(this.version=a.version,this.success=a.success,this.success){if(this.expirationTime=a.expiration_time,this.tokenType=a.token_type,this.tokenType!==c&&this.tokenType!==d&&this.tokenType!==e)throw new k(`Executable response must contain a 'token_type' field when successful and it must be one of ${d}, ${e}, or ${c}.`);if(this.tokenType===c){if(!a.saml_response)throw new n(`Executable response must contain a 'saml_response' field when token_type=${c}.`);this.subjectToken=a.saml_response}else{if(!a.id_token)throw new n(`Executable response must contain a 'id_token' field when token_type=${d} or ${e}.`);this.subjectToken=a.id_token}}else{if(!a.code)throw new l("Executable response must contain a 'code' field when unsuccessful.");if(!a.message)throw new m("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=a.code,this.errorMessage=a.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}b.ExecutableResponse=f;class g extends Error{constructor(a){super(a),Object.setPrototypeOf(this,new.target.prototype)}}b.ExecutableResponseError=g;class h extends g{}b.InvalidVersionFieldError=h;class i extends g{}b.InvalidSuccessFieldError=i;class j extends g{}b.InvalidExpirationTimeFieldError=j;class k extends g{}b.InvalidTokenTypeFieldError=k;class l extends g{}b.InvalidCodeFieldError=l;class m extends g{}b.InvalidMessageFieldError=m;class n extends g{}b.InvalidSubjectTokenError=n},68624:(a,b,c)=>{var d;let e;Object.defineProperty(b,"__esModule",{value:!0}),b.GCPEnv=void 0,b.clear=function(){e=void 0},b.getEnv=g;let f=c(48928);async function g(){return e||(e=h())}async function h(){d.NONE;return process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?d.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?d.CLOUD_FUNCTIONS:await j()?await i()?d.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?d.CLOUD_RUN:process.env.CLOUD_RUN_JOB?d.CLOUD_RUN_JOBS:d.COMPUTE_ENGINE:d.NONE}async function i(){try{return await f.instance("attributes/cluster-name"),!0}catch(a){return!1}}async function j(){return f.isAvailable()}!function(a){a.APP_ENGINE="APP_ENGINE",a.KUBERNETES_ENGINE="KUBERNETES_ENGINE",a.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",a.COMPUTE_ENGINE="COMPUTE_ENGINE",a.CLOUD_RUN="CLOUD_RUN",a.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",a.NONE="NONE"}(d||(b.GCPEnv=d={}))},69674:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.AwsClient=void 0;let d=c(85398),e=c(80571),f=c(34350),g=c(17849),h=c(20147);class i extends e.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #n="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(a){super(a);let b=(0,g.originalOrCamelOptions)(a),c=b.get("credential_source"),d=b.get("aws_security_credentials_supplier");if(!c&&!d)throw Error("A credential source or AWS security credentials supplier must be specified.");if(c&&d)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(d)this.awsSecurityCredentialsSupplier=d,this.regionalCredVerificationUrl=i.#n,this.credentialSourceType="programmatic";else{let a=(0,g.originalOrCamelOptions)(c);this.environmentId=a.get("environment_id");let b=a.get("region_url"),d=a.get("url"),e=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new f.DefaultAwsSecurityCredentialsSupplier({regionUrl:b,securityCredentialsUrl:d,imdsV2SessionTokenUrl:e}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let a=this.environmentId?.match(/^(aws)(\d+)$/);if(a&&this.regionalCredVerificationUrl){if(1!==parseInt(a[2],10))throw Error(`aws version "${a[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new d.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let a=await this.awsRequestSigner.getRequestOptions({...i.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),b=[];return h.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},a.headers).forEach((a,c)=>b.push({key:c,value:a})),encodeURIComponent(JSON.stringify({url:a.url,method:a.method,headers:b}))}}b.AwsClient=i},80571:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.BaseExternalAccountClient=b.CLOUD_RESOURCE_MANAGER=b.EXTERNAL_ACCOUNT_TYPE=b.EXPIRATION_TIME_OFFSET=void 0;let d=c(20147),e=c(27910),f=c(12235),g=c(50256),h=c(17849),i=c(40993),j="https://www.googleapis.com/auth/cloud-platform";b.EXPIRATION_TIME_OFFSET=3e5,b.EXTERNAL_ACCOUNT_TYPE="external_account",b.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class k extends f.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#o=null;constructor(a){super(a);let c=(0,h.originalOrCamelOptions)(a),d=c.get("type");if(d&&d!==b.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${b.EXTERNAL_ACCOUNT_TYPE}" type but received "${a.type}"`);let e=c.get("client_id"),f=c.get("client_secret");this.tokenUrl=c.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);let i=c.get("subject_token_type"),k=c.get("workforce_pool_user_project"),l=c.get("service_account_impersonation_url"),m=c.get("service_account_impersonation"),n=(0,h.originalOrCamelOptions)(m).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(c.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),e&&(this.clientAuth={confidentialClientType:"basic",clientId:e,clientSecret:f}),this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=c.get("scopes")||[j],this.cachedAccessToken=null,this.audience=c.get("audience"),this.subjectTokenType=i,this.workforcePoolUserProject=k;let o=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(o))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=n,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let a=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return a?.groups?.email||null}return null}setCredentials(a){super.setCredentials(a),this.cachedAccessToken=a}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async getProjectId(){let a=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(a){let b=await this.getRequestHeaders(),c={...k.RETRY_CONFIG,headers:b,url:`${this.cloudResourceManagerURL.toString()}${a}`};f.AuthClient.setMethodName(c,"getProjectId");let d=await this.transporter.request(c);return this.projectId=d.data.projectId,this.projectId}return null}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){this.#o=this.#o||this.#p();try{return await this.#o}finally{this.#o=null}}async #p(){let a=await this.retrieveSubjectToken(),b={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[j]:this.getScopesArray()},c=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,d=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),e=await this.stsCredential.exchangeToken(b,d,c);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(e.access_token):e.expires_in?this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res}:this.cachedAccessToken={access_token:e.access_token,res:e.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(a){let b=a.match(/\/projects\/([^/]+)/);return b?b[1]:null}async getImpersonatedAccessToken(a){let b={...k.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};f.AuthClient.setMethodName(b,"getImpersonatedAccessToken");let c=await this.transporter.request(b),d=c.data;return{access_token:d.accessToken,expiry_date:new Date(d.expireTime).getTime(),res:c}}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[j]}getMetricsHeaderValue(){let a=process.version.replace(/^v/,""),b=void 0!==this.serviceAccountImpersonationUrl,c=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${a} auth/${i.pkg.version} google-byoid-sdk source/${c} sa-impersonation/${b} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}b.BaseExternalAccountClient=k},85398:(a,b,c)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.AwsRequestSigner=void 0;let d=c(20147),e=c(13366),f="AWS4-HMAC-SHA256";class g{getCredentials;region;crypto;constructor(a,b){this.getCredentials=a,this.region=b,this.crypto=(0,e.createCrypto)()}async getRequestOptions(a){if(!a.url)throw RangeError('"url" is required in "amzOptions"');let b="object"==typeof a.data?JSON.stringify(a.data):a.data,c=a.url,e=a.method||"GET",f=a.body||b,g=a.headers,h=await this.getCredentials(),i=new URL(c);if("string"!=typeof f&&void 0!==f)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${f}`);let k=await j({crypto:this.crypto,host:i.host,canonicalUri:i.pathname,canonicalQuerystring:i.search.slice(1),method:e,region:this.region,securityCredentials:h,requestPayload:f,additionalAmzHeaders:g}),l=d.Gaxios.mergeHeaders(k.amzDate?{"x-amz-date":k.amzDate}:{},{authorization:k.authorizationHeader,host:i.host},g||{});h.token&&d.Gaxios.mergeHeaders(l,{"x-amz-security-token":h.token});let m={url:c,method:e,headers:l};return void 0!==f&&(m.body=f),m}}async function h(a,b,c){return await a.signWithHmacSha256(b,c)}async function i(a,b,c,d,e){let f=await h(a,`AWS4${b}`,c),g=await h(a,f,d),i=await h(a,g,e);return await h(a,i,"aws4_request")}async function j(a){let b=d.Gaxios.mergeHeaders(a.additionalAmzHeaders),c=a.requestPayload||"",g=a.host.split(".")[0],j=new Date,k=j.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),l=j.toISOString().replace(/[-]/g,"").replace(/T.*/,"");a.securityCredentials.token&&b.set("x-amz-security-token",a.securityCredentials.token);let m=d.Gaxios.mergeHeaders({host:a.host},b.has("date")?{}:{"x-amz-date":k},b),n="",o=[...m.keys()].sort();o.forEach(a=>{n+=`${a}:${m.get(a)}
`});let p=o.join(";"),q=await a.crypto.sha256DigestHex(c),r=`${a.method.toUpperCase()}
${a.canonicalUri}
${a.canonicalQuerystring}
${n}
${p}
${q}`,s=`${l}/${a.region}/${g}/aws4_request`,t=`${f}
${k}
${s}
`+await a.crypto.sha256DigestHex(r),u=await i(a.crypto,a.securityCredentials.secretAccessKey,l,a.region,g),v=await h(a.crypto,u,t),w=`${f} Credential=${a.securityCredentials.accessKeyId}/${s}, SignedHeaders=${p}, Signature=${(0,e.fromArrayBufferToHex)(v)}`;return{amzDate:b.has("date")?void 0:k,authorizationHeader:w,canonicalQuerystring:a.canonicalQuerystring}}b.AwsRequestSigner=g},90209:(a,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.IAMAuth=void 0;class c{selector;token;constructor(a,b){this.selector=a,this.token=b,this.selector=a,this.token=b}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}b.IAMAuth=c}};