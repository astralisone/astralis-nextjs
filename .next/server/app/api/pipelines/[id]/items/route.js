"use strict";(()=>{var e={};e.id=584,e.ids=[584],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8463:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>x});var i={};r.r(i),r.d(i,{GET:()=>u,POST:()=>c});var s=r(9303),a=r(8716),n=r(670),o=r(7070),p=r(1067),d=r(3538);let l=p.Ry({title:p.Z_().min(2),data:p.Yj(),stageId:p.Z_()});async function u(e,{params:t}){try{let{id:e}=t,r=await d._.pipeline.findUnique({where:{id:e},include:{stages:{orderBy:{order:"asc"},include:{items:{orderBy:{createdAt:"desc"}}}}}});if(!r)return o.NextResponse.json({error:"Pipeline not found"},{status:404});return o.NextResponse.json({pipelineId:r.id,pipelineName:r.name,stages:r.stages})}catch(e){return console.error("Error fetching pipeline items:",e),o.NextResponse.json({error:"Failed to fetch pipeline items"},{status:500})}}async function c(e,{params:t}){try{let r=await e.json(),i=l.safeParse(r);if(!i.success)return o.NextResponse.json({error:"Invalid payload",details:i.error.flatten()},{status:400});let{id:s}=t;if(!await d._.stage.findFirst({where:{id:i.data.stageId,pipelineId:s}}))return o.NextResponse.json({error:"Stage not found in this pipeline"},{status:404});let a=await d._.pipelineItem.create({data:{title:i.data.title,data:i.data.data,stageId:i.data.stageId}});return o.NextResponse.json(a,{status:201})}catch(e){return console.error("Error creating pipeline item:",e),o.NextResponse.json({error:"Failed to create pipeline item"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/pipelines/[id]/items/route",pathname:"/api/pipelines/[id]/items",filename:"route",bundlePath:"app/api/pipelines/[id]/items/route"},resolvedPagePath:"/Users/gregorystarr/projects/astralis-nextjs/src/app/api/pipelines/[id]/items/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:x,serverHooks:f}=m,h="/api/pipelines/[id]/items/route";function j(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:x})}},3538:(e,t,r)=>{r.d(t,{_:()=>s});var i=r(3524);let s=globalThis.prisma??new i.PrismaClient({log:["error","warn"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,934],()=>r(8463));module.exports=i})();