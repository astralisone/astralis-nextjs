"use strict";(()=>{var t={};t.id=868,t.ids=[868],t.modules={3524:t=>{t.exports=require("@prisma/client")},399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4648:(t,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>j,staticGenerationAsyncStorage:()=>h});var r={};o.r(r),o.d(r,{GET:()=>c,PATCH:()=>g,POST:()=>m,PUT:()=>f});var a=o(9303),n=o(8716),s=o(670),i=o(7070),u=o(1067),l=o(3538);let d=u.Ry({name:u.Z_().min(2),description:u.Z_().optional(),workflowId:u.Z_().optional(),webhookUrl:u.Z_().url().optional(),triggerConfig:u.Yj(),isActive:u.O7().optional().default(!0),orgId:u.Z_()}),p=u.Ry({name:u.Z_().min(2).optional(),description:u.Z_().optional(),workflowId:u.Z_().optional(),webhookUrl:u.Z_().url().optional(),triggerConfig:u.Yj().optional(),isActive:u.O7().optional()});async function c(t){try{let{searchParams:e}=t.nextUrl,o=e.get("orgId"),r=e.get("isActive"),a=parseInt(e.get("limit")||"50"),n=parseInt(e.get("offset")||"0"),s={};o&&(s.orgId=o),null!=r&&(s.isActive="true"===r);let[u,d]=await Promise.all([l._.automation.findMany({where:s,orderBy:[{isActive:"desc"},{lastRunAt:"desc"},{createdAt:"desc"}],take:a,skip:n}),l._.automation.count({where:s})]);return i.NextResponse.json({automations:u,pagination:{total:d,limit:a,offset:n,hasMore:n+a<d}})}catch(t){return console.error("Error fetching automations:",t),i.NextResponse.json({error:"Failed to fetch automations"},{status:500})}}async function m(t){try{let e=await t.json(),o=d.safeParse(e);if(!o.success)return i.NextResponse.json({error:"Invalid payload",details:o.error.flatten()},{status:400});let{name:r,description:a,workflowId:n,webhookUrl:s,triggerConfig:u,isActive:p,orgId:c}=o.data;if(!await l._.organization.findUnique({where:{id:c}}))return i.NextResponse.json({error:"Organization not found"},{status:404});let m=await l._.automation.create({data:{name:r,description:a,workflowId:n,webhookUrl:s,triggerConfig:u,isActive:p??!0,orgId:c,runCount:0}});return i.NextResponse.json(m,{status:201})}catch(t){return console.error("Error creating automation:",t),i.NextResponse.json({error:"Failed to create automation"},{status:500})}}async function f(t){try{let{id:e,...o}=await t.json();if(!e)return i.NextResponse.json({error:"Automation ID is required"},{status:400});let r=p.safeParse(o);if(!r.success)return i.NextResponse.json({error:"Invalid payload",details:r.error.flatten()},{status:400});if(!await l._.automation.findUnique({where:{id:e}}))return i.NextResponse.json({error:"Automation not found"},{status:404});let a=await l._.automation.update({where:{id:e},data:{...r.data,updatedAt:new Date}});return i.NextResponse.json(a)}catch(t){return console.error("Error updating automation:",t),i.NextResponse.json({error:"Failed to update automation"},{status:500})}}async function g(t){try{let{id:e,isActive:o,webhookUrl:r}=await t.json();if(!e)return i.NextResponse.json({error:"Automation ID is required"},{status:400});if(!await l._.automation.findUnique({where:{id:e}}))return i.NextResponse.json({error:"Automation not found"},{status:404});let a={updatedAt:new Date};if(void 0!==o&&(a.isActive=o),void 0!==r){if(r&&!u.Z_().url().safeParse(r).success)return i.NextResponse.json({error:"Invalid webhook URL format"},{status:400});a.webhookUrl=r}let n=await l._.automation.update({where:{id:e},data:a});return i.NextResponse.json({automation:n,message:void 0!==o?`Automation ${n.isActive?"activated":"deactivated"} successfully`:"Automation updated successfully"})}catch(t){return console.error("Error patching automation:",t),i.NextResponse.json({error:"Failed to update automation"},{status:500})}}let w=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/automations/route",pathname:"/api/automations",filename:"route",bundlePath:"app/api/automations/route"},resolvedPagePath:"/Users/gregorystarr/projects/astralis-nextjs/src/app/api/automations/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:x,staticGenerationAsyncStorage:h,serverHooks:j}=w,v="/api/automations/route";function A(){return(0,s.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:h})}},3538:(t,e,o)=>{o.d(e,{_:()=>a});var r=o(3524);let a=globalThis.prisma??new r.PrismaClient({log:["error","warn"]})}};var e=require("../../../webpack-runtime.js");e.C(t);var o=t=>e(e.s=t),r=e.X(0,[276,934],()=>o(4648));module.exports=r})();