{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\nconst globalForPrisma = globalThis as unknown as { prisma?: PrismaClient };\n\nexport const prisma =\n  globalForPrisma.prisma ??\n  new PrismaClient({\n    log: [\"error\", \"warn\"],\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalForPrisma.prisma = prisma;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAO;AACxB;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B","debugId":null}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/lib/utils/crypto.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\n\nconst SALT_ROUNDS = 12;\n\n/**\n * Hash a password using bcrypt\n * @param password Plain text password\n * @returns Hashed password\n */\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, SALT_ROUNDS);\n}\n\n/**\n * Verify password against hash\n * @param password Plain text password\n * @param hash Stored password hash\n * @returns True if password matches\n */\nexport async function verifyPassword(\n  password: string,\n  hash: string\n): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\n/**\n * Generate random token for email verification\n * @returns Random token string\n */\nexport function generateToken(): string {\n  return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM,cAAc;AAOb,eAAe,aAAa,QAAgB;IACjD,OAAO,gLAAM,CAAC,IAAI,CAAC,UAAU;AAC/B;AAQO,eAAe,eACpB,QAAgB,EAChB,IAAY;IAEZ,OAAO,gLAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAMO,SAAS;IACd,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,KAAK,KAAK,GAAG,GAAG,QAAQ,CAAC;AACvE","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer';\nimport type { Transporter } from 'nodemailer';\n\n/**\n * Email Service using Nodemailer\n *\n * Sends booking confirmation emails to customers and notifications to support team.\n * Supports SMTP configuration via environment variables.\n */\n\ninterface EmailOptions {\n  to: string;\n  subject: string;\n  html: string;\n  text?: string;\n  attachments?: Array<{\n    filename: string;\n    content: string | Buffer;\n    contentType?: string;\n  }>;\n}\n\n/**\n * Create nodemailer transporter\n * Configure SMTP settings in environment variables\n */\nfunction createTransporter(): Transporter {\n  const smtpConfig = {\n    host: process.env.SMTP_HOST,\n    port: parseInt(process.env.SMTP_PORT || '587'),\n    secure: process.env.SMTP_SECURE === 'true', // true for 465, false for other ports\n    auth: {\n      user: process.env.SMTP_USER,\n      pass: process.env.SMTP_PASSWORD,\n    },\n  };\n\n  return nodemailer.createTransport(smtpConfig);\n}\n\n/**\n * Send an email\n */\nexport async function sendEmail(options: EmailOptions): Promise<void> {\n  const transporter = createTransporter();\n\n  const mailOptions = {\n    from: `\"${process.env.SMTP_FROM_NAME || 'Astralis'}\" <${process.env.SMTP_FROM_EMAIL || 'support@astralisone.com'}>`,\n    to: options.to,\n    subject: options.subject,\n    text: options.text,\n    html: options.html,\n    attachments: options.attachments,\n  };\n\n  await transporter.sendMail(mailOptions);\n}\n\n/**\n * Generate HTML email for customer booking confirmation\n */\nexport function generateCustomerConfirmationEmail(booking: {\n  bookingId: string;\n  name: string;\n  email: string;\n  phone: string;\n  company?: string;\n  date: string;\n  time: string;\n  meetingType: string;\n  message?: string;\n}): string {\n  const meetingTypeLabel = {\n    VIDEO_CALL: 'Video Call',\n    PHONE_CALL: 'Phone Call',\n    IN_PERSON: 'In-Person Meeting',\n  }[booking.meetingType] || booking.meetingType;\n\n  return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>Booking Confirmation</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f5f5f5; padding: 40px 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n          <!-- Header -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #0A1B2B 0%, #1a3a52 100%); padding: 40px 30px; text-align: center;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;\">ASTRALIS</h1>\n              <p style=\"margin: 10px 0 0 0; color: #94a3b8; font-size: 16px;\">Your consultation is confirmed!</p>\n            </td>\n          </tr>\n\n          <!-- Success Icon -->\n          <tr>\n            <td style=\"padding: 40px 30px 20px; text-align: center;\">\n              <div style=\"width: 60px; height: 60px; background-color: #22c55e; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center;\">\n                <span style=\"color: white; font-size: 30px;\">âœ“</span>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Content -->\n          <tr>\n            <td style=\"padding: 0 30px 30px;\">\n              <h2 style=\"margin: 0 0 20px; color: #0A1B2B; font-size: 22px; text-align: center;\">Hi ${booking.name},</h2>\n              <p style=\"margin: 0 0 20px; color: #475569; font-size: 16px; line-height: 1.6;\">\n                Thank you for scheduling a consultation with us! We're excited to discuss your automation needs and explore how Astralis can help transform your operations.\n              </p>\n\n              <!-- Booking Details Card -->\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f8fafc; border-radius: 8px; margin: 20px 0;\">\n                <tr>\n                  <td style=\"padding: 25px;\">\n                    <h3 style=\"margin: 0 0 15px; color: #0A1B2B; font-size: 18px;\">Meeting Details</h3>\n\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Booking ID:</td>\n                        <td style=\"padding: 8px 0; color: #1e293b; font-size: 14px; text-align: right;\">${booking.bookingId}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Date:</td>\n                        <td style=\"padding: 8px 0; color: #1e293b; font-size: 14px; text-align: right;\">${booking.date}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Time:</td>\n                        <td style=\"padding: 8px 0; color: #1e293b; font-size: 14px; text-align: right;\">${booking.time}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Duration:</td>\n                        <td style=\"padding: 8px 0; color: #1e293b; font-size: 14px; text-align: right;\">30 minutes</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 8px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Meeting Type:</td>\n                        <td style=\"padding: 8px 0; color: #1e293b; font-size: 14px; text-align: right;\">${meetingTypeLabel}</td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              <!-- What's Next -->\n              <div style=\"margin: 30px 0;\">\n                <h3 style=\"margin: 0 0 15px; color: #0A1B2B; font-size: 18px;\">What happens next?</h3>\n                <ul style=\"margin: 0; padding: 0 0 0 20px; color: #475569; font-size: 15px; line-height: 1.8;\">\n                  <li>We'll send you a calendar invite (attached to this email)</li>\n                  <li>A confirmation email will be sent to your calendar</li>\n                  ${booking.meetingType === 'VIDEO_CALL' ? '<li>You\\'ll receive a video call link 1 hour before the meeting</li>' : ''}\n                  ${booking.meetingType === 'PHONE_CALL' ? '<li>We\\'ll call you at ' + booking.phone + ' at the scheduled time</li>' : ''}\n                  <li>Feel free to prepare any questions or materials you'd like to discuss</li>\n                </ul>\n              </div>\n\n              <!-- Need to Reschedule -->\n              <div style=\"margin: 30px 0; padding: 20px; background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;\">\n                <p style=\"margin: 0; color: #92400e; font-size: 14px; line-height: 1.6;\">\n                  <strong>Need to reschedule?</strong><br>\n                  Contact us at <a href=\"mailto:support@astralisone.com\" style=\"color: #f59e0b; text-decoration: none;\">support@astralisone.com</a>\n                  or call <a href=\"tel:+13412234433\" style=\"color: #f59e0b; text-decoration: none;\">+1 (341) 223-4433</a>\n                </p>\n              </div>\n\n              <p style=\"margin: 30px 0 0; color: #475569; font-size: 15px; line-height: 1.6;\">\n                We look forward to speaking with you!\n              </p>\n              <p style=\"margin: 10px 0 0; color: #475569; font-size: 15px; line-height: 1.6;\">\n                Best regards,<br>\n                <strong style=\"color: #0A1B2B;\">The Astralis Team</strong>\n              </p>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background-color: #f8fafc; padding: 30px; text-align: center; border-top: 1px solid #e2e8f0;\">\n              <p style=\"margin: 0 0 10px; color: #64748b; font-size: 14px;\">\n                <strong>ASTRALIS</strong>\n              </p>\n              <p style=\"margin: 0; color: #94a3b8; font-size: 12px;\">\n                <a href=\"mailto:support@astralisone.com\" style=\"color: #3b82f6; text-decoration: none;\">support@astralisone.com</a> |\n                <a href=\"tel:+13412234433\" style=\"color: #3b82f6; text-decoration: none;\">+1 (341) 223-4433</a>\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  `;\n}\n\n/**\n * Generate plain text version of customer confirmation email\n */\nexport function generateCustomerConfirmationText(booking: {\n  bookingId: string;\n  name: string;\n  email: string;\n  phone: string;\n  company?: string;\n  date: string;\n  time: string;\n  meetingType: string;\n  message?: string;\n}): string {\n  const meetingTypeLabel = {\n    VIDEO_CALL: 'Video Call',\n    PHONE_CALL: 'Phone Call',\n    IN_PERSON: 'In-Person Meeting',\n  }[booking.meetingType] || booking.meetingType;\n\n  return `\nASTRALIS - Your consultation is confirmed!\n\nHi ${booking.name},\n\nThank you for scheduling a consultation with us! We're excited to discuss your automation needs.\n\nMEETING DETAILS\n----------------\nBooking ID: ${booking.bookingId}\nDate: ${booking.date}\nTime: ${booking.time}\nDuration: 30 minutes\nMeeting Type: ${meetingTypeLabel}\n\nWHAT HAPPENS NEXT?\n-------------------\n- We'll send you a calendar invite (attached to this email)\n- A confirmation will be sent to your calendar\n${booking.meetingType === 'VIDEO_CALL' ? '- You\\'ll receive a video call link 1 hour before the meeting' : ''}\n${booking.meetingType === 'PHONE_CALL' ? '- We\\'ll call you at ' + booking.phone + ' at the scheduled time' : ''}\n- Feel free to prepare any questions or materials you'd like to discuss\n\nNEED TO RESCHEDULE?\n-------------------\nContact us at support@astralisone.com or call +1 (341) 223-4433\n\nWe look forward to speaking with you!\n\nBest regards,\nThe Astralis Team\n\n---\nASTRALIS\nsupport@astralisone.com | +1 (341) 223-4433\n  `.trim();\n}\n\n/**\n * Generate HTML email for internal notification to support team\n */\nexport function generateInternalNotificationEmail(booking: {\n  bookingId: string;\n  name: string;\n  email: string;\n  phone: string;\n  company?: string;\n  date: string;\n  time: string;\n  meetingType: string;\n  message?: string;\n}): string {\n  const meetingTypeLabel = {\n    VIDEO_CALL: 'Video Call',\n    PHONE_CALL: 'Phone Call',\n    IN_PERSON: 'In-Person Meeting',\n  }[booking.meetingType] || booking.meetingType;\n\n  return `\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>New Booking Received</title>\n</head>\n<body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n  <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f5f5f5; padding: 40px 20px;\">\n    <tr>\n      <td align=\"center\">\n        <table width=\"600\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #ffffff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);\">\n          <!-- Header -->\n          <tr>\n            <td style=\"background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 30px; text-align: center;\">\n              <h1 style=\"margin: 0; color: #ffffff; font-size: 24px; font-weight: bold;\">ðŸ”” New Consultation Booking</h1>\n              <p style=\"margin: 10px 0 0 0; color: #dbeafe; font-size: 14px;\">Booking ID: ${booking.bookingId}</p>\n            </td>\n          </tr>\n\n          <!-- Content -->\n          <tr>\n            <td style=\"padding: 30px;\">\n              <h2 style=\"margin: 0 0 20px; color: #0A1B2B; font-size: 20px;\">Client Information</h2>\n\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f8fafc; border-radius: 8px; margin-bottom: 20px;\">\n                <tr>\n                  <td style=\"padding: 20px;\">\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #64748b; font-size: 14px; font-weight: 600; width: 40%;\">Name:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">${booking.name}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Email:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">\n                          <a href=\"mailto:${booking.email}\" style=\"color: #3b82f6; text-decoration: none;\">${booking.email}</a>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Phone:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">\n                          <a href=\"tel:${booking.phone}\" style=\"color: #3b82f6; text-decoration: none;\">${booking.phone}</a>\n                        </td>\n                      </tr>\n                      ${booking.company ? `\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #64748b; font-size: 14px; font-weight: 600;\">Company:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">${booking.company}</td>\n                      </tr>\n                      ` : ''}\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              <h2 style=\"margin: 30px 0 20px; color: #0A1B2B; font-size: 20px;\">Meeting Details</h2>\n\n              <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color: #f0f9ff; border-radius: 8px; border: 2px solid #3b82f6; margin-bottom: 20px;\">\n                <tr>\n                  <td style=\"padding: 20px;\">\n                    <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #1e40af; font-size: 14px; font-weight: 600; width: 40%;\">Date:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px; font-weight: bold;\">${booking.date}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #1e40af; font-size: 14px; font-weight: 600;\">Time:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px; font-weight: bold;\">${booking.time}</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #1e40af; font-size: 14px; font-weight: 600;\">Duration:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">30 minutes</td>\n                      </tr>\n                      <tr>\n                        <td style=\"padding: 6px 0; color: #1e40af; font-size: 14px; font-weight: 600;\">Meeting Type:</td>\n                        <td style=\"padding: 6px 0; color: #1e293b; font-size: 14px;\">${meetingTypeLabel}</td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n              </table>\n\n              ${booking.message ? `\n              <h2 style=\"margin: 30px 0 15px; color: #0A1B2B; font-size: 20px;\">Discussion Topics</h2>\n              <div style=\"background-color: #fefce8; border-left: 4px solid #eab308; padding: 15px; border-radius: 4px; margin-bottom: 20px;\">\n                <p style=\"margin: 0; color: #713f12; font-size: 14px; line-height: 1.6; white-space: pre-wrap;\">${booking.message}</p>\n              </div>\n              ` : ''}\n\n              <!-- Action Items -->\n              <div style=\"margin: 30px 0; padding: 20px; background-color: #f0fdf4; border-radius: 8px; border-left: 4px solid #22c55e;\">\n                <h3 style=\"margin: 0 0 10px; color: #166534; font-size: 16px;\">Action Required</h3>\n                <ul style=\"margin: 0; padding: 0 0 0 20px; color: #166534; font-size: 14px; line-height: 1.8;\">\n                  <li>Add this consultation to your calendar (ICS file attached)</li>\n                  <li>Review client information and discussion topics</li>\n                  ${booking.meetingType === 'VIDEO_CALL' ? '<li>Prepare video call link and send 1 hour before meeting</li>' : ''}\n                  ${booking.meetingType === 'PHONE_CALL' ? '<li>Ensure you have the client\\'s phone number ready</li>' : ''}\n                  <li>Prepare any relevant materials or questions</li>\n                </ul>\n              </div>\n            </td>\n          </tr>\n\n          <!-- Footer -->\n          <tr>\n            <td style=\"background-color: #f8fafc; padding: 20px; text-align: center; border-top: 1px solid #e2e8f0;\">\n              <p style=\"margin: 0; color: #64748b; font-size: 12px;\">\n                This is an automated notification from the Astralis booking system.\n              </p>\n            </td>\n          </tr>\n        </table>\n      </td>\n    </tr>\n  </table>\n</body>\n</html>\n  `;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 526, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/lib/utils/email-templates.ts"],"sourcesContent":["import { sendEmail } from '@/lib/email';\n\nconst BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL || 'http://localhost:3001';\n\n/**\n * Send email verification link\n */\nexport async function sendVerificationEmail(email: string, token: string) {\n  const verifyUrl = `${BASE_URL}/auth/verify-email?token=${token}`;\n\n  const html = `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"UTF-8\">\n      <title>Verify Your Email - AstralisOps</title>\n    </head>\n    <body style=\"font-family: 'Inter', sans-serif; line-height: 1.6; color: #0A1B2B; max-width: 600px; margin: 0 auto; padding: 20px;\">\n      <div style=\"background-color: #2B6CB0; padding: 20px; text-align: center;\">\n        <h1 style=\"color: white; margin: 0;\">AstralisOps</h1>\n      </div>\n\n      <div style=\"background-color: #ffffff; padding: 30px; border: 1px solid #e2e8f0;\">\n        <h2 style=\"color: #0A1B2B; margin-top: 0;\">Verify Your Email Address</h2>\n\n        <p>Thank you for signing up for AstralisOps! Please verify your email address by clicking the button below:</p>\n\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${verifyUrl}\" style=\"background-color: #2B6CB0; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">\n            Verify Email Address\n          </a>\n        </div>\n\n        <p style=\"color: #718096; font-size: 14px;\">\n          Or copy and paste this link into your browser:<br>\n          <a href=\"${verifyUrl}\" style=\"color: #2B6CB0; word-break: break-all;\">${verifyUrl}</a>\n        </p>\n\n        <p style=\"color: #718096; font-size: 14px; margin-top: 30px;\">\n          This verification link will expire in 24 hours.\n        </p>\n\n        <p style=\"color: #718096; font-size: 14px;\">\n          If you didn't create an account with AstralisOps, you can safely ignore this email.\n        </p>\n      </div>\n\n      <div style=\"background-color: #f7fafc; padding: 20px; text-align: center; font-size: 12px; color: #718096;\">\n        <p>Â© 2025 Astralis. All rights reserved.</p>\n      </div>\n    </body>\n    </html>\n  `;\n\n  const text = `\n    Verify Your Email Address\n\n    Thank you for signing up for AstralisOps!\n\n    Please verify your email address by visiting this link:\n    ${verifyUrl}\n\n    This verification link will expire in 24 hours.\n\n    If you didn't create an account with AstralisOps, you can safely ignore this email.\n  `;\n\n  await sendEmail({\n    to: email,\n    subject: 'Verify Your Email - AstralisOps',\n    html,\n    text,\n  });\n}\n\n/**\n * Send password reset link\n */\nexport async function sendPasswordResetEmail(email: string, token: string) {\n  const resetUrl = `${BASE_URL}/auth/reset-password?token=${token}`;\n\n  const html = `\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset=\"UTF-8\">\n      <title>Reset Your Password - AstralisOps</title>\n    </head>\n    <body style=\"font-family: 'Inter', sans-serif; line-height: 1.6; color: #0A1B2B; max-width: 600px; margin: 0 auto; padding: 20px;\">\n      <div style=\"background-color: #2B6CB0; padding: 20px; text-align: center;\">\n        <h1 style=\"color: white; margin: 0;\">AstralisOps</h1>\n      </div>\n\n      <div style=\"background-color: #ffffff; padding: 30px; border: 1px solid #e2e8f0;\">\n        <h2 style=\"color: #0A1B2B; margin-top: 0;\">Reset Your Password</h2>\n\n        <p>We received a request to reset your password. Click the button below to set a new password:</p>\n\n        <div style=\"text-align: center; margin: 30px 0;\">\n          <a href=\"${resetUrl}\" style=\"background-color: #2B6CB0; color: white; padding: 12px 30px; text-decoration: none; border-radius: 6px; display: inline-block; font-weight: 600;\">\n            Reset Password\n          </a>\n        </div>\n\n        <p style=\"color: #718096; font-size: 14px;\">\n          Or copy and paste this link into your browser:<br>\n          <a href=\"${resetUrl}\" style=\"color: #2B6CB0; word-break: break-all;\">${resetUrl}</a>\n        </p>\n\n        <p style=\"color: #718096; font-size: 14px; margin-top: 30px;\">\n          This password reset link will expire in 1 hour.\n        </p>\n\n        <p style=\"color: #718096; font-size: 14px;\">\n          If you didn't request a password reset, you can safely ignore this email. Your password will not be changed.\n        </p>\n      </div>\n\n      <div style=\"background-color: #f7fafc; padding: 20px; text-align: center; font-size: 12px; color: #718096;\">\n        <p>Â© 2025 Astralis. All rights reserved.</p>\n      </div>\n    </body>\n    </html>\n  `;\n\n  const text = `\n    Reset Your Password\n\n    We received a request to reset your password.\n\n    Visit this link to set a new password:\n    ${resetUrl}\n\n    This password reset link will expire in 1 hour.\n\n    If you didn't request a password reset, you can safely ignore this email.\n  `;\n\n  await sendEmail({\n    to: email,\n    subject: 'Reset Your Password - AstralisOps',\n    html,\n    text,\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,WAAW,6DAAwC;AAKlD,eAAe,sBAAsB,KAAa,EAAE,KAAa;IACtE,MAAM,YAAY,GAAG,SAAS,yBAAyB,EAAE,OAAO;IAEhE,MAAM,OAAO,CAAC;;;;;;;;;;;;;;;;;;mBAkBG,EAAE,UAAU;;;;;;;mBAOZ,EAAE,UAAU,iDAAiD,EAAE,UAAU;;;;;;;;;;;;;;;;;EAiB1F,CAAC;IAED,MAAM,OAAO,CAAC;;;;;;IAMZ,EAAE,UAAU;;;;;EAKd,CAAC;IAED,MAAM,IAAA,oKAAS,EAAC;QACd,IAAI;QACJ,SAAS;QACT;QACA;IACF;AACF;AAKO,eAAe,uBAAuB,KAAa,EAAE,KAAa;IACvE,MAAM,WAAW,GAAG,SAAS,2BAA2B,EAAE,OAAO;IAEjE,MAAM,OAAO,CAAC;;;;;;;;;;;;;;;;;;mBAkBG,EAAE,SAAS;;;;;;;mBAOX,EAAE,SAAS,iDAAiD,EAAE,SAAS;;;;;;;;;;;;;;;;;EAiBxF,CAAC;IAED,MAAM,OAAO,CAAC;;;;;;IAMZ,EAAE,SAAS;;;;;EAKb,CAAC;IAED,MAAM,IAAA,oKAAS,EAAC;QACd,IAAI;QACJ,SAAS;QACT;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 667, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/lib/services/auth.service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma';\nimport { hashPassword } from '@/lib/utils/crypto';\nimport { generateToken } from '@/lib/utils/crypto';\nimport { sendVerificationEmail, sendPasswordResetEmail } from '@/lib/utils/email-templates';\nimport { SignUpInput } from '@/lib/validators/auth.validators';\n\nexport class AuthService {\n  /**\n   * Register new user with organization\n   */\n  async signUp(data: SignUpInput) {\n    const { email, password, name, orgName } = data;\n\n    // Check if user already exists\n    const existingUser = await prisma.user.findUnique({\n      where: { email }\n    });\n\n    if (existingUser) {\n      throw new Error('User with this email already exists');\n    }\n\n    // Hash password\n    const hashedPassword = await hashPassword(password);\n\n    // Generate verification token\n    const verificationToken = generateToken();\n    const tokenExpiry = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24 hours\n\n    // Create organization and user in transaction\n    const result = await prisma.$transaction(async (tx) => {\n      // Create organization\n      const org = await tx.organization.create({\n        data: {\n          name: orgName,\n        }\n      });\n\n      // Create user\n      const user = await tx.user.create({\n        data: {\n          email,\n          password: hashedPassword,\n          name,\n          role: 'ADMIN', // First user is admin\n          orgId: org.id,\n          isActive: true,\n        }\n      });\n\n      // Create verification token\n      await tx.verificationToken.create({\n        data: {\n          identifier: email,\n          token: verificationToken,\n          expires: tokenExpiry,\n        }\n      });\n\n      // Log account creation\n      await tx.activityLog.create({\n        data: {\n          userId: user.id,\n          orgId: org.id,\n          action: 'CREATE',\n          entity: 'USER',\n          entityId: user.id,\n          metadata: {\n            email,\n            name,\n            source: 'SIGNUP',\n          }\n        }\n      });\n\n      return { user, org, verificationToken };\n    });\n\n    // Send verification email\n    await sendVerificationEmail(email, verificationToken);\n\n    return {\n      success: true,\n      message: 'Account created. Please check your email to verify your account.',\n      userId: result.user.id,\n    };\n  }\n\n  /**\n   * Verify email address\n   */\n  async verifyEmail(token: string) {\n    const verificationToken = await prisma.verificationToken.findUnique({\n      where: { token }\n    });\n\n    if (!verificationToken) {\n      throw new Error('Invalid or expired verification token');\n    }\n\n    if (new Date() > verificationToken.expires) {\n      throw new Error('Verification token has expired');\n    }\n\n    // Update user email verification\n    await prisma.user.update({\n      where: { email: verificationToken.identifier },\n      data: { emailVerified: new Date() }\n    });\n\n    // Delete used token\n    await prisma.verificationToken.delete({\n      where: { token }\n    });\n\n    return {\n      success: true,\n      message: 'Email verified successfully',\n    };\n  }\n\n  /**\n   * Request password reset\n   */\n  async requestPasswordReset(email: string) {\n    const user = await prisma.user.findUnique({\n      where: { email }\n    });\n\n    if (!user) {\n      // Don't reveal if email exists\n      return {\n        success: true,\n        message: 'If an account exists, a password reset link has been sent.',\n      };\n    }\n\n    // Generate reset token\n    const resetToken = generateToken();\n    const tokenExpiry = new Date(Date.now() + 60 * 60 * 1000); // 1 hour\n\n    // Store reset token\n    await prisma.verificationToken.create({\n      data: {\n        identifier: email,\n        token: resetToken,\n        expires: tokenExpiry,\n      }\n    });\n\n    // Send reset email\n    await sendPasswordResetEmail(email, resetToken);\n\n    return {\n      success: true,\n      message: 'If an account exists, a password reset link has been sent.',\n    };\n  }\n\n  /**\n   * Reset password with token\n   */\n  async resetPassword(token: string, newPassword: string) {\n    const verificationToken = await prisma.verificationToken.findUnique({\n      where: { token }\n    });\n\n    if (!verificationToken) {\n      throw new Error('Invalid or expired reset token');\n    }\n\n    if (new Date() > verificationToken.expires) {\n      throw new Error('Reset token has expired');\n    }\n\n    // Hash new password\n    const hashedPassword = await hashPassword(newPassword);\n\n    // Update user password\n    await prisma.user.update({\n      where: { email: verificationToken.identifier },\n      data: { password: hashedPassword }\n    });\n\n    // Delete used token\n    await prisma.verificationToken.delete({\n      where: { token }\n    });\n\n    return {\n      success: true,\n      message: 'Password reset successfully',\n    };\n  }\n}\n\nexport const authService = new AuthService();\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 864, "column": 0}, "map": {"version":3,"sources":["file:///Users/gregorystarr/projects/astralis-nextjs/src/app/api/auth/verify-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { authService } from '@/lib/services/auth.service';\n\nexport async function POST(req: NextRequest) {\n  try {\n    const { token } = await req.json();\n\n    if (!token) {\n      return NextResponse.json(\n        { error: 'Token is required' },\n        { status: 400 }\n      );\n    }\n\n    const result = await authService.verifyEmail(token);\n\n    return NextResponse.json(result);\n  } catch (error) {\n    console.error('Email verification error:', error);\n\n    if (error instanceof Error) {\n      return NextResponse.json(\n        { error: error.message },\n        { status: 400 }\n      );\n    }\n\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAEhC,IAAI,CAAC,OAAO;YACV,OAAO,kLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,4LAAW,CAAC,WAAW,CAAC;QAE7C,OAAO,kLAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAE3C,IAAI,iBAAiB,OAAO;YAC1B,OAAO,kLAAY,CAAC,IAAI,CACtB;gBAAE,OAAO,MAAM,OAAO;YAAC,GACvB;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,kLAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}